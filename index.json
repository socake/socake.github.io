[{"content":" ğŸ­ å…³äºè¿™ä½ç¥ç§˜ä½œè€… # ğŸª æˆ‘çš„\u0026quot;è¾‰ç…Œ\u0026quot;å±¥å†ï¼š # èµ„æ·±ç†¬å¤œä¸“å®¶ï¼šæ‹¥æœ‰è¿ç»­48å°æ—¶ä¸ç¡è§‰åªä¸ºäº†æ”¹ä¸€ä¸ªæ ‡ç‚¹ç¬¦å·çš„\u0026quot;ä¸°å¯Œ\u0026quot;ç»éªŒ å’–å•¡å“é‰´å¤§å¸ˆï¼šç²¾é€šå„ç§å“ç‰Œå’–å•¡ä¸é»‘çœ¼åœˆä¹‹é—´çš„å¾®å¦™å…³ç³» é”®ç›˜æ•²å‡»è‰ºæœ¯å®¶ï¼šæ“…é•¿æŠŠå®Œæ•´çš„æƒ³æ³•æ•²æˆå¤©ä¹¦ï¼Œè¿è‡ªå·±éƒ½çœ‹ä¸æ‡‚ æ‹–å»¶ç—‡æ‚£è€…åä¼šä¼šé•¿ï¼šä¸“ä¸š procrastinatorï¼Œdeadline æ˜¯æˆ‘çš„åˆ›ä½œçµæ„Ÿæºæ³‰ ğŸ› ï¸ æˆ‘çš„\u0026quot;ä¸“ä¸š\u0026quot;æŠ€èƒ½ï¼š # æŠŠç®€å•é—®é¢˜å¤æ‚åŒ–ï¼Œå¤æ‚é—®é¢˜\u0026hellip;æ›´å¤æ‚åŒ– ç”¨1000å­—è§£é‡Šä¸€ä¸ªå°å­¦æ•°å­¦é¢˜ åœ¨å†™ä½œæ—¶çªç„¶æƒ³æ•´ç†æ¡Œé¢ã€æ´—è¡£æœã€æµ‡èŠ±\u0026hellip;å°±æ˜¯ä¸æƒ³å†™æ–‡ç«  åˆ›é€ æ€§åœ°ä½¿ç”¨å„ç§å€Ÿå£é€ƒé¿å†™ä½œï¼Œæ¯”å¦‚\u0026quot;ä»Šå¤©æœˆäº®ä¸å¤Ÿåœ†\u0026quot; ğŸ¯ åˆ›ä½œç†å¿µï¼š # \u0026ldquo;å¦‚æœä¸€ç¯‡æ–‡ç« ä¸èƒ½è®©è¯»è€…äº§ç”Ÿ\u0026rsquo;ä½œè€…æ˜¯ä¸æ˜¯åœ¨å¼€ç©ç¬‘\u0026rsquo;çš„ç–‘é—®ï¼Œé‚£å®ƒå°±è¿˜æ²¡æœ‰å®Œæˆã€‚\u0026rdquo;\nâš ï¸ é‡è¦æé†’ï¼š # ç”±äºæœ¬äººå…·æœ‰ä»¥ä¸‹\u0026quot;ç‰¹æ®Šèƒ½åŠ›\u0026quot;ï¼Œé˜…è¯»å‰è¯·åšå¥½å¿ƒç†å‡†å¤‡ï¼š\nåœ¨ä¸¥è‚ƒè¯é¢˜ä¸­çªç„¶æ’å…¥å†·ç¬‘è¯ ç”¨è¡¨æƒ…ç¬¦å·ä»£æ›¿éƒ¨åˆ†æ–‡å­— æŠŠæ¯”å–»ç”¨å¾—è®©äººæ‘¸ä¸ç€å¤´è„‘ è·‘é¢˜æŠ€èƒ½æ»¡çº§ ğŸ“ æœ€åå£°æ˜ï¼š # æœ¬äººä»åœ¨åŠªåŠ›å­¦ä¹ å¦‚ä½•åœ¨ä¸å¤±è¶£å‘³æ€§çš„å‰æä¸‹æŠŠæ–‡ç« å†™å¾—åƒæ ·ä¸€ç‚¹ã€‚å¦‚æœå‘ç°å†…å®¹è¿‡äº\u0026quot;ç²¾å½©\u0026quot;ï¼Œè¯·ç†è§£è¿™å¯èƒ½æ˜¯æˆ‘æœ€åä¸€æ¬¡æŒ£æ‰ã€‚\nP.S. å¦‚æœä½ è¯»åˆ°è¿™é‡Œè¿˜æ²¡å…³æ‰é¡µé¢ï¼Œè¯´æ˜æˆ‘çš„\u0026quot;æ‰å\u0026quot;è¿˜æ˜¯æœ‰ç‚¹ç”¨çš„ï¼ŸğŸ¤”\nå†…å®¹å¾…å®Œå–„åŒºåŸŸï¼š\nå®é™…çš„ä¸“ä¸šèƒŒæ™¯ä»‹ç» çœŸæ­£æœ‰ç”¨çš„åˆ›ä½œç»éªŒåˆ†äº« ä¸é‚£ä¹ˆ\u0026quot;è‡ªé»‘\u0026quot;çš„ä¸ªäººæè¿° èƒ½è®©è¯»è€…è®¤çœŸå¯¹å¾…çš„å†…å®¹æ¦‚è¿° ï¼ˆå¾…ç»­\u0026hellip;ä¹Ÿè®¸å§ ğŸ˜…ï¼‰\n","date":"2025-12-03 23:09","externalUrl":null,"permalink":"/posts/authors/","section":"Posts","summary":"","title":"Authors","type":"posts"},{"content":"","date":"2025-12-03 23:09","externalUrl":null,"permalink":"/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"","date":"2025-12-03 23:09","externalUrl":null,"permalink":"/","section":"Startlight","summary":"","title":"Startlight","type":"page"},{"content":"","date":"2025-12-03 22:57","externalUrl":null,"permalink":"/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","date":"2025-12-03 22:57","externalUrl":null,"permalink":"/categories/docker/","section":"Categories","summary":"","title":"Docker","type":"categories"},{"content":" å¸¸ç”¨æ¨¡ç‰ˆ # ä¸€ã€Docker # 0. Docker é…ç½®æ–‡ä»¶ # ç¤ºä¾‹ï¼š # cat \u0026gt; /etc/docker/daemon.json \u0026lt;\u0026lt;EOF { \u0026#34;exec-opts\u0026#34;: [\u0026#34;native.cgroupdriver=systemd\u0026#34;], \u0026#34;log-driver\u0026#34;: \u0026#34;json-file\u0026#34;, \u0026#34;log-opts\u0026#34;: { \u0026#34;max-size\u0026#34;: \u0026#34;100m\u0026#34;, \u0026#34;max-file\u0026#34;: \u0026#34;100\u0026#34; }, \u0026#34;insecure-registries\u0026#34;: [\u0026#34;harbor.yuliu.com\u0026#34;], \u0026#34;registry-mirrors\u0026#34;: [ \u0026#34;https://docker.mirrors.ustc.edu.cn\u0026#34;, \u0026#34;https://registry.docker-cn.com\u0026#34;, \u0026#34;https://mirror.gcr.io\u0026#34;, \u0026#34;https://docker.registry.cyou\u0026#34;, \u0026#34;https://docker-cf.registry.cyou\u0026#34;, \u0026#34;https://dockercf.jsdelivr.fyi\u0026#34;, \u0026#34;https://docker.jsdelivr.fyi\u0026#34;, \u0026#34;https://dockertest.jsdelivr.fyi\u0026#34;, \u0026#34;https://mirror.aliyuncs.com\u0026#34;, \u0026#34;https://dockerproxy.com\u0026#34;, \u0026#34;https://mirror.baidubce.com\u0026#34;, \u0026#34;https://docker.m.daocloud.io\u0026#34;, \u0026#34;https://docker.nju.edu.cn\u0026#34;, \u0026#34;https://docker.mirrors.sjtug.sjtu.edu.cn\u0026#34;, \u0026#34;https://docker.m.daocloud.io\u0026#34;, \u0026#34;https://huecker.io\u0026#34;, \u0026#34;https://dockerhub.timeweb.cloud\u0026#34;, \u0026#34;https://noohub.ru\u0026#34;, \u0026#34;https://ustc-edu-cn.mirror.aliyuncs.com\u0026#34;, \u0026#34;https://hub.uuuadc.top\u0026#34;, \u0026#34;https://docker.anyhub.us.kg\u0026#34;, \u0026#34;https://dockerhub.jobcher.com\u0026#34;, \u0026#34;https://dockerhub.icu\u0026#34;, \u0026#34;https://docker.ckyl.me\u0026#34;, \u0026#34;https://docker.awsl9527.cn\u0026#34;, \u0026#34;https://x9r52uz5.mirror.aliyuncs.com\u0026#34;, \u0026#34;https://docker.chenby.cn\u0026#34;, \u0026#34;https://docker.1panel.live\u0026#34;, \u0026#34;https://docker.awsl9527.cn\u0026#34;, \u0026#34;https://dhub.kubesre.xyz\u0026#34; ] } EOF 1. å®¹å™¨å¯åŠ¨å‘½ä»¤ # å‚è€ƒé“¾æ¥CSDN\n# å‘½ä»¤æ ¼å¼ docker run [OPTIONS] IMAGE [COMMAND] [ARG...] - IMAGE: ä½¿ç”¨çš„é•œåƒ - COMMAND: åœ¨å®¹å™¨ä¸­è¿è¡Œçš„å‘½ä»¤ - ARG...: ä¼ é€’ç»™å‘½ä»¤çš„å‚æ•° # å‘½ä»¤é€‰é¡¹ -d: åœ¨åå°è¿è¡Œå®¹å™¨å¹¶æ‰“å°å®¹å™¨ID -p: å‘å¸ƒå®¹å™¨çš„ç«¯å£åˆ°ä¸»æœº -v: ç»‘å®šä¸€ä¸ªå· -e: è®¾ç½®ç¯å¢ƒå˜é‡ -h: å®¹å™¨çš„ä¸»æœºå --rm: å®¹å™¨é€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤ --restart: å®¹å™¨é€€å‡ºæ—¶çš„é‡å¯ç­–ç•¥ --name: ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§° --expose: æš´éœ²ä¸€ä¸ªç«¯å£æˆ–ä¸€ç»„ç«¯å£ --network: è¿æ¥åˆ°ç½‘ç»œ --ip: ä¸ºå®¹å™¨æŒ‡å®šIPåœ°å€ --dns: è®¾ç½®è‡ªå®šä¹‰DNSæœåŠ¡å™¨ --entrypoint: è¦†ç›–é»˜è®¤çš„ENTRYPOINT --user, -u: æŒ‡å®šè¿è¡Œç”¨æˆ· --workdir, -w: å·¥ä½œç›®å½• --add-host: æ·»åŠ è‡ªå®šä¹‰ä¸»æœºåˆ°/etc/hosts --read-only: å°†å®¹å™¨æ–‡ä»¶ç³»ç»Ÿè®¾ç½®ä¸ºåªè¯» --security-opt: å®‰å…¨é€‰é¡¹ --privileged: ç»™äºˆæ‰©å±•çš„æƒé™ --device: æ·»åŠ ä¸»æœºè®¾å¤‡ç»™å®¹å™¨ --tmpfs: æŒ‚è½½ä¸€ä¸ªtmpfsç›®å½• --stop-signal: è®¾ç½®åœæ­¢å®¹å™¨çš„ä¿¡å· --stop-timeout: å®¹å™¨åœæ­¢è¶…æ—¶æ—¶é—´ --health-cmd: å¥åº·æ£€æŸ¥å‘½ä»¤ --health-interval: å¥åº·æ£€æŸ¥é—´éš” --health-retries: å¥åº·æ£€æŸ¥é‡è¯•æ¬¡æ•° --health-timeout: å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´ --health-start-period: åº”ç”¨å¥åº·æ£€æŸ¥å‰çš„åˆå§‹å»¶è¿Ÿ ï¼ˆ1ï¼‰å¯åŠ¨å®¹å™¨å¹¶æŒ‚è½½ç›¸å…³ç›®å½• # docker run -d \\ --name my-app \\ -p 8080:80 \\ --restart unless-stopped \\ --memory=512m \\ --cpus=1 \\ --log-opt max-size=10m \\ --log-opt max-file=3 \\ nginx å¯æ›¿ä»£å‚æ•°ï¼š\n1. restart no:ä¸é‡å¯ï¼ˆé»˜è®¤ï¼‰ always:ä¸€ç›´é‡å¯ unless-stoped:é™¤å»æ‰‹åŠ¨é€€å‡ºï¼Œä¸€ç›´é‡å¯ on-failure[:max]:ç”±äºé”™è¯¯é€€å‡ºæ—¶ï¼Œé‡å¯ï¼ˆå¯ä»¥è®¾ç½®å¤§äº›ï¼Œé˜²æ­¢å› æœºå™¨é‡å¯é€ æˆæ— æ³•æ‹‰èµ·ï¼‰ ï¼ˆ2ï¼‰å¯åŠ¨å®¹å™¨å¹¶æŒ‚è½½GPU # æŒ‚è½½å…¨éƒ¨GPU docker run --shm-size 4g -itd \\ --name ocr \\ -p 8502:8502 \\ -p 8506:8506 \\ -p 8507:8507 \\ -v /home/s1/exchange_file:/home/serving/exchange_file \\ -v /etc/localtime:/etc/localtime:ro \\ -e LD_LIBRARY_PATH=/nvidia:$LD_LIBRARY_PATH \\ --gpus all \\ --restart always \\ image_name \\ --token=192.168.1.15 \\ --entrypoint /opt/sae/bin/entrypoint.sh ## -e LD_LIBRARY_PATH=/nvidia:$LD_LIBRARY_PATH æŒ‚è½½cudaç›¸å…³çš„åº“æ–‡ä»¶ æŒ‚è½½éƒ¨åˆ†GPU docker run -it \\ --gpus \u0026#39;\u0026#34;device=5,6,7\u0026#34;\u0026#39; \\ --name my_tf_container \\ -v /data:/data \\ my_tensorflow_image æŒ‚è½½GPU docker run --rm -it --gpus=all --name ssm-ie_small_model \\ --device /dev/nvidia0:/dev/nvidia0 \\ --device /dev/nvidiactl:/dev/nvidiactl \\ --device /dev/nvidia-uvm:/dev/nvidia-uvm \\ --device /dev/nvidia-uvm-tools:/dev/nvidia-uvm-tools \\ ie_small_model:v005dev /bin/bash æŒ‚è½½åä¸º310p å›½äº§npu docker run --name ${container_name} ${DEV_MOUNT} \\ --device=/dev/davinci0 \\ --device=/dev/davinci_manager \\ --device=/dev/devmm_svm \\ --device=/dev/hisi_hdc \\ -v /home/serving/exchange_file:/home/serving/exchange_file \\ -v /usr/local/bin/npu-smi:/usr/local/bin/npu-smi \\ -v /etc/ascend_install.info:/etc/ascend_install.info \\ -v /usr/local/Ascend/driver:/usr/local/Ascend/driver \\ -p 8506:8506 \\ -p 8507:8507 -itd \\ --shm-size 32G \\ --restart=always \\ --entrypoint /bin/bash \\ $DOCKER_IMAGE \\ /opt/sae/bin/entrypoint.sh \\ --token=192.168.106.7 \\ ï¼ˆ3ï¼‰å¯åŠ¨å®¹å™¨å¹¶é…ç½®æ—¥å¿—è½®è½¬ # docker run \\ --name my_app_container \\ --log-opt max-size=10m \\ --log-opt max-file=3 \\ --memory=\u0026#34;2g\u0026#34; \\ --cpus=\u0026#34;.5\u0026#34; \\ --label env=production \\ -p 8080:80 \\ -v /path/to/host/data:/path/to/container/data \\ -d \\ --restart unless-stopped \\ my_app_image:latest 2. Docker-composeæ¨¡ç‰ˆ # 2.1 å­—æ®µæ¨¡ç‰ˆ # # æŒ‡å®š Docker Compose æ–‡ä»¶ç‰ˆæœ¬ï¼ˆæ¨è 3.xï¼‰ version: \u0026#39;3.8\u0026#39; # å®šä¹‰æœåŠ¡é›†åˆ services: # ç¤ºä¾‹æœåŠ¡ï¼šWeb åº”ç”¨ webapp: # æŒ‡å®šæœåŠ¡ä½¿ç”¨çš„é•œåƒï¼ˆä¼˜å…ˆä»ä»“åº“æ‹‰å–ï¼‰ image: nginx:latest # æ„å»ºé•œåƒçš„é…ç½®ï¼ˆè‹¥éœ€è‡ªå®šä¹‰æ„å»ºï¼‰ build: # Dockerfile æ‰€åœ¨ç›®å½•è·¯å¾„ context: ./app # æŒ‡å®š Dockerfile æ–‡ä»¶å dockerfile: Dockerfile.prod # æ„å»ºå‚æ•°ï¼ˆè¦†ç›– Dockerfile ä¸­çš„ ARGï¼‰ args: APP_ENV: production # è‡ªå®šä¹‰å®¹å™¨åç§°ï¼ˆé¿å…è‡ªåŠ¨ç”Ÿæˆï¼‰ container_name: my_webapp # ç«¯å£æ˜ å°„ï¼ˆå®¿ä¸»æœºç«¯å£:å®¹å™¨ç«¯å£ï¼‰ ports: - \u0026#34;80:80\u0026#34; - \u0026#34;443:443\u0026#34; # æ•°æ®å·æŒ‚è½½ï¼ˆå®¿ä¸»æœºè·¯å¾„:å®¹å™¨è·¯å¾„:è¯»å†™æ¨¡å¼ï¼‰ volumes: - ./app/data:/var/www/html:rw # è¯»å†™æ¨¡å¼ - nginx_config:/etc/nginx/conf.d:ro # åªè¯»æ¨¡å¼ # ç¯å¢ƒå˜é‡é…ç½®ï¼ˆæ”¯æŒé”®å€¼å¯¹æˆ–åˆ—è¡¨ï¼‰ environment: TZ: Asia/Shanghai DEBUG: \u0026#34;false\u0026#34; - DB_HOST=db # ä»æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡ env_file: - .env.production # ä¾èµ–æœåŠ¡ï¼ˆç¡®ä¿ä¾èµ–æœåŠ¡å…ˆå¯åŠ¨ï¼‰ depends_on: - db - redis # å®¹å™¨é‡å¯ç­–ç•¥ restart: unless-stopped # è‡ªå®šä¹‰ DNS è§£æï¼ˆåŸŸå:IPï¼‰ extra_hosts: - \u0026#34;api.example.com:192.168.1.100\u0026#34; - \u0026#34;gateway.internal:172.18.0.1\u0026#34; # å®¹å™¨æƒé™é…ç½® privileged: true # å¼€å¯ç‰¹æƒæ¨¡å¼ user: root # æŒ‡å®šè¿è¡Œç”¨æˆ· cap_add: # æ·»åŠ  Linux èƒ½åŠ› - NET_ADMIN # å¥åº·æ£€æŸ¥é…ç½® healthcheck: test: [\u0026#34;CMD\u0026#34;, \u0026#34;curl\u0026#34;, \u0026#34;-f\u0026#34;, \u0026#34;http://localhost\u0026#34;] interval: 30s timeout: 10s retries: 3 # æ—¥å¿—é…ç½® logging: driver: json-file options: max-size: \u0026#34;10m\u0026#34; max-file: \u0026#34;3\u0026#34; # ç½‘ç»œé…ç½® networks: - frontend - backend # ç¤ºä¾‹æœåŠ¡ï¼šæ•°æ®åº“ db: image: postgres:13 container_name: app_db volumes: - pg_data:/var/lib/postgresql/data environment: POSTGRES_PASSWORD: secret networks: - backend # ç¤ºä¾‹æœåŠ¡ï¼šRedis redis: image: redis:alpine command: redis-server --requirepass secret networks: - backend # è‡ªå®šä¹‰ç½‘ç»œé…ç½® networks: frontend: driver: bridge ipam: config: - subnet: 172.20.0.0/24 backend: driver: bridge # æ•°æ®å·å£°æ˜ï¼ˆæŒä¹…åŒ–å­˜å‚¨ï¼‰ volumes: nginx_config: pg_data: 2.2 ipè‡ªåŠ¨æ”¹å˜æ¨¡ç‰ˆ # åœ¨ Docker Compose ä¸­ï¼Œextra_hosts å­—æ®µé»˜è®¤éœ€æ‰‹åŠ¨æŒ‡å®šé™æ€ IPï¼Œæ— æ³•ç›´æ¥è‡ªåŠ¨è¯†åˆ«åŠ¨æ€å˜åŒ–çš„ä¸»æœº IPã€‚ä»¥ä¸‹æ˜¯å‡ ç§è‡ªåŠ¨åŒ–é€‚é…åŠ¨æ€ IP çš„è§£å†³æ–¹æ¡ˆï¼ŒæŒ‰æ¨èåº¦æ’åºï¼š\næ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ host.docker.internal ç‰¹æ®ŠåŸŸåï¼ˆæ¨èğŸ”¥ï¼‰\nåŸç†ï¼šDocker å†…ç½®åŸŸå host.docker.internal è‡ªåŠ¨è§£æä¸ºå®¿ä¸»æœºçš„ IPï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ã€‚ é…ç½®æ–¹æ³•ï¼š\nservices: webapp: extra_hosts: - \u0026#34;myhost:host.docker.internal\u0026#34; # è‡ªåŠ¨æŒ‡å‘å®¿ä¸»æœº ä¼˜ç‚¹ï¼š\nâœ… æ— éœ€è„šæœ¬æˆ–å˜é‡ï¼ŒDocker è‡ªåŠ¨ç»´æŠ¤ IP æ˜ å°„ 10ã€‚ âœ… è·¨å¹³å°æ”¯æŒï¼ˆWindows/macOS/Linux æ–°ç‰ˆ Dockerï¼‰56ã€‚ æ–¹æ¡ˆäºŒï¼šé€šè¿‡ç¯å¢ƒå˜é‡åŠ¨æ€æ³¨å…¥ IP\nåŸç†ï¼šåœ¨å¯åŠ¨å®¹å™¨æ—¶ä¼ å…¥å®¿ä¸»æœº IP çš„ç¯å¢ƒå˜é‡ï¼Œå¹¶åœ¨ extra_hosts ä¸­å¼•ç”¨è¯¥å˜é‡ã€‚\næ­¥éª¤ï¼š\nè·å–å®¿ä¸»æœº IP\nï¼ˆä»¥ Linux ä¸ºä¾‹ï¼‰ï¼š\n# è·å–å®¿ä¸»æœºå½“å‰ IPï¼ˆä¾‹å¦‚ eth0 ç½‘å¡ï¼‰ export HOST_IP=$(ip addr show eth0 | grep \u0026#34;inet \u0026#34; | awk \u0026#39;{print $2}\u0026#39; | cut -d/ -f1) # åŠ¨æ€è·å–é»˜è®¤ç½‘å¡çš„ipå¹¶è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ echo \u0026#34;HOST_IP=$(ip -4 addr show dev \u0026#34;$(ip route | grep default | awk \u0026#39;{print $5}\u0026#39;|head -n 1)\u0026#34; | grep -oP \u0026#39;(?\u0026lt;=inet\\s)\\d+(\\.\\d+){3}\u0026#39;)\u0026#34; \u0026gt;\u0026gt; ~/.bashrc source ~/.bashrc ä¿®æ”¹ docker-compose.yml\nservices: webapp: extra_hosts: - \u0026#34;myhost:${HOST_IP:-192.168.1.100}\u0026#34; # å¼•ç”¨ç¯å¢ƒå˜é‡ å¯åŠ¨æ—¶ä¼ å…¥å˜é‡\ndocker compose up -e HOST_IP=$HOST_IP ä¼˜ç‚¹ï¼š\nâœ… çµæ´»é€‚é…åŠ¨æ€ IPï¼Œé‡å¯å®¹å™¨æ—¶è‡ªåŠ¨æ›´æ–° 914ã€‚ ç¼ºç‚¹ï¼š âš ï¸ éœ€é¢å¤–è„šæœ¬è·å– IPï¼Œä¸é€‚åˆå…¨è‡ªåŠ¨éƒ¨ç½² 5ã€‚ æ–¹æ¡ˆä¸‰ï¼šå¯åŠ¨è„šæœ¬åŠ¨æ€æ›´æ–° hostsï¼ˆå¤æ‚åœºæ™¯ï¼‰\nåŸç†ï¼šåœ¨å®¹å™¨å¯åŠ¨æ—¶é€šè¿‡è„šæœ¬è·å–å®¿ä¸»æœº IP å¹¶å†™å…¥ /etc/hostsã€‚ é…ç½®æ–¹æ³•ï¼š\nåˆ›å»ºå¯åŠ¨è„šæœ¬ entrypoint.shï¼š\n#!/bin/sh HOST_IP=$(ip route show default | awk \u0026#39;{print $3}\u0026#39;) # è·å–å®¿ä¸»æœºç½‘å…³ IP echo \u0026#34;$HOST_IP myhost\u0026#34; \u0026gt;\u0026gt; /etc/hosts # è¿½åŠ åˆ° hosts exec \u0026#34;$@\u0026#34; # æ‰§è¡ŒåŸå§‹å¯åŠ¨å‘½ä»¤ ä¿®æ”¹ Dockerfile\nCOPY entrypoint.sh /entrypoint.sh RUN chmod +x /entrypoint.sh ENTRYPOINT [\u0026#34;/entrypoint.sh\u0026#34;] åœ¨ docker-compose.yml ä¸­ç§»é™¤ extra_hosts é…ç½®ã€‚ ä¼˜ç‚¹ï¼š\nâœ… å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œé€‚é…ç½‘ç»œå˜åŒ– 14ã€‚ ç¼ºç‚¹ï¼š âš ï¸ éœ€è‡ªå®šä¹‰é•œåƒï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬ 8ã€‚ æ–¹æ¡ˆå››ï¼šæ”¹ç”¨ network_mode: hostï¼ˆæ…ç”¨â—ï¼‰\nåŸç†ï¼šå®¹å™¨å…±äº«å®¿ä¸»æœºç½‘ç»œå‘½åç©ºé—´ï¼Œç›´æ¥é€šè¿‡ localhost è®¿é—®å®¿ä¸»æœºæœåŠ¡ã€‚ é…ç½®ï¼š\nservices: webapp: network_mode: host # ä¸å®¿ä¸»æœºå…±ç”¨ç½‘ç»œ # æ— éœ€ extra_hostsï¼Œç›´æ¥ç”¨ localhost è®¿é—®å®¿ä¸»æœº ä¼˜ç‚¹ï¼š\nâœ… å½»åº•é¿å… IP æ˜ å°„é—®é¢˜ 89ã€‚ ç¼ºç‚¹ï¼š âš ï¸ ç‰ºç‰²å®¹å™¨ç½‘ç»œéš”ç¦»æ€§ï¼Œå­˜åœ¨å®‰å…¨é£é™© 8ã€‚ å„æ–¹æ¡ˆé€‚ç”¨åœºæ™¯æ€»ç»“\næ–¹æ¡ˆ é€‚ç”¨åœºæ™¯ è‡ªåŠ¨åŒ–ç¨‹åº¦ å¤æ‚åº¦ host.docker.internal å¿«é€Ÿå¼€å‘ã€æµ‹è¯•ç¯å¢ƒ â˜…â˜…â˜…â˜…â˜… ä½ ç¯å¢ƒå˜é‡åŠ¨æ€æ³¨å…¥ CI/CD æµæ°´çº¿ã€åŠ¨æ€ IP ç¯å¢ƒ â˜…â˜…â˜…â˜…â˜† ä¸­ å¯åŠ¨è„šæœ¬æ›´æ–° hosts æ—  Docker å†…ç½®åŸŸåæ”¯æŒçš„è€ç‰ˆæœ¬ â˜…â˜…â˜…â˜†â˜† é«˜ network_mode: host é«˜æ€§èƒ½éœ€æ±‚ä¸”ä¸è¦æ±‚ç½‘ç»œéš”ç¦» â˜…â˜…â˜…â˜…â˜… ä½ 2.3 å‰ç«¯æ‰˜ç®¡æ¨¡ç‰ˆ # version: \u0026#39;3\u0026#39; services: nginx: image: nginx:1.25.3 container_name: frontend-sjfxwj ports: - \u0026#34;55219:80\u0026#34; volumes: - ./dist:/usr/share/nginx/html - ./nginx.conf:/etc/nginx/conf.d/default.conf 3. Dockerfileæ¨¡ç‰ˆ # ï¼ˆ1ï¼‰å‰ç«¯æ¨¡ç‰ˆ # **è¯´æ˜ï¼š**nodeç¼–è¯‘ï¼Œæ‰˜ç®¡åˆ°nginx\n# ä½¿ç”¨ Node.js ä½œä¸ºæ„å»ºç¯å¢ƒ FROM node:16 AS build # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /app # å¤åˆ¶ package.json å’Œ package-lock.json COPY package*.json ./ # å®‰è£…ä¾èµ– RUN npm install # å¤åˆ¶å…¶ä»–æºä»£ç  COPY . . # æ„å»ºå‰ç«¯åº”ç”¨ RUN npm run build # ä½¿ç”¨ Nginx ä½œä¸ºç”Ÿäº§ç¯å¢ƒçš„æœåŠ¡å™¨ FROM nginx:alpine # åˆ é™¤é»˜è®¤çš„ Nginx ç½‘ç«™å†…å®¹ RUN rm -rf /usr/share/nginx/html/* # ä»æ„å»ºçš„é•œåƒä¸­å¤åˆ¶æ„å»ºå¥½çš„æ–‡ä»¶åˆ° Nginx ç›®å½• COPY --from=build /app/dist /usr/share/nginx/html # æš´éœ² Nginx é»˜è®¤çš„ç«¯å£ EXPOSE 80 # å¯åŠ¨ Nginx CMD [\u0026#34;nginx\u0026#34;, \u0026#34;-g\u0026#34;, \u0026#34;daemon off;\u0026#34;] **è¯´æ˜ï¼š**å‰åç«¯åšç¼–è¯‘ï¼Œæ”¾å…¥åç«¯é•œåƒä¸­åšæ‰˜ç®¡\n# æ— ç¼“å†²é•œåƒï¼Œä¼šæ¯”è¾ƒè€—è´¹æ—¶é—´ FROM node:10.15-alpine as front-builder WORKDIR /user ADD ./frontend/application . RUN yarn # è¿™ä¸€æ­¥è€—è´¹çš„æ—¶é—´æœ€é•¿ RUN yarn build FROM golang:1.12.5-alpine3.9 as back-builder WORKDIR /go RUN mkdir -p ./src/xxx ADD ./backend/src/xxx ./src/xxx RUN go install xxx FROM golang:1.12.5-alpine3.9 WORKDIR /app COPY --from=front-builder /user/build ./public COPY --from=back-builder /go/bin/xxx . CMD [\u0026#34;./xxx\u0026#34;] #åˆ¶ä½œç¼“å†²é•œåƒ FROM node:10.15-alpine WORKDIR /user ADD ./frontend/application . RUN yarn RUN rm -rf `grep -v \u0026#34;node_modules\u0026#34; | grep -v \u0026#34;yarn.lock\u0026#34;` #åˆ©ç”¨ç¼“å†²é•œåƒï¼Œè¿›è¡Œæ„å»º FROM node-application-cache:latest as front-builder #æ›´æ¢äº†å‰ç«¯æ„å»ºé•œåƒ WORKDIR /user ADD ./frontend/application . RUN yarn # è¿™ä¸€æ­¥è€—è´¹çš„æ—¶é—´æœ€é•¿ RUN yarn build FROM golang:1.12.5-alpine3.9 as back-builder WORKDIR /go RUN mkdir -p ./src/xxx ADD ./backend/src/xxx ./src/xxx RUN go install xxx FROM golang:1.12.5-alpine3.9 WORKDIR /app COPY --from=front-builder /user/build ./public COPY --from=back-builder /go/bin/xxx . CMD [\u0026#34;./xxx\u0026#34;] ï¼ˆ2ï¼‰åç«¯æ¨¡ç‰ˆ # Python # ä½¿ç”¨ Python ä½œä¸ºåŸºç¡€é•œåƒ FROM python:3.9 # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /usr/src/app # å¤åˆ¶ requirements.txt COPY requirements.txt ./ # å®‰è£…ä¾èµ– RUN pip install --no-cache-dir -r requirements.txt # å¤åˆ¶åº”ç”¨æºä»£ç  COPY . . # æš´éœ²æœåŠ¡è¿è¡Œçš„ç«¯å£ EXPOSE 5000 # è®¾ç½®ç¯å¢ƒå˜é‡ ENV FLASK_APP=app.py # å¯åŠ¨ Flask åº”ç”¨ CMD [\u0026#34;flask\u0026#34;, \u0026#34;run\u0026#34;, \u0026#34;--host=0.0.0.0\u0026#34;] FROM python:3.10.12-slim LABEL \\ author=\u0026#34;hwz\u0026#34; \\ email=\u0026#34;17691281867@163.com\u0026#34; WORKDIR /app RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime RUN echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware\u0026#34; \u0026gt; /etc/apt/sources.list \\ #\u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ #\u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ #\u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list # \u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list RUN apt update RUN apt install -y dmidecode Run apt install -y vim ping wget curl RUN apt-get install -y libreoffice # Install python requirements.txt ADD requirements.txt . RUN pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple RUN pip config set global.trusted-host pypi.tuna.tsinghua.edu.cn RUN pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt \u0026amp;\u0026amp; pip cache purge ADD . /app EXPOSE 37861 CMD [\u0026#34;python\u0026#34;, \u0026#34;application.py\u0026#34;] #cudnnã€python3.10ã€cudaï¼š12.6.1 FROM nvidia/cuda:12.6.1-cudnn-devel-ubuntu20.04_python3.10 LABEL author=\u0026#34;hwz\u0026#34; SHELL [\u0026#34;/bin/bash\u0026#34;, \u0026#34;-c\u0026#34;] RUN apt-get update \u0026amp;\u0026amp; apt install wget curl vim -y WORKDIR /app RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime ## å®‰è£…pipåŒ… RUN pip3 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple ADD ./requirements_yyb.txt . RUN pip3 install -r requirements_yyb.txt \u0026amp;\u0026amp; pip3 cache purge ADD . /home/xchat-model-service WORKDIR /home/xchat-model-service ADD . . EXPOSE 38866 CMD [\u0026#34;python3\u0026#34;, \u0026#34;application.py\u0026#34;] FROM python:3.10.12-slim LABEL \\ author=\u0026#34;Cao Hong Wei\u0026#34; \\ email=\u0026#34;SpringChw@outlook.com\u0026#34; WORKDIR /app RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime RUN echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware\u0026#34; \u0026gt; /etc/apt/sources.list \\ #\u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ #\u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ #\u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list # \u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list RUN apt update RUN apt install dmidecode RUN apt-get install -y libreoffice # Install python requirements.txt ADD requirements.txt . RUN pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt \u0026amp;\u0026amp; pip cache purge #FROM xchat-backend-base-image:1.3 #LABEL author=\u0026#34;hwz\u0026#34; ADD . /home/xchat-model-service WORKDIR /home/xchat-model-service RUN pip install pymysql RUN pip install minio Run pip install tiktoken ADD . . EXPOSE 37861 CMD [\u0026#34;/opt/conda/bin/python\u0026#34;, \u0026#34;application.py\u0026#34;] FROM python:3.10.12-slim LABEL \\ author=\u0026#34;hwz\u0026#34; \\ email=\u0026#34;17691281867@163.com\u0026#34; WORKDIR /app RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime RUN echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware\u0026#34; \u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list # æ¸…ç† apt ç¼“å­˜ RUN echo \u0026#34;Asia/Shanghai\u0026#34; \u0026gt; /etc/timezone \u0026amp;\u0026amp; \\ ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime \u0026amp;\u0026amp; \\ dpkg-reconfigure -f noninteractive tzdata RUN apt clean \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/* # æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ RUN apt update RUN apt install -y dmidecode RUN apt install -y vim iputils-ping wget curl RUN apt-get install -y libreoffice # Install python requirements.txt ADD requirements.txt . RUN pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt \u0026amp;\u0026amp; pip cache purge ADD . /app EXPOSE 17000 CMD [\u0026#34;python\u0026#34;, \u0026#34;main.py\u0026#34;] ### é˜»å¡è¿›ç¨‹ FROM pollux_finetune_deploy_npu:v0.9.3_4.51.3 COPY finetune/preset_config /workspace/preset_config COPY utils.py /workspace/utils.py COPY npu_utils.py /workspace/npu_utils.py CMD [\u0026#34;bash\u0026#34;, \u0026#34;-c\u0026#34;, \u0026#34;python /workspace/main_server.py\u0026gt;/workspace/app.log 2\u0026gt;\u0026amp;1 \u0026amp; tail -f /workspace/app.log \u0026amp; wait\u0026#34;] Java (Spring Boot) # ä½¿ç”¨ Maven æ„å»ºåº”ç”¨ FROM maven:3.8.1-openjdk-16 AS build # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /usr/src/app # å¤åˆ¶ pom.xml å’Œä»£ç  COPY pom.xml ./ COPY src ./src # æ„å»ºåº”ç”¨ RUN mvn clean package -DskipTests # ä½¿ç”¨ OpenJDK ä½œä¸ºè¿è¡Œæ—¶ç¯å¢ƒ FROM openjdk:16-jdk-alpine # å¤åˆ¶ jar æ–‡ä»¶åˆ°æ–°é•œåƒä¸­ COPY --from=build /usr/src/app/target/myapp.jar myapp.jar # æš´éœ²æœåŠ¡è¿è¡Œçš„ç«¯å£ EXPOSE 8080 # å¯åŠ¨ Spring Boot åº”ç”¨ CMD [\u0026#34;java\u0026#34;, \u0026#34;-jar\u0026#34;, \u0026#34;myapp.jar\u0026#34;] FROM python:3.10.12-slim LABEL author=\u0026#34;hwz\u0026#34; SHELL [\u0026#34;/bin/bash\u0026#34;, \u0026#34;-c\u0026#34;] RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime RUN echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware\u0026#34; \u0026gt; /etc/apt/sources.list \\ #\u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ #\u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-updates main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \\ #\u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ bookworm-backports main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list \u0026amp;\u0026amp; echo \u0026#34;deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list # \u0026amp;\u0026amp; echo \u0026#34;deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security bookworm-security main contrib non-free non-free-firmware\u0026#34; \u0026gt;\u0026gt; /etc/apt/sources.list RUN apt-get update \u0026amp;\u0026amp; apt install wget curl vim -y WORKDIR /app COPY requirements.txt ./ RUN pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt \u0026amp;\u0026amp; pip cache purge COPY . . EXPOSE 17000 ENV FLASK_APP=app.py CMD [\u0026#34;/opt/conda/bin/python\u0026#34;, \u0026#34;application.py\u0026#34;] #CMD [\u0026#34;python\u0026#34;, \u0026#34;application.py\u0026#34;] Go åº”ç”¨ # ä½¿ç”¨ Golang ä½œä¸ºåŸºç¡€é•œåƒ FROM golang:1.17 AS builder # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /app # å¤åˆ¶ go.mod å’Œ go.sum COPY go.mod ./ COPY go.sum ./ # ä¸‹è½½ä¾èµ– RUN go mod download # å¤åˆ¶æºä»£ç  COPY . . # æ„å»º Go åº”ç”¨ RUN CGO_ENABLED=0 GOOS=linux go build -o myapp . # ä½¿ç”¨ Alpine ä½œä¸ºè½»é‡çº§è¿è¡Œç¯å¢ƒ FROM alpine:latest # è®¾ç½®å·¥ä½œç›®å½• WORKDIR /root/ # å¤åˆ¶ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶åˆ°æ–°é•œåƒ COPY --from=builder /app/myapp . # æš´éœ²æœåŠ¡è¿è¡Œçš„ç«¯å£ EXPOSE 8080 # å¯åŠ¨åº”ç”¨ CMD [\u0026#34;./myapp\u0026#34;] ï¼ˆ3ï¼‰é•œåƒå°è£…pythonç¯å¢ƒ # FROM nvidia/cuda:12.6.1-cudnn-devel-ubuntu20.04 ENV DEBIAN_FRONTEND=noninteractive \\ TZ=Asia/Shanghai RUN apt-get update \u0026amp;\u0026amp; \\ apt-get install -y --no-install-recommends \\ software-properties-common \\ wget \\ git \\ build-essential \\ libssl-dev \\ zlib1g-dev \\ libffi-dev \u0026amp;\u0026amp; \\ add-apt-repository -y ppa:deadsnakes/ppa \u0026amp;\u0026amp; \\ apt-get install -y python3.10 python3.10-dev python3.10-venv \u0026amp;\u0026amp; \\ update-alternatives --install /usr/bin/python3 python3 /usr/bin/python3.10 1 \u0026amp;\u0026amp; \\ rm -rf /var/lib/apt/lists/* RUN wget https://bootstrap.pypa.io/get-pip.py \u0026amp;\u0026amp; \\ python3.10 get-pip.py \u0026amp;\u0026amp; \\ rm get-pip.py \u0026amp;\u0026amp; \\ pip install --upgrade pip RUN pip cache purge ","date":"2025-12-03 22:57","externalUrl":null,"permalink":"/docs/docker/docker%E6%A8%A1%E6%9D%BF/","section":"Docs","summary":"Dockeræ¨¡æ¿ï¼ˆå¦‚Dockerfileå’Œdocker-compose.ymlï¼‰æ˜¯å®¹å™¨åŒ–åº”ç”¨çš„è“å›¾ã€‚å®ƒä»¬å°†åº”ç”¨çš„ç¯å¢ƒã€ä¾èµ–å’Œé…ç½®ä»£ç åŒ–ï¼Œå®ç°äº†ä¸€æ¬¡ç¼–å†™ã€å¤„å¤„è¿è¡Œçš„è‡ªåŠ¨åŒ–éƒ¨ç½²","title":"Dockeræ¨¡æ¿","type":"docs"},{"content":"","date":"2025-12-03 22:57","externalUrl":null,"permalink":"/docs/","section":"Docs","summary":"","title":"Docs","type":"docs"},{"content":"","date":"2025-12-03 22:57","externalUrl":null,"permalink":"/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"2025-12-03 22:57","externalUrl":null,"permalink":"/tags/%E6%A8%A1%E6%9D%BF/","section":"Tags","summary":"","title":"æ¨¡æ¿","type":"tags"},{"content":"","date":"2025-12-03 22:53","externalUrl":null,"permalink":"/categories/linux/","section":"Categories","summary":"","title":"Linux","type":"categories"},{"content":" ä¸‹è½½åŒ…åˆ°æœ¬åœ°çš„å‡ ç§æ–¹æ³• # 1. CentOS--ä½¿ç”¨ yumdownloader sudo yum install yum-utils #ä¸‹è½½å·¥å…·åŒ… yumdownloader \u0026lt;package-name\u0026gt; yumdownloader --resolve egï¼š yumdownloader wget #ä¸‹è½½wgetåˆ°æœ¬åœ° \u0026gt; æˆ–è€… sudo yum install --downloadonly --downloaddir=\u0026lt;directory-path\u0026gt; \u0026lt;package-name\u0026gt; 2. ä½¿ç”¨dnf sudo dnf download \u0026lt;package-name\u0026gt; 3. æœç´¢ rpmåŒ… yum search \u0026lt;search-term\u0026gt; å®‰è£…æœ¬åœ°åŒ…çš„å‘½ä»¤ # 1. ä½¿ç”¨ yum å®‰è£…æœ¬åœ°åŒ… sudo yum localinstall /path/to/package.rpm eg: sudo yum localinstall /tmp/example-package.rpm 2. ä½¿ç”¨ ä½¿ç”¨ dnf å®‰è£…æœ¬åœ°åŒ… sudo dnf install /path/to/package.rpm egï¼š sudo dnf install /tmp/example-package.rpm 3. ç›´æ¥ä½¿ç”¨ rpm å®‰è£…åŒ… sudo rpm -ivh /path/to/package.rpm # ä¾èµ–å…³ç³»: å½“ä½¿ç”¨ rpm å‘½ä»¤å®‰è£…æ—¶ï¼Œç³»ç»Ÿä¸ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰è£…å¤±è´¥ã€‚ä½¿ç”¨ yum æˆ– dnf ä¼šæ›´æ–¹ä¾¿ï¼Œå› ä¸ºå®ƒä»¬ä¼šè‡ªåŠ¨è§£å†³ä¾èµ–é—®é¢˜ã€‚ # åŒ…çš„è·¯å¾„: ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„åŒ…è·¯å¾„ï¼Œè‹¥åŒ…åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚ # æ£€æŸ¥å®‰è£…çŠ¶æ€: å®‰è£…å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥åŒ…æ˜¯å¦å®‰è£…æˆåŠŸï¼š rpm -qa | grep \u0026lt;package-name\u0026gt; ","date":"2025-12-03 22:53","externalUrl":null,"permalink":"/docs/linux/linux%E5%91%BD%E4%BB%A4/%E5%AE%8C%E6%95%B4%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD/","section":"Docs","summary":"åœ¨ç”Ÿäº§ç¯å¢ƒæˆ–å†…ç½‘æœåŠ¡å™¨ä¸­ï¼Œç›´æ¥è”ç½‘å®‰è£…è½¯ä»¶å¾€å¾€ä¸å¯è¡Œã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»åœ¨Linuxç¯å¢ƒä¸‹ç¦»çº¿ä¸‹è½½è½¯ä»¶åŒ…åŠå…¶å®Œæ•´ä¾èµ–çš„å‡ ç§æ ¸å¿ƒæ–¹æ³•","title":"å®Œæ•´å®‰è£…åŒ…ä¸‹è½½","type":"docs"},{"content":"","date":"2025-12-03 22:26","externalUrl":null,"permalink":"/tags/docker/","section":"Tags","summary":"","title":"Docker","type":"tags"},{"content":" äº”ã€Dockerå­˜å‚¨ç®¡ç† # 1. Bind Mounts (ç»‘å®šæŒ‚è½½) # æè¿°ï¼šç»‘å®šæŒ‚è½½å°†å®¿ä¸»æœºçš„æ–‡ä»¶æˆ–ç›®å½•æ˜ å°„åˆ°å®¹å™¨å†…çš„æŸä¸ªè·¯å¾„ã€‚å½“ä½ ä½¿ç”¨ç»‘å®šæŒ‚è½½æ—¶ï¼Œå®¹å™¨çš„æ•°æ®å°†ç›´æ¥å­˜å‚¨åœ¨å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå› æ­¤å®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´å…±äº«æ–‡ä»¶ç³»ç»Ÿã€‚å¦‚æœå®¿ä¸»æœºè·¯å¾„ä¸å­˜åœ¨ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒã€‚\nç‰¹ç‚¹ï¼š\nç›´æ¥ä¾èµ–å®¿ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿï¼šå®¹å™¨è®¿é—®å’Œä¿®æ”¹çš„æ•°æ®ç›´æ¥å­˜å‚¨åœ¨å®¿ä¸»æœºä¸Šã€‚ ä¸å®¿ä¸»æœºç´§å¯†è€¦åˆï¼šå®¿ä¸»æœºçš„æ–‡ä»¶æˆ–ç›®å½•ä½ç½®å›ºå®šï¼Œå› æ­¤ï¼Œå¦‚æœå®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ä¸¢å¤±ï¼Œå®¹å™¨çš„æ•°æ®ä¹Ÿä¼šä¸¢å¤±ã€‚ã€‚ åˆ›å»ºå‘½ä»¤ï¼š\ndocker run -v /host/path:/container/path mycontainer å…¶ä¸­ /host/path æ˜¯å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶æˆ–ç›®å½•è·¯å¾„ï¼Œ/container/path æ˜¯å®¹å™¨å†…çš„è·¯å¾„ã€‚\nè¿™å°†å®¿ä¸»æœºä¸Šçš„ /home/user/data ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…çš„ /data ç›®å½•ã€‚\n2. Volumes (æ•°æ®å·) # æè¿°ï¼šæ•°æ®å·æ˜¯ Docker æä¾›çš„ä¸€ç§æ›´ä¸ºæŠ½è±¡çš„æŒä¹…åŒ–å­˜å‚¨æ–¹å¼ã€‚Docker ä¼šå°†æ•°æ®å­˜å‚¨åœ¨å®¿ä¸»æœºçš„ç‰¹å®šç›®å½•ä¸­ï¼Œä½†ç”¨æˆ·æ— éœ€ç›´æ¥ç®¡ç†è¿™ä¸ªç›®å½•ã€‚Docker ä¼šè‡ªåŠ¨å¤„ç†æ•°æ®å­˜å‚¨çš„ä½ç½®ã€ç”Ÿå‘½å‘¨æœŸç­‰ã€‚ ç‰¹ç‚¹ï¼š æŠ½è±¡åŒ–ç®¡ç†ï¼šæ•°æ®å·ç”± Docker ç®¡ç†ï¼Œå®¿ä¸»æœºçš„ä½ç½®å’Œç»†èŠ‚å¯¹ç”¨æˆ·é€æ˜ã€‚ æŒä¹…æ€§ï¼šå³ä½¿å®¹å™¨è¢«åˆ é™¤ï¼Œæ•°æ®å·ä¸­çš„æ•°æ®ä»ç„¶å­˜åœ¨ï¼Œå¯ä»¥éšæ—¶é‡æ–°æŒ‚è½½åˆ°å…¶ä»–å®¹å™¨ä¸­ã€‚ ä¾¿äºå…±äº«ï¼šå¤šä¸ªå®¹å™¨å¯ä»¥æŒ‚è½½åŒä¸€ä¸ªæ•°æ®å·ï¼Œæ–¹ä¾¿å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®ã€‚ è‡ªåŠ¨åŒ–ç®¡ç†ï¼šDocker å¯ä»¥è‡ªåŠ¨æ¸…ç†ä¸å†ä½¿ç”¨çš„æ•°æ®å·ã€‚ ä¼˜åŒ–æ€§èƒ½ï¼šæ•°æ®å·æ˜¯ä¸ºæŒä¹…åŒ–æ•°æ®ä¼˜åŒ–çš„ï¼Œæ€§èƒ½é€šå¸¸è¾ƒå¥½ã€‚ åˆ›å»ºå‘½ä»¤ï¼š\ndocker volume create myvolume docker run -v myvolume:/container/path mycontainer å…¶ä¸­ myvolume æ˜¯åˆ›å»ºçš„æ•°æ®å·çš„åç§°ï¼Œ/container/path æ˜¯å®¹å™¨å†…çš„æŒ‚è½½è·¯å¾„ã€‚\næŸ¥çœ‹å’Œç®¡ç†æ•°æ®å·ï¼š\næŸ¥çœ‹æ‰€æœ‰æ•°æ®å·ï¼š\ndocker volume ls æŸ¥çœ‹æŸä¸ªæ•°æ®å·çš„è¯¦ç»†ä¿¡æ¯ï¼š\ndocker volume inspect mydbdata åˆ é™¤æ•°æ®å·ï¼š\ndocker volume rm mydbdata æ³¨æ„äº‹é¡¹ï¼š\nDocker ä¼šå°†æ•°æ®å·å­˜å‚¨åœ¨å®¿ä¸»æœºçš„é»˜è®¤ä½ç½®ï¼ˆé€šå¸¸æ˜¯ /var/lib/docker/volumes/ï¼‰ä¸­ï¼Œä½†ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒè¯¥ä½ç½®ã€‚ æ•°æ®å·æ”¯æŒå®¹å™¨é—´çš„å…±äº«ï¼Œå¦‚æœå¤šä¸ªå®¹å™¨æŒ‚è½½åŒä¸€ä¸ªæ•°æ®å·ï¼Œå®¹å™¨é—´çš„æ•°æ®ä¿®æ”¹ä¼šå®æ—¶åŒæ­¥ã€‚ 3. tmpfs Mounts (ä¸´æ—¶æ–‡ä»¶ç³»ç»ŸæŒ‚è½½) # æè¿°ï¼štmpfs æ˜¯å°†å®¹å™¨çš„æ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°å®¿ä¸»æœºçš„å†…å­˜ä¸­ï¼Œé€šå¸¸ç”¨äºå­˜å‚¨ä¸´æ—¶æ•°æ®ã€‚tmpfs æŒ‚è½½æä¾›çš„æ˜¯ä¸€ä¸ªä¸´æ—¶çš„å†…å­˜å­˜å‚¨ï¼Œæ•°æ®ä¸ä¼šå†™å…¥åˆ°ç£ç›˜ï¼Œåœ¨å®¹å™¨åœæ­¢æˆ–é‡å¯æ—¶ä¼šä¸¢å¤±ã€‚\né€‚ç”¨åœºæ™¯ï¼š\nå­˜å‚¨éœ€è¦é«˜æ€§èƒ½ã€ä¸´æ—¶ä¸”ä¸æŒä¹…åŒ–çš„æ•°æ®ï¼Œä¾‹å¦‚ç¼“å­˜æ–‡ä»¶ã€ä¼šè¯ä¿¡æ¯ç­‰ã€‚ ä¸å¸Œæœ›æ•°æ®ä¿ç•™åœ¨å®¿ä¸»æœºä¸Šï¼Œä¹Ÿä¸å¸Œæœ›æ•°æ®åœ¨å®¹å™¨é‡å¯åä¸¢å¤±çš„åœºæ™¯ã€‚ ç‰¹ç‚¹ï¼š\nå†…å­˜å­˜å‚¨ï¼šæ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œé€Ÿåº¦è¾ƒå¿«ã€‚ éæŒä¹…åŒ–ï¼šå®¹å™¨åœæ­¢æˆ–é‡å¯æ—¶ï¼Œæ•°æ®ä¼šä¸¢å¤±ã€‚ æœ‰é™å®¹é‡ï¼štmpfs å ç”¨å®¿ä¸»æœºçš„å†…å­˜ï¼Œå› æ­¤éœ€è¦é€‚å½“é…ç½®å†…å­˜é™åˆ¶ã€‚ ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ï¼šé€‚ç”¨äºéœ€è¦ä¸´æ—¶å­˜å‚¨çš„æ•°æ®ï¼Œé¿å…å ç”¨ç£ç›˜ç©ºé—´ã€‚ åˆ›å»ºå‘½ä»¤ï¼š\ndocker run --mount type=tmpfs,target=/container/path mycontainer è¿™å°†ä¸ºå®¹å™¨ /container/path åˆ›å»ºä¸€ä¸ª tmpfs æŒ‚è½½ã€‚\nç¤ºä¾‹ï¼š\ndocker run --mount type=tmpfs,target=/tmp mycontainer è¿™å°†æŠŠå®¹å™¨çš„ /tmp ç›®å½•æŒ‚è½½ä¸ºä¸€ä¸ªä¸´æ—¶çš„å†…å­˜æ–‡ä»¶ç³»ç»Ÿã€‚\næ³¨æ„äº‹é¡¹ï¼š\nå†…å­˜æŒ‚è½½ä¸ä¼šæŒä¹…åŒ–æ•°æ®ï¼Œå®¹å™¨åœæ­¢åæ•°æ®ä¼šä¸¢å¤±ã€‚ tmpfs æŒ‚è½½é€šå¸¸ç”¨äºé«˜æ€§èƒ½è¦æ±‚çš„ä¸´æ—¶å­˜å‚¨ï¼ˆå¦‚ç¼“å­˜æˆ–æ—¥å¿—æ•°æ®ï¼‰ã€‚ æ€»ç»“å¯¹æ¯”ï¼š # ç‰¹æ€§ Bind Mounts Volumes tmpfs Mounts å­˜å‚¨ä½ç½® å®¿ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„æŒ‡å®šè·¯å¾„ Docker ç®¡ç†çš„å®¿ä¸»æœºç›®å½• å®¹å™¨çš„å†…å­˜ æ•°æ®æŒä¹…åŒ– å®¹å™¨åœæ­¢åæ•°æ®ä¸ä¼šä¸¢å¤±ï¼ˆä¾èµ–å®¿ä¸»æœºè·¯å¾„ï¼‰ å®¹å™¨åˆ é™¤åæ•°æ®ä¸ä¼šä¸¢å¤± å®¹å™¨åœæ­¢åæ•°æ®ä¸¢å¤± ä½¿ç”¨åœºæ™¯ å®¹å™¨ä¸å®¿ä¸»æœºå…±äº«æ–‡ä»¶ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ æŒä¹…åŒ–æ•°æ®å­˜å‚¨å’Œå®¹å™¨é—´å…±äº«æ•°æ® ä¸´æ—¶æ•°æ®å­˜å‚¨ï¼ˆç¼“å­˜ã€æ—¥å¿—ç­‰ï¼‰ æ€§èƒ½ è¾ƒæ…¢ï¼ˆæ–‡ä»¶ç³»ç»ŸæŒ‚è½½ï¼‰ è¾ƒå¿«ï¼Œä¸“ä¸ºæŒä¹…åŒ–æ•°æ®ä¼˜åŒ– éå¸¸å¿«ï¼ˆå†…å­˜å­˜å‚¨ï¼‰ å…±äº«æ•°æ® å®¹å™¨å’Œå®¿ä¸»æœºé—´å…±äº«ï¼Œå®¹å™¨é—´ä¸å…±äº« å®¹å™¨é—´å¯ä»¥å…±äº« ä¸é€‚ç”¨äºå®¹å™¨é—´å…±äº« ç®¡ç†éš¾æ˜“ ç”¨æˆ·æ‰‹åŠ¨ç®¡ç†å®¿ä¸»æœºè·¯å¾„ Docker è‡ªåŠ¨ç®¡ç† éœ€è¦å†…å­˜èµ„æºé™åˆ¶ å…­ã€Dockerä»“åº“ç®¡ç† # 1. ç§æœ‰register # docker pull registry docker run -idt --name registry -v /opt/registry:/var/lib/registry -p 5000:5000 2. harborä»“åº“ # Harbor æ˜¯ç”± VMWare å…¬å¸å¼€æºçš„å®¹å™¨é•œåƒä»“åº“ã€‚äº‹å®ä¸Šï¼Œ Harbor æ˜¯åœ¨ Docker Registry ä¸Šè¿›è¡Œäº†ç›¸åº”çš„ä¼ä¸šçº§æ‰©å±•ï¼Œä»è€Œè·å¾—äº†æ›´åŠ å¹¿æ³›çš„åº”ç”¨ï¼Œè¿™äº›æ–°çš„ä¼ä¸šçº§ç‰¹æ€§åŒ…æ‹¬ï¼šç®¡ç†ç”¨æˆ·ç•Œé¢ï¼ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ ï¼ŒAD/LDAP é›†æˆä»¥åŠå®¡è®¡æ—¥å¿—ç­‰ï¼Œè¶³ä»¥æ»¡è¶³åŸºæœ¬ä¼ä¸šéœ€æ±‚ã€‚\nå®˜æ–¹ : https://goharbor.io/\nGithub: https://github.com/goharbor/harbor\næœåŠ¡å™¨ç¡¬ä»¶é…ç½®ï¼š\næœ€ä½è¦æ±‚ï¼š CPU2 æ ¸ / å†…å­˜ 4G/ ç¡¬ç›˜ 40GB\næ¨èï¼š CPU4 æ ¸ / å†…å­˜ 8G/ ç¡¬ç›˜ 160GB\nä¸ƒã€DockerFile # 1. Dockerfileçš„æŒ‡ä»¤ # æŒ‡ä»¤ æè¿° ç¤ºä¾‹ FROM æŒ‡å®šåŸºç¡€é•œåƒï¼ŒDockerfile çš„ç¬¬ä¸€è¡Œé€šå¸¸æ˜¯ FROMï¼Œå®ƒæŒ‡å®šäº†æ„å»ºé•œåƒæ‰€ä¾èµ–çš„åŸºç¡€é•œåƒã€‚ FROM ubuntu:20.04 RUN æ‰§è¡Œå‘½ä»¤å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚ï¼Œå¸¸ç”¨äºå®‰è£…è½¯ä»¶åŒ…æˆ–æ‰§è¡Œä¸€äº›é…ç½®ä»»åŠ¡ã€‚ RUN apt-get update \u0026amp;\u0026amp; apt-get install -y python3 CMD å®¹å™¨å¯åŠ¨æ—¶é»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦‚æœ docker run ä¸­æ²¡æœ‰æŒ‡å®šå‘½ä»¤ï¼ŒCMD æŒ‡ä»¤æŒ‡å®šçš„å‘½ä»¤ä¼šè¢«æ‰§è¡Œã€‚ CMD [\u0026quot;python\u0026quot;, \u0026quot;app.py\u0026quot;] ENTRYPOINT è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„ä¸»å‘½ä»¤ï¼ŒENTRYPOINT å’Œ CMD é…åˆä½¿ç”¨ï¼ŒæŒ‡å®šå®¹å™¨å¯åŠ¨çš„å‘½ä»¤å’Œå‚æ•°ã€‚ ENTRYPOINT [\u0026quot;python\u0026quot;, \u0026quot;app.py\u0026quot;] COPY å°†æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°é•œåƒä¸­çš„æŒ‡å®šè·¯å¾„ã€‚ COPY ./localfile.txt /app/ ADD ç±»ä¼¼ COPYï¼Œä½†æ”¯æŒæ›´å¤šåŠŸèƒ½ï¼Œæ¯”å¦‚è‡ªåŠ¨è§£å‹ tar æ–‡ä»¶ï¼Œä¸‹è½½ URL ä¸­çš„æ–‡ä»¶å¹¶æ·»åŠ åˆ°é•œåƒä¸­ã€‚ ADD ./archive.tar.gz /app/ EXPOSE å£°æ˜å®¹å™¨åœ¨è¿è¡Œæ—¶ç›‘å¬çš„ç«¯å£ï¼Œå¸®åŠ©æ–‡æ¡£å’Œ Docker ç½‘ç»œç›¸å…³åŠŸèƒ½ä½¿ç”¨ã€‚ EXPOSE 80 ENV è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥åœ¨å®¹å™¨å†…çš„è¿è¡Œæ—¶è¢«å¼•ç”¨ã€‚ ENV APP_ENV=production WORKDIR è®¾ç½®å·¥ä½œç›®å½•ï¼Œæ‰€æœ‰åç»­çš„æŒ‡ä»¤éƒ½ä¼šåœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œã€‚ WORKDIR /app VOLUME åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹ï¼ŒæŒ‚è½½åˆ°å®¹å™¨å†…çš„æŒ‡å®šç›®å½•ã€‚ VOLUME [\u0026quot;/data\u0026quot;] USER æŒ‡å®šå®¹å™¨å†…æ‰§è¡Œå‘½ä»¤æ—¶ä½¿ç”¨çš„ç”¨æˆ·ã€‚ USER myuser ARG å®šä¹‰æ„å»ºæ—¶ä½¿ç”¨çš„å‚æ•°ï¼Œæ„å»ºæ—¶é€šè¿‡ --build-arg è®¾ç½®ã€‚ ARG VERSION=1.0 LABEL ä¸ºé•œåƒæ·»åŠ å…ƒæ•°æ®ï¼Œå¸¸ç”¨äºæè¿°é•œåƒçš„ä½œè€…ã€ç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚ LABEL version=\u0026quot;1.0\u0026quot; maintainer=\u0026quot;yourname@example.com\u0026quot; SHELL è®¾ç½®é»˜è®¤çš„ shell ç±»å‹å’Œé€‰é¡¹ã€‚é»˜è®¤æ˜¯ /bin/sh -cï¼Œå¯ä»¥ä½¿ç”¨å…¶ä»– shellï¼Œå¦‚ /bin/bash -cã€‚ SHELL [\u0026quot;/bin/bash\u0026quot;, \u0026quot;-c\u0026quot;] HEALTHCHECK å®šä¹‰å®¹å™¨çš„å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œç”¨äºç¡®ä¿å®¹å™¨åœ¨è¿è¡Œæ—¶çš„çŠ¶æ€æ˜¯å¦æ­£å¸¸ã€‚ `HEALTHCHECK CMD curl \u0026ndash;fail http://localhost:8080/ STOPSIGNAL è®¾ç½®å®¹å™¨åœæ­¢æ—¶ä½¿ç”¨çš„ä¿¡å·ã€‚é»˜è®¤æ˜¯ SIGTERMï¼Œç”¨æˆ·å¯ä»¥ä¿®æ”¹ä¸ºå…¶ä»–ä¿¡å·ã€‚ STOPSIGNAL SIGINT 2. å¸¸ç”¨å‘½ä»¤è¯¦è§£ # 2.1 FROM # # æ ¼å¼ï¼š FROM \u0026lt;image\u0026gt; FROM \u0026lt;image\u0026gt;:\u0026lt;tag\u0026gt; FROM \u0026lt;image\u0026gt;@\u0026lt;digest\u0026gt; FROM [ --platform=xxx] \u0026lt;image:tag\u0026gt; [AS \u0026lt;name\u0026gt;] #æŒ‡å®šåŸºç¡€é•œåƒå¹³å°åŠäºŒæ¬¡æ„å»ºçš„åŸºç¡€åç§° # å‚æ•°è§£é‡Šï¼š --platfrom ç”¨äºæŒ‡å®šå¹³å°é•œåƒï¼Œå‚æ•°æœ‰ï¼šlinux/amd64 , linux/arm64 ,windows/amd64 # ç¤ºä¾‹ï¼šã€€FROM mysql:5.6 # æ³¨ï¼š tagæˆ–digestæ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ä¸¤ä¸ªå€¼æ—¶ï¼Œä¼šä½¿ç”¨latestç‰ˆæœ¬çš„åŸºç¡€é•œåƒ ### å¤šé˜¶æ®µæ„å»º # ç¬¬ä¸€é˜¶æ®µ FROM node:14 AS builder WORKDIR /app COPY package.json ./ RUN npm install COPY . . RUN npm run build # ç¬¬äºŒé˜¶æ®µ FROM nginx:alpine COPY --from=builder /app/build /usr/share/nginx/html 2.2 ARG # #æŒ‡ä»¤è¯­æ³• ARG \u0026lt;name\u0026gt;[=\u0026lt;dafault value] # ç¤ºä¾‹ ARG CODE=latets FROM base:$CODE è¯´æ˜ï¼šARGä»…åœ¨ç¼–è¯‘æ—¶ç”Ÿæ•ˆï¼Œä¸”å¯ä»¥å‡ºç°åœ¨FROMä¹‹å‰ã€‚ENVæŒ‡å®šçš„å˜é‡ä¿å­˜äºé•œåƒä¹‹ä¸­\n2.3 RUN # # RUNç”¨äºåœ¨æ„å»ºé•œåƒæ—¶æ‰§è¡Œå‘½ä»¤ï¼Œå…¶æœ‰ä»¥ä¸‹ä¸¤ç§å‘½ä»¤æ‰§è¡Œæ–¹å¼ï¼š # shellæ‰§è¡Œ æ ¼å¼ï¼š RUN \u0026lt;command\u0026gt; RUN echo \u0026#34;Hello, World!\u0026#34; # execæ‰§è¡Œ æ ¼å¼ï¼š RUN [\u0026#34;executable\u0026#34;, \u0026#34;param1\u0026#34;, \u0026#34;param2\u0026#34;] ç¤ºä¾‹ï¼š RUN [ \u0026#34;/bin/bash\u0026#34;,\u0026#34;-c\u0026#34;,\u0026#34;echo\u0026#34;, \u0026#34;Hello, World!\u0026#34;] æ³¨ï¼šRUNæŒ‡ä»¤åˆ›å»ºçš„ä¸­é—´é•œåƒä¼šè¢«ç¼“å­˜ï¼Œå¹¶ä¼šåœ¨ä¸‹æ¬¡æ„å»ºä¸­ä½¿ç”¨ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨è¿™äº›ç¼“å­˜é•œåƒï¼Œ å¯ä»¥åœ¨æ„å»ºæ—¶æŒ‡å®š--no-cacheå‚æ•°ï¼Œå¦‚ï¼šdocker build --no-cache å‡å°‘å±‚æ•° # RUN apt-get update \u0026amp;\u0026amp; \\ apt-get install -y curl \u0026amp;\u0026amp; \\ apt-get clean \u0026amp;\u0026amp; \\ rm -rf /var/lib/apt/lists/* ä½¿ç”¨ \u0026amp;\u0026amp; å’Œ || æ§åˆ¶æµç¨‹ # RUN make install \u0026amp;\u0026amp; echo \u0026#34;Install succeeded\u0026#34; || echo \u0026#34;Install failed\u0026#34; ä½¿ç”¨ \u0026amp;\u0026amp; å’Œ set -ex # RUN set -ex \u0026amp;\u0026amp; \\ apt-get update \u0026amp;\u0026amp; \\ apt-get install -y curl æ„å»ºè¿‡ç¨‹ä¸­å¯ä»¥è·Ÿè¸ªæ¯ä¸ªå‘½ä»¤çš„æ‰§è¡Œæƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ set -exã€‚è¿™å°†åœ¨å‘½ä»¤æ‰§è¡Œå¤±è´¥æ—¶å¯¼è‡´æ„å»ºåœæ­¢ï¼Œå¹¶æ˜¾ç¤ºæ‰€æœ‰æ‰§è¡Œçš„å‘½ä»¤ execä¸cmdæ ¼å¼çš„åŒºåˆ« # Exec æ ¼å¼çš„è¯­æ³•å¦‚ä¸‹ï¼š\ndockerfileå¤åˆ¶ä»£ç RUN [\u0026#34;executable\u0026#34;, \u0026#34;param1\u0026#34;, \u0026#34;param2\u0026#34;, ...] ç›´æ¥æ‰§è¡Œï¼šåœ¨ Exec æ ¼å¼ä¸­ï¼ŒDocker ç›´æ¥æ‰§è¡ŒæŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚ echoï¼‰ã€‚å®ƒä¸ä¼šç»è¿‡ shell è¿›ç¨‹ã€‚è¿™æ„å‘³ç€ä»»ä½•é€šå¸¸åœ¨ shell ä¸­å¤„ç†çš„ç‰¹æ€§ï¼ˆå¦‚å‘½ä»¤æ›¿æ¢ã€å˜é‡æ‰©å±•ã€ç®¡é“ã€é‡å®šå‘ç­‰ï¼‰å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚\nç¼ºå°‘ shell åŠŸèƒ½\nï¼šç”±äºæ²¡æœ‰ä½¿ç”¨ shellï¼ŒExec æ ¼å¼ä¸ä¼šå¤„ç†å¦‚ä¸‹æƒ…å†µï¼š\nç¯å¢ƒå˜é‡æ‰©å±•ï¼šåœ¨ Exec æ ¼å¼ä¸­ï¼Œæ‚¨ä¸èƒ½åƒåœ¨ shell ä¸­é‚£æ ·ä½¿ç”¨ $VAR æ¥å¼•ç”¨ç¯å¢ƒå˜é‡ã€‚ å‘½ä»¤è¿æ¥ï¼šä¸èƒ½ä½¿ç”¨ \u0026amp;\u0026amp;ã€|| ç­‰é€»è¾‘æ“ä½œç¬¦æ¥è¿æ¥å‘½ä»¤ã€‚ è¾“å…¥è¾“å‡ºé‡å®šå‘ï¼šåƒ \u0026gt; æˆ– \u0026lt; çš„é‡å®šå‘æ“ä½œå°†ä¸é€‚ç”¨ 2.4 CMD\u0026amp;ENTRYPORINT # CMD # # æ ¼å¼ï¼š CMD [\u0026#34;executable\u0026#34;,\u0026#34;param1\u0026#34;,\u0026#34;param2\u0026#34;] (æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¼˜å…ˆ) CMD [\u0026#34;param1\u0026#34;,\u0026#34;param2\u0026#34;] (è®¾ç½®äº†ENTRYPOINTï¼Œåˆ™ç›´æ¥è°ƒç”¨ENTRYPOINTæ·»åŠ å‚æ•°) CMD command param1 param2 (æ‰§è¡Œshellå†…éƒ¨å‘½ä»¤) # ç¤ºä¾‹ï¼š CMD echo \u0026#34;This is a test.\u0026#34; | wc -l CMD [\u0026#34;/usr/bin/wc\u0026#34;,\u0026#34;--help\u0026#34;] æ³¨ï¼šCMDä¸åŒäºRUNï¼ŒCMDç”¨äºæŒ‡å®šåœ¨å®¹å™¨å¯åŠ¨æ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œè€ŒRUNç”¨äºæŒ‡å®šé•œåƒæ„å»ºæ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚\nENTRYPOINT # # æ ¼å¼ï¼š ENTRYPOINT [\u0026#34;executable\u0026#34;, \u0026#34;param1\u0026#34;, \u0026#34;param2\u0026#34;] (å¯æ‰§è¡Œæ–‡ä»¶, ä¼˜å…ˆ) ENTRYPOINT [\u0026#34;executable\u0026#34;, \u0026#34;param1\u0026#34;] ï¼ˆåç»­å¯æ¥æ”¶CMDçš„ä¼ å‚ï¼Œæˆ–runå‘½ä»¤çš„ä¼ å‚ï¼‰ ENTRYPOINT command param1 param2 (shellå†…éƒ¨å‘½ä»¤) # ç¤ºä¾‹ï¼š FROM ubuntu ENTRYPOINT [\u0026#34;ls\u0026#34;, \u0026#34;/usr/local\u0026#34;] CMD [\u0026#34;/usr/local/tomcat\u0026#34;] ä¹‹åï¼Œdocker run ä¼ é€’çš„å‚æ•°ï¼Œéƒ½ä¼šå…ˆè¦†ç›–cmd,ç„¶åç”±cmd ä¼ é€’ç»™entrypoint ,åšåˆ°çµæ´»åº”ç”¨ # shellå’Œexecçš„åŒºåˆ« shell æ ¼å¼ä¼šé˜»æ­¢CMDçš„å‚æ•°åŠrunå‘½ä»¤è¡Œå‚æ•°è¢«ä½¿ç”¨ï¼Œä½†æ‰§è¡Œçš„å‘½ä»¤ä¼šå˜æˆshellå­å‘½ä»¤ï¼Œæ— æ³•æ­£å¸¸æ¥æ”¶single æ³¨ï¼šENTRYPOINTä¸CMDéå¸¸ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯é€šè¿‡docker runæ‰§è¡Œçš„å‘½ä»¤ä¸ä¼šè¦†ç›–ENTRYPOINTï¼Œ è€Œdocker runå‘½ä»¤ä¸­æŒ‡å®šçš„ä»»ä½•å‚æ•°ï¼Œéƒ½ä¼šè¢«å½“åšå‚æ•°å†æ¬¡ä¼ é€’ç»™CMDã€‚ Dockerfileä¸­åªå…è®¸æœ‰ä¸€ä¸ªENTRYPOINTå‘½ä»¤ï¼Œå¤šæŒ‡å®šæ—¶ä¼šè¦†ç›–å‰é¢çš„è®¾ç½®ï¼Œ è€Œåªæ‰§è¡Œæœ€åçš„ENTRYPOINTæŒ‡ä»¤ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼ŒENTRYPOINT ä¸CMDä¸€èµ·ä½¿ç”¨ï¼ŒENTRYPOINT å†™é»˜è®¤å‘½ä»¤ï¼Œå½“éœ€è¦å‚æ•°æ—¶å€™ ä½¿ç”¨CMDä¼ å‚\nCMDå’ŒENYPORINTçš„è”åˆä½¿ç”¨ # ENTRYPOINT CMD æ‰§è¡Œç»“æœ æ— å…¥å£ (æ—  ENTRYPOINT) æ— å‘½ä»¤ (æ—  CMD) å®¹å™¨ä¼šé€€å‡ºï¼Œæ— ä»»ä½•åŠ¨ä½œ æ— å…¥å£ (æ—  ENTRYPOINT) exec æ ¼å¼ CMD æ‰§è¡Œ CMD æŒ‡å®šçš„å‘½ä»¤ æ— å…¥å£ (æ—  ENTRYPOINT) shell æ ¼å¼ CMD æ‰§è¡Œ CMD æŒ‡å®šçš„å‘½ä»¤ exec æ ¼å¼ ENTRYPOINT æ— å‘½ä»¤ (æ—  CMD) æ‰§è¡Œ ENTRYPOINT æŒ‡å®šçš„å‘½ä»¤ exec æ ¼å¼ ENTRYPOINT exec æ ¼å¼ CMD ä»¥ CMD çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ ENTRYPOINT æ‰§è¡Œ exec æ ¼å¼ ENTRYPOINT shell æ ¼å¼ CMD CMD ä¼šè¢«ä½œä¸ºå‚æ•°ä¼ é€’ç»™ ENTRYPOINT æ‰§è¡Œï¼ˆshell å‘½ä»¤ï¼‰ shell æ ¼å¼ ENTRYPOINT æ— å‘½ä»¤ (æ—  CMD) æ‰§è¡Œ ENTRYPOINT æŒ‡å®šçš„ shell å‘½ä»¤ shell æ ¼å¼ ENTRYPOINT exec æ ¼å¼ CMD CMD ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™ ENTRYPOINT æ‰§è¡Œï¼Œæ‰§è¡Œ shell å‘½ä»¤ shell æ ¼å¼ ENTRYPOINT shell æ ¼å¼ CMD CMD ä¼šä½œä¸ºå‚æ•°ä¼ é€’ç»™ ENTRYPOINT æ‰§è¡Œï¼Œæ‰§è¡Œ shell å‘½ä»¤ 2.5 LABEL # # æ ¼å¼ï¼š LABEL \u0026lt;key\u0026gt;=\u0026lt;value\u0026gt; \u0026lt;key\u0026gt;=\u0026lt;value\u0026gt; \u0026lt;key\u0026gt;=\u0026lt;value\u0026gt; ... # ç¤ºä¾‹ï¼š LABEL version=\u0026#34;1.0\u0026#34; description=\u0026#34;è¿™æ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨\u0026#34; by=\u0026#34;ITç¬”å½•\u0026#34; æ³¨ï¼š ä½¿ç”¨LABELæŒ‡å®šå…ƒæ•°æ®æ—¶ï¼Œä¸€æ¡LABELæŒ‡å®šå¯ä»¥æŒ‡å®šä¸€æˆ–å¤šæ¡å…ƒæ•°æ®ï¼ŒæŒ‡å®šå¤šæ¡å…ƒæ•°æ®æ—¶ä¸åŒå…ƒæ•°æ® ä¹‹é—´é€šè¿‡ç©ºæ ¼åˆ†éš”ã€‚æ¨èå°†æ‰€æœ‰çš„å…ƒæ•°æ®é€šè¿‡ä¸€æ¡LABELæŒ‡ä»¤æŒ‡å®šï¼Œä»¥å…ç”Ÿæˆè¿‡å¤šçš„ä¸­é—´é•œåƒã€‚ 2.6 ENV # # æ ¼å¼ï¼š ENV \u0026lt;key\u0026gt; \u0026lt;value\u0026gt; #\u0026lt;key\u0026gt;ä¹‹åçš„æ‰€æœ‰å†…å®¹å‡ä¼šè¢«è§†ä¸ºå…¶\u0026lt;value\u0026gt;çš„ç»„æˆéƒ¨åˆ†ï¼Œå› æ­¤ï¼Œä¸€æ¬¡åªèƒ½è®¾ç½®ä¸€ä¸ªå˜é‡ ENV \u0026lt;key\u0026gt;=\u0026lt;value\u0026gt; ... #å¯ä»¥è®¾ç½®å¤šä¸ªå˜é‡ï¼Œæ¯ä¸ªå˜é‡ä¸ºä¸€ä¸ª\u0026#34;\u0026lt;key\u0026gt;=\u0026lt;value\u0026gt;\u0026#34;çš„é”®å€¼å¯¹ï¼Œå¦‚æœ\u0026lt;key\u0026gt;ä¸­åŒ…å«ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨\\æ¥è¿›è¡Œè½¬ä¹‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡\u0026#34;\u0026#34;æ¥è¿›è¡Œæ ‡ç¤ºï¼›å¦å¤–ï¼Œåæ–œçº¿ä¹Ÿå¯ä»¥ç”¨äºç»­è¡Œ # ç¤ºä¾‹ï¼š ENV myName=\u0026#34;John Doe\u0026#34; ENV myDog=Rex\\ The\\ Dog\tENV myCat=fluffy 2.7 EXPOSE # # æ ¼å¼ï¼š EXPOSE \u0026lt;port\u0026gt; [\u0026lt;port\u0026gt;...] # ç¤ºä¾‹ï¼š EXPOSE 80 443 EXPOSE 8080 EXPOSE 11211/tcp 11211/udp æ³¨ï¼šEXPOSEå¹¶ä¸ä¼šè®©å®¹å™¨çš„ç«¯å£è®¿é—®åˆ°ä¸»æœºã€‚è¦ä½¿å…¶å¯è®¿é—®ï¼Œéœ€è¦åœ¨docker runè¿è¡Œå®¹å™¨æ—¶é€šè¿‡-pæ¥å‘å¸ƒè¿™äº›ç«¯å£ï¼Œæˆ–é€šè¿‡-På‚æ•°æ¥å‘å¸ƒEXPOSEå¯¼å‡ºçš„æ‰€æœ‰ç«¯å£ã€‚åªæ˜¯å¢åŠ dockerfileçš„å¯è¯»æ€§ å¦‚æœæ²¡æœ‰æš´éœ²ç«¯å£ï¼ŒåæœŸä¹Ÿå¯ä»¥é€šè¿‡-p 8080:80æ–¹å¼æ˜ å°„ç«¯å£ï¼Œä½†æ˜¯ä¸èƒ½é€šè¿‡-På½¢å¼æ˜ å°„ 2.8 ONBUILD # # æ ¼å¼ï¼šã€€ONBUILD [INSTRUCTION] # ç¤ºä¾‹ï¼š ONBUILD ADD . /app/src ONBUILD RUN /usr/local/bin/python-build --dir /app/src æ³¨ï¼š NNBUIDåé¢è·ŸæŒ‡ä»¤ï¼Œå½“å½“å‰çš„é•œåƒè¢«ç”¨åšå…¶å®ƒé•œåƒçš„åŸºç¡€é•œåƒï¼Œè¯¥é•œåƒä¸­çš„è§¦å‘å™¨å°†ä¼šè¢«é’¥è§¦å‘ 2.9 USER # # æ ¼å¼:ã€€USER userã€€USER user:groupã€€USER uidã€€USER uid:gidã€€USER user:gidã€€USER uid:group # ç¤ºä¾‹ï¼š USER www æ³¨ï¼š ä½¿ç”¨USERæŒ‡å®šç”¨æˆ·åï¼ŒDockerfileä¸­å…¶åçš„å‘½ä»¤RUNã€CMDã€ENTRYPOINTéƒ½å°†ä½¿ç”¨è¯¥ç”¨æˆ·ã€‚ é•œåƒæ„å»ºå®Œæˆåï¼Œé€šè¿‡docker runè¿è¡Œå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡-uå‚æ•°æ¥è¦†ç›–æ‰€æŒ‡å®šçš„ç”¨æˆ·ã€‚ # æ ¼å¼ SHELL [\u0026#34;executable\u0026#34;, \u0026#34;parameters\u0026#34;] - executableï¼šè¦ä½¿ç”¨çš„ shell å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚ /bin/bash æˆ– /bin/sh ç­‰ï¼‰ã€‚ - parametersï¼šä¼ é€’ç»™ shell çš„å‚æ•°ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ # ç¤ºä¾‹ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker ä½¿ç”¨ /bin/sh -c æ¥æ‰§è¡Œå‘½ä»¤ï¼‰ SHELL [\u0026#34;/bin/bash\u0026#34;, \u0026#34;-c\u0026#34;] #ä½¿ç”¨ bash æ›¿ä»£é»˜è®¤çš„ sh RUN echo \u0026#34;Hello from Bash!\u0026#34; # åç»­å‘½ä»¤å°†ä½¿ç”¨ bash æ‰§è¡Œ # æ³¨æ„ SHELL æŒ‡ä»¤åœ¨ Dockerfile ä¸­æ˜¯å…¨å±€ç”Ÿæ•ˆçš„ï¼Œè¿™æ„å‘³ç€å®ƒä¼šå½±å“ Dockerfile ä¸­åç»­çš„æ‰€æœ‰å‘½ä»¤ï¼ˆå¦‚ RUN, CMD, ENTRYPOINT ç­‰ï¼‰ã€‚ SHELL åªå½±å“å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤æ—¶ä½¿ç”¨çš„ shell ç±»å‹ï¼Œä¸ä¼šå½±å“å®¹å™¨å¯åŠ¨æ—¶çš„ shell ç±»å‹ å…«ã€Dockeræ—¥å¿—ç®¡ç† # 1. Docker æ—¥å¿—é©±åŠ¨ï¼ˆLogging Driversï¼‰ # Docker æä¾›äº†å¤šç§æ—¥å¿—é©±åŠ¨ï¼Œå¯ä»¥é€‰æ‹©é€‚åˆè‡ªå·±éœ€æ±‚çš„æ–¹å¼æ¥è®°å½•å’Œç®¡ç†å®¹å™¨æ—¥å¿—ã€‚æ¯ä¸ªå®¹å™¨å¯ä»¥é…ç½®ä¸åŒçš„æ—¥å¿—é©±åŠ¨ï¼ŒDocker é»˜è®¤ä½¿ç”¨çš„æ—¥å¿—é©±åŠ¨æ˜¯ json-fileã€‚åœ¨å¯åŠ¨å®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ --log-driver å‚æ•°æŒ‡å®šæ—¥å¿—é©±åŠ¨ã€‚\nå¸¸è§çš„æ—¥å¿—é©±åŠ¨æœ‰ï¼š\næ—¥å¿—é©±åŠ¨ æè¿° ç¤ºä¾‹ json-file é»˜è®¤çš„æ—¥å¿—é©±åŠ¨ï¼Œæ—¥å¿—ä»¥ JSON æ ¼å¼å­˜å‚¨åœ¨å®¿ä¸»æœºä¸Šçš„æ–‡ä»¶ä¸­ã€‚æ¯ä¸ªæ—¥å¿—æ¡ç›®åŒ…å«äº†æ—¶é—´æˆ³ã€æ—¥å¿—çº§åˆ«ã€æ¶ˆæ¯ç­‰ä¿¡æ¯ã€‚ docker run --log-driver=json-file ... syslog å°†æ—¥å¿—å‘é€åˆ°å®¿ä¸»æœºçš„ syslog æœåŠ¡ã€‚é€‚ç”¨äºéœ€è¦é›†æˆç³»ç»Ÿæ—¥å¿—æ”¶é›†çš„åœºæ™¯ã€‚ docker run --log-driver=syslog ... journald å°†æ—¥å¿—å‘é€åˆ° systemd çš„ journal æœåŠ¡ã€‚é€‚ç”¨äºåŸºäº systemd çš„ Linux ç³»ç»Ÿã€‚ docker run --log-driver=journald ... fluentd å°†æ—¥å¿—å‘é€åˆ° Fluentdï¼Œç”¨äºé›†æˆæ—¥å¿—æ”¶é›†å’Œåˆ†æç³»ç»Ÿã€‚ docker run --log-driver=fluentd ... gelf ä½¿ç”¨ Graylog Extended Log Format (GELF)ï¼Œé€šå¸¸ä¸ Graylog é…åˆä½¿ç”¨ã€‚é€‚ç”¨äºå¤§è§„æ¨¡æ—¥å¿—èšåˆå’Œåˆ†æã€‚ docker run --log-driver=gelf ... awslogs å°†æ—¥å¿—å‘é€åˆ° AWS CloudWatch Logsï¼Œé€‚ç”¨äºåœ¨ AWS ç¯å¢ƒä¸­ç®¡ç†æ—¥å¿—ã€‚ docker run --log-driver=awslogs ... splunk å°†æ—¥å¿—å‘é€åˆ° Splunk æ—¥å¿—ç®¡ç†ç³»ç»Ÿã€‚ docker run --log-driver=splunk ... none ç¦ç”¨å®¹å™¨æ—¥å¿—ï¼Œä¸æ”¶é›†ä»»ä½•æ—¥å¿—ã€‚ docker run --log-driver=none ... è®¾ç½®æ—¥å¿—é©±åŠ¨ # å¯ä»¥åœ¨å®¹å™¨å¯åŠ¨æ—¶é€šè¿‡ --log-driver å‚æ•°æŒ‡å®šæ—¥å¿—é©±åŠ¨ã€‚ä¾‹å¦‚ï¼š\nbashCopy Codedocker run --log-driver=syslog my-container ä¹Ÿå¯ä»¥åœ¨ Docker å®ˆæŠ¤è¿›ç¨‹é…ç½®æ–‡ä»¶ä¸­è®¾ç½®é»˜è®¤çš„æ—¥å¿—é©±åŠ¨ï¼Œè¿™æ ·æ‰€æœ‰å®¹å™¨éƒ½ä¼šä½¿ç”¨è¯¥æ—¥å¿—é©±åŠ¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ /etc/docker/daemon.json æ–‡ä»¶ä¸­æ·»åŠ ï¼š\njsonCopy Code{ \u0026#34;log-driver\u0026#34;: \u0026#34;fluentd\u0026#34; } 2. æŸ¥çœ‹ Docker å®¹å™¨æ—¥å¿— # ä¸åŒçš„æ—¥å¿—é©±åŠ¨å­˜å‚¨æ—¥å¿—çš„æ–¹å¼ä¸åŒï¼Œä½†æ— è®ºä½¿ç”¨å“ªç§é©±åŠ¨ï¼ŒDocker éƒ½æä¾›äº†åŸºæœ¬çš„å‘½ä»¤æ¥æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—ã€‚\næŸ¥çœ‹å®¹å™¨æ—¥å¿—ï¼šä½¿ç”¨ docker logs å‘½ä»¤æ¥æŸ¥çœ‹æŸä¸ªå®¹å™¨çš„æ—¥å¿—ã€‚è¯¥å‘½ä»¤æ”¯æŒå®æ—¶æŸ¥çœ‹ã€è¿‡æ»¤ã€åˆ†é¡µç­‰æ“ä½œã€‚ bashCopy Codedocker logs \u0026lt;container_id or container_name\u0026gt; å¸¸ç”¨é€‰é¡¹\n-f æˆ– --followï¼šå®æ—¶è·Ÿè¸ªæ—¥å¿—è¾“å‡ºï¼Œç±»ä¼¼äº tail -fã€‚ --sinceï¼šæŸ¥çœ‹æŒ‡å®šæ—¶é—´ä¹‹åçš„æ—¥å¿—ã€‚ --tailï¼šæ˜¾ç¤ºæœ€å N è¡Œæ—¥å¿—ã€‚ -tï¼šæ˜¾ç¤ºæ—¥å¿—çš„æ—¶é—´æˆ³ã€‚ ä¾‹å¦‚ï¼ŒæŸ¥çœ‹å®¹å™¨ my-container çš„æ—¥å¿—å¹¶å®æ—¶è·Ÿè¸ªè¾“å‡ºï¼š\nbashCopy Codedocker logs -f --since=\u0026#34;2024-12-05T10:00:00\u0026#34; my-container 3. Docker æ—¥å¿—çš„å­˜å‚¨ä¸ç®¡ç† # Docker é»˜è®¤å°†å®¹å™¨æ—¥å¿—å­˜å‚¨åœ¨å®¿ä¸»æœºçš„ /var/lib/docker/containers/\u0026lt;container-id\u0026gt;/ ç›®å½•ä¸­ï¼Œæ—¥å¿—æ–‡ä»¶åä¸º container-id-json.logã€‚è¿™å¯¹äº json-file æ—¥å¿—é©±åŠ¨æœ‰æ•ˆï¼Œå…¶ä»–æ—¥å¿—é©±åŠ¨å¯èƒ½å°†æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„åœ°æ–¹ã€‚\njson-file é©±åŠ¨æ—¥å¿—æ ¼å¼ï¼š # æ—¶é—´æˆ³ æ—¥å¿—çº§åˆ« æ—¥å¿—æ¶ˆæ¯ ä¾‹å¦‚ï¼Œé»˜è®¤çš„æ—¥å¿—æ–‡ä»¶ /var/lib/docker/containers/\u0026lt;container-id\u0026gt;/\u0026lt;container-id\u0026gt;-json.log å¯èƒ½åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š\njsonCopy Code{\u0026#34;log\u0026#34;:\u0026#34;Hello, World!\\n\u0026#34;,\u0026#34;stream\u0026#34;:\u0026#34;stdout\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-12-05T10:00:00.000000000Z\u0026#34;} {\u0026#34;log\u0026#34;:\u0026#34;Error: Something went wrong!\\n\u0026#34;,\u0026#34;stream\u0026#34;:\u0026#34;stderr\u0026#34;,\u0026#34;time\u0026#34;:\u0026#34;2024-12-05T10:01:00.000000000Z\u0026#34;} æ—¥å¿—è½®è½¬å’Œæ—¥å¿—å¤§å°é™åˆ¶ # å¯¹äº json-file é©±åŠ¨ï¼ŒDocker æä¾›äº†æ—¥å¿—è½®è½¬åŠŸèƒ½ï¼Œé€šè¿‡é…ç½® max-size å’Œ max-file æ¥é™åˆ¶æ—¥å¿—æ–‡ä»¶çš„å¤§å°å’Œæ•°é‡ã€‚\nmax-sizeï¼šæ¯ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ã€‚ max-fileï¼šæœ€å¤šä¿ç•™å¤šå°‘ä¸ªæ—¥å¿—æ–‡ä»¶ã€‚ ä¾‹å¦‚ï¼Œåœ¨å¯åŠ¨å®¹å™¨æ—¶è®¾ç½®æ—¥å¿—è½®è½¬ï¼š\nbashCopy Codedocker run --log-driver=json-file --log-opt max-size=10m --log-opt max-file=3 my-container è¿™è¡¨ç¤ºæ¯ä¸ªæ—¥å¿—æ–‡ä»¶çš„æœ€å¤§å¤§å°ä¸º 10MBï¼Œæœ€å¤šä¿ç•™ 3 ä¸ªæ–‡ä»¶ï¼Œè¾¾åˆ°é™åˆ¶æ—¶ä¼šè¿›è¡Œè½®è½¬ã€‚\n4. é›†ä¸­å¼æ—¥å¿—æ”¶é›†ä¸åˆ†æ # å¯¹äºç”Ÿäº§ç¯å¢ƒä¸­çš„å®¹å™¨ï¼Œé€šå¸¸ä¼šä½¿ç”¨é›†ä¸­å¼æ—¥å¿—æ”¶é›†å’Œåˆ†æå·¥å…·æ¥ç®¡ç†æ—¥å¿—ã€‚å¸¸è§çš„å·¥å…·å’Œæ–¹æ¡ˆåŒ…æ‹¬ï¼š\nELK Stackï¼šElasticsearch, Logstash, Kibanaã€‚Logstash ä½œä¸ºæ—¥å¿—æ”¶é›†å·¥å…·å°†æ—¥å¿—å‘é€åˆ° Elasticsearchï¼ŒKibana ç”¨äºåˆ†æå’Œå¯è§†åŒ–æ—¥å¿—æ•°æ®ã€‚ Fluentdï¼šä½œä¸ºæ—¥å¿—æ”¶é›†å’Œè½¬å‘å·¥å…·ï¼Œå°†æ—¥å¿—å‘é€åˆ°å…¶ä»–æ—¥å¿—ç®¡ç†ç³»ç»Ÿï¼ˆå¦‚ Elasticsearchã€Kafka ç­‰ï¼‰ã€‚ Graylogï¼šä¸€ä¸ªå¼€æºçš„æ—¥å¿—ç®¡ç†å¹³å°ï¼Œæ”¯æŒé›†æˆå¤šç§æ—¥å¿—æ¥æºã€‚ Splunkï¼šä¸€ä¸ªå•†ä¸šåŒ–çš„æ—¥å¿—åˆ†æå¹³å°ï¼Œå¹¿æ³›ç”¨äºä¼ä¸šçº§æ—¥å¿—ç®¡ç†å’Œç›‘æ§ã€‚ 5. æ—¥å¿—åˆ†æå’Œç›‘æ§ # é™¤äº†æŸ¥çœ‹å®¹å™¨æ—¥å¿—å¤–ï¼Œæ—¥å¿—åˆ†æå’Œç›‘æ§å·¥å…·èƒ½å¤Ÿå¸®åŠ©è‡ªåŠ¨åŒ–åœ°è¯†åˆ«å’ŒæŠ¥è­¦ï¼Œå°¤å…¶æ˜¯åœ¨å¤§è§„æ¨¡å®¹å™¨åŒ–ç¯å¢ƒä¸­ã€‚ç»“åˆ Prometheusã€Grafana ç­‰å·¥å…·ï¼Œå¯ä»¥å¯¹æ—¥å¿—è¿›è¡Œé›†ä¸­çš„ç›‘æ§å’Œå¯è§†åŒ–ã€‚\nä½¿ç”¨ Prometheus + Grafana ç›‘æ§ Docker æ—¥å¿—ï¼š # Prometheusï¼šæ”¶é›†å’Œå­˜å‚¨æ¥è‡ª Docker å®¹å™¨çš„åº¦é‡æ•°æ®ã€‚ Grafanaï¼šç”¨æ¥æ˜¾ç¤ºå’Œåˆ†æè¿™äº›åº¦é‡æ•°æ®ã€‚ é€šè¿‡å®‰è£… Docker çš„ cAdvisor æˆ– Prometheus é‡‡é›†å™¨ï¼Œå¯ä»¥å®šæœŸæŠ“å– Docker å®¹å™¨çš„æ—¥å¿—æ•°æ®ï¼Œè¿›ä¸€æ­¥åšå¥åº·æ£€æŸ¥ã€æ€§èƒ½åˆ†æç­‰ã€‚\næ€»ç»“ # Docker æä¾›äº†å¤šç§æ—¥å¿—ç®¡ç†æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡ä¸åŒçš„æ—¥å¿—é©±åŠ¨ã€é…ç½®é€‰é¡¹å’Œé›†ä¸­å¼æ—¥å¿—ç³»ç»Ÿæ¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚æ ¹æ®å®é™…çš„ç”Ÿäº§ç¯å¢ƒéœ€æ±‚ï¼Œå¯ä»¥é€‰æ‹©åˆé€‚çš„æ—¥å¿—é©±åŠ¨ï¼ˆå¦‚ json-fileã€syslogã€fluentd ç­‰ï¼‰ï¼Œå¹¶é…ç½®æ—¥å¿—çš„è½®è½¬ã€å­˜å‚¨å’Œåˆ†ææœºåˆ¶ï¼Œä»¥å®ç°é«˜æ•ˆçš„æ—¥å¿—ç®¡ç†å’Œé—®é¢˜æ’æŸ¥ã€‚\nä¹ã€Docker Compose # Docker Composeè¦è§£å†³çš„é—®é¢˜æ˜¯éƒ¨ç½²å’Œç®¡ç†ç¹å¤šçš„æœåŠ¡ï¼ŒDocker Composeå¹¶ä¸æ˜¯é€šè¿‡è„šæœ¬å’Œå„ç§å†—é•¿çš„docker å‘½ä»¤æ¥å°†åº”ç”¨ç»„ä»¶ç»„ç»‡èµ·æ¥ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå£°æ˜å¼çš„é…ç½®æ–‡ä»¶æè¿°æ•´ä¸ªåº”ç”¨ï¼Œä»è€Œä½¿ç”¨ä¸€æ¡å‘½ä»¤å®Œæˆéƒ¨ç½²ã€‚\nä¸‹è½½åœ°å€\n1.docker-composeçš„ä½¿ç”¨ # å¤šå®¹å™¨åº”ç”¨ç®¡ç† Docker Compose å¯ä»¥å®šä¹‰å¤šä¸ªæœåŠ¡ï¼ˆæœåŠ¡æ˜¯æŒ‡ Docker å®¹å™¨ä¸­çš„åº”ç”¨ï¼‰ï¼Œè¿™äº›æœåŠ¡å¯ä»¥åœ¨ä¸€ä¸ª YAML æ–‡ä»¶ä¸­é…ç½®ï¼ŒCompose ä¼šåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºå¹¶å¯åŠ¨è¿™äº›æœåŠ¡ã€‚å¸¸è§çš„åœºæ™¯å¦‚ï¼šWeb åº”ç”¨ï¼ˆå‰ç«¯ï¼‰ã€æ•°æ®åº“ã€ç¼“å­˜æœåŠ¡ç­‰å¤šä¸ªå®¹å™¨çš„ç»„åˆã€‚ å¼€å‘ä¸æµ‹è¯•ç¯å¢ƒçš„è‡ªåŠ¨åŒ–éƒ¨ç½² åœ¨å¼€å‘å’Œæµ‹è¯•é˜¶æ®µï¼Œå¼€å‘äººå‘˜å¾€å¾€éœ€è¦å¯åŠ¨å¤šä¸ªä¾èµ–æœåŠ¡ï¼ˆä¾‹å¦‚æ•°æ®åº“ã€ç¼“å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰ï¼‰ï¼Œdocker-compose å¯ä»¥ä¸€æ¬¡æ€§å¯åŠ¨è¿™äº›æœåŠ¡ï¼Œç¡®ä¿å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸€è‡´æ€§ã€‚ ç®€åŒ–é…ç½®ä¸æ‰©å±• ä½¿ç”¨ docker-compose.yml é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å°†æœåŠ¡çš„é…ç½®é›†ä¸­ç®¡ç†ï¼Œé€šè¿‡å£°æ˜å¼çš„æ–¹å¼æ–¹ä¾¿ä¿®æ”¹å’Œæ›´æ–°é…ç½®ã€‚å¯¹äºä¸åŒçš„ç¯å¢ƒï¼ˆå¦‚å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ Compose é…ç½®æ–‡ä»¶ï¼Œè½»æ¾åˆ‡æ¢ã€‚ ç‰ˆæœ¬æ§åˆ¶ä¸å…±äº« ç”±äº docker-compose.yml æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¼€å‘è€…å¯ä»¥å°†å…¶æ·»åŠ åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼ˆå¦‚ Gitï¼‰ï¼Œå¹¶ä¸å›¢é˜Ÿæˆå‘˜å…±äº«ï¼Œä»è€Œç¡®ä¿æ¯ä¸ªäººåœ¨ç›¸åŒçš„ç¯å¢ƒä¸‹å·¥ä½œã€‚ 2. docker-composeçš„yaml # docker-compose.yml æ–‡ä»¶æ˜¯ Docker Compose çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ YAML æ ¼å¼å®šä¹‰ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ã€‚\nversion: \u0026#34;3.8\u0026#34; # æŒ‡å®š Compose æ–‡ä»¶çš„ç‰ˆæœ¬ services: # æœåŠ¡éƒ¨åˆ†ï¼Œå®šä¹‰å„ä¸ªå®¹å™¨ web: # æœåŠ¡åç§° image: nginx:latest # ä½¿ç”¨çš„é•œåƒ ports: - \u0026#34;8080:80\u0026#34; # æ˜ å°„ç«¯å£ volumes: - ./html:/usr/share/nginx/html # æ˜ å°„æœ¬åœ°æ–‡ä»¶å¤¹åˆ°å®¹å™¨ db: image: mysql:5.7 environment: MYSQL_ROOT_PASSWORD: example volumes: - db-data:/var/lib/mysql # ä½¿ç”¨å‘½åå· redis: image: redis:alpine ports: - \u0026#34;6379:6379\u0026#34; volumes: # å®šä¹‰æ•°æ®å· db-data: æ£€æµ‹docker-composeé…ç½® # docker-compose config # æ£€æŸ¥é…ç½® docker-compose config -q # æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡º 3. docker-composeçš„ç›¸å…³å‘½ä»¤ # Docker Compose å¸¸ç”¨å‘½ä»¤ # å‘½ä»¤ åŠŸèƒ½ ç¤ºä¾‹ docker-compose up å¯åŠ¨æ‰€æœ‰å®šä¹‰çš„æœåŠ¡å®¹å™¨ï¼Œå¹¶åœ¨åå°è¿è¡Œã€‚å¦‚æœæœåŠ¡æœªæ„å»ºï¼Œä¼šè‡ªåŠ¨æ„å»ºã€‚ docker-compose up æˆ– docker-compose up -dï¼ˆåå°è¿è¡Œï¼‰ docker-compose down åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰å®¹å™¨ã€ç½‘ç»œã€å·ç­‰èµ„æºã€‚ docker-compose down docker-compose build æ„å»ºæˆ–é‡æ–°æ„å»ºæœåŠ¡çš„é•œåƒï¼ˆå¦‚æœé…ç½®äº† buildï¼‰ã€‚ docker-compose build docker-compose logs æŸ¥çœ‹æœåŠ¡çš„æ—¥å¿—è¾“å‡ºã€‚ docker-compose logs æˆ– docker-compose logs \u0026lt;æœåŠ¡å\u0026gt; docker-compose ps æŸ¥çœ‹è¿è¡Œä¸­çš„å®¹å™¨åŠå…¶çŠ¶æ€ã€‚ docker-compose ps docker-compose exec åœ¨è¿è¡Œä¸­çš„å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤ï¼ˆä¾‹å¦‚è¿›å…¥å®¹å™¨çš„ bashï¼‰ã€‚ docker-compose exec web bash docker-compose stop åœæ­¢è¿è¡Œä¸­çš„å®¹å™¨ï¼Œä½†ä¸åˆ é™¤ã€‚ docker-compose stop docker-compose restart é‡å¯æœåŠ¡å®¹å™¨ã€‚ docker-compose restart ","date":"2025-12-03 22:26","externalUrl":null,"permalink":"/docs/docker/docker%E5%AD%98%E5%82%A8%E5%8F%8A%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C/","section":"Docs","summary":"æ•°æ®æŒä¹…åŒ–å’Œè‡ªå®šä¹‰é•œåƒæ˜¯Dockerè¿›é˜¶ä½¿ç”¨çš„å…³é”®ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•é€šè¿‡å·(Volumes)å’Œç»‘å®šæŒ‚è½½(Bind Mounts)ç®¡ç†æ•°æ®ï¼Œä»¥åŠå¦‚ä½•ä»é›¶å¼€å§‹ç¼–å†™Dockerfileæ¥æ„å»ºç¬¦åˆè‡ªå·±éœ€æ±‚çš„åº”ç”¨é•œåƒ","title":"Dockerå­˜å‚¨åŠé•œåƒåˆ¶ä½œ","type":"docs"},{"content":" äºŒã€Dockeré•œåƒç®¡ç† # 1. æŸ¥çœ‹ã€æŸ¥æ‰¾é•œåƒ # ä½¿ç”¨ docker images å‘½ä»¤å¯ä»¥åˆ—å‡ºæœ¬åœ°ç³»ç»Ÿä¸Šæ‰€æœ‰çš„ Docker é•œåƒï¼ŒåŒ…æ‹¬é•œåƒçš„ä»“åº“åç§°ã€æ ‡ç­¾ã€é•œåƒ IDã€åˆ›å»ºæ—¶é—´å’Œå¤§å°ç­‰ä¿¡æ¯ã€‚\ndocker images è¾“å‡ºç¤ºä¾‹ï¼š\nREPOSITORY TAG IMAGE ID CREATED SIZE nginx latest 7f7b05e59d6a 2 weeks ago 142MB ubuntu 20.04 8d5c9eec5b6a 3 weeks ago 64.2MB docker search [OPTIONS] é•œåƒåå­— å‚æ•°ï¼š --limit nu #åªè¾“å‡ºæŸ¥åˆ°çš„å‰nuæ¡è®°å½• docker search redis --limit 3 # æ”¾åœ¨é•œåƒåç§°å‰é¢åé¢å‡å¯ å­—æ®µè§£æï¼š NAMEï¼šé•œåƒåç§° DISCRIPTIONï¼šé•œåƒè¯´æ˜ STARTSï¼šç‚¹èµæ•° OFFICALï¼šæ˜¯å¦æ˜¯å®˜æ–¹è®¤å¯çš„ AUTOMATEDï¼šæ˜¯å¦è‡ªåŠ¨æ„å»º 2. æ‹‰å–é•œåƒï¼ˆPullï¼‰ # ä» Docker Hub æˆ–å…¶ä»–é•œåƒä»“åº“æ‹‰å–é•œåƒåˆ°æœ¬åœ°ã€‚ä½¿ç”¨ docker pull å‘½ä»¤æ¥ä¸‹è½½é•œåƒã€‚é»˜è®¤ä» Docker Hub æ‹‰å–é•œåƒã€‚\ndocker pull \u0026lt;image_name\u0026gt;:\u0026lt;tag\u0026gt; ä¾‹å¦‚ï¼Œæ‹‰å–æœ€æ–°çš„ Ubuntu é•œåƒï¼š\ndocker pull ubuntu:20.04 å¦‚æœæ²¡æœ‰æŒ‡å®šæ ‡ç­¾ï¼Œé»˜è®¤æ‹‰å– latest æ ‡ç­¾çš„é•œåƒã€‚\né•œåƒéš¾ä»¥æ‹‰å–ï¼Œåˆ™éœ€è¦åœ¨ /etc/daocker/daemon.json é…ç½®åŠ é€Ÿå™¨\n3. æ„å»ºé•œåƒï¼ˆBuildï¼‰ # ä½¿ç”¨ docker build å‘½ä»¤æ ¹æ® Dockerfile æ„å»ºé•œåƒã€‚Dockerfile æ˜¯ä¸€ä¸ªåŒ…å«é•œåƒæ„å»ºæ­¥éª¤çš„æ–‡æœ¬æ–‡ä»¶ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•ä»åŸºç¡€é•œåƒåˆ›å»ºæ–°çš„é•œåƒã€‚\nDockerfileæœ‰å¤šä¸ªé‡è¦æŒ‡ä»¤ï¼Œåé¢ä¼šè¯´æ˜\næ„å»ºé•œåƒçš„å‘½ä»¤ï¼š\ndocker build -t \u0026lt;image_name\u0026gt;:\u0026lt;tag\u0026gt; \u0026lt;path_to_dockerfile\u0026gt; ä¾‹å¦‚ï¼Œåœ¨å½“å‰ç›®å½•æ„å»ºä¸€ä¸ªåä¸º my-app çš„é•œåƒï¼š\ndocker build -t my-app:latest . 4. é•œåƒæ ‡ç­¾ï¼ˆTaggingï¼‰ # é•œåƒæ ‡ç­¾ç”¨äºæ ‡è¯†é•œåƒçš„ä¸åŒç‰ˆæœ¬ã€‚æ¯ä¸ªé•œåƒé»˜è®¤æœ‰ä¸€ä¸ªæ ‡ç­¾ latestï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ docker tag å‘½ä»¤ä¸ºé•œåƒæ‰“ä¸Šæ–°çš„æ ‡ç­¾ã€‚\ndocker tag \u0026lt;image_id\u0026gt; \u0026lt;new_image_name\u0026gt;:\u0026lt;new_tag\u0026gt; ä¾‹å¦‚ï¼Œä¸º my-app é•œåƒæ‰“ä¸Šç‰ˆæœ¬æ ‡ç­¾ï¼š\ndocker tag my-app:latest my-app:v1.0 5. æ¨é€é•œåƒï¼ˆPushï¼‰ # å°†æœ¬åœ°é•œåƒä¸Šä¼ åˆ° Docker ä»“åº“ï¼ˆå¦‚ Docker Hub æˆ–ç§æœ‰ä»“åº“ï¼‰ã€‚é¦–å…ˆéœ€è¦ç™»å½• Docker ä»“åº“ï¼š\ndocker login ç„¶åä½¿ç”¨ docker push å°†é•œåƒæ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼š\ndocker push \u0026lt;image_name\u0026gt;:\u0026lt;tag\u0026gt; ä¾‹å¦‚ï¼Œæ¨é€ my-app:latest é•œåƒåˆ° Docker Hubï¼š\ndocker push my-app:latest 6. åˆ é™¤é•œåƒï¼ˆRemoveï¼‰ # å¦‚æœä¸å†éœ€è¦æŸä¸ªé•œåƒï¼Œå¯ä»¥ä½¿ç”¨ docker rmi å‘½ä»¤åˆ é™¤å®ƒã€‚åˆ é™¤é•œåƒæ—¶ï¼ŒDocker ä¼šæ£€æŸ¥è¯¥é•œåƒæ˜¯å¦è¢«å®¹å™¨ä½¿ç”¨ï¼Œè‹¥è¢«ä½¿ç”¨åˆ™æ— æ³•åˆ é™¤ã€‚\ndocker rmi \u0026lt;image_name\u0026gt;:\u0026lt;tag\u0026gt; ä¾‹å¦‚ï¼Œåˆ é™¤ my-app:latest é•œåƒï¼š\ndocker rmi my-app:latest å¦‚æœé•œåƒè¢«å¤šä¸ªæ ‡ç­¾å¼•ç”¨ï¼Œå¯ä»¥ä¸€æ¬¡æ€§åˆ é™¤å¤šä¸ªæ ‡ç­¾çš„é•œåƒï¼š\ndocker rmi \u0026lt;image_id\u0026gt; å¦‚æœæ²¡æœ‰åˆ é™¤æ‰€æœ‰çš„é•œåƒï¼Œæ€åªä¼šè§£é™¤å½“å‰é•œåƒçš„tagï¼Œè€Œä¸ä¼šåˆ é™¤æºé•œåƒ\n#åˆ å…¨éƒ¨ docker rmi -f $(docker images -qa) 7. æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ # Docker ä¼šäº§ç”Ÿå¾ˆå¤šæ²¡æœ‰è¢«ä½¿ç”¨çš„é•œåƒï¼Œè¿™äº›é•œåƒä¼šå ç”¨ç£ç›˜ç©ºé—´ã€‚ä½¿ç”¨ docker system prune æˆ– docker image prune å‘½ä»¤æ¸…ç†æœªä½¿ç”¨çš„é•œåƒã€å®¹å™¨ã€ç½‘ç»œå’Œæ„å»ºç¼“å­˜ã€‚\ndocker system prune 8. æŸ¥çœ‹é•œåƒå†å² # ä½¿ç”¨ docker history å‘½ä»¤å¯ä»¥æŸ¥çœ‹é•œåƒçš„æ„å»ºå†å²ã€‚å®ƒåˆ—å‡ºäº†é•œåƒçš„æ¯ä¸€å±‚åŠå…¶åˆ›å»ºçš„å‘½ä»¤ã€‚\ndocker history \u0026lt;image_name\u0026gt;:\u0026lt;tag\u0026gt; ä¾‹å¦‚ï¼ŒæŸ¥çœ‹ ubuntu:20.04 é•œåƒçš„å†å²ï¼š\ndocker history ubuntu:20.04 9. é•œåƒä»“åº“ # Docker é•œåƒé€šå¸¸å­˜å‚¨åœ¨ä»“åº“ä¸­ã€‚Docker Hub æ˜¯é»˜è®¤çš„å…¬å…±é•œåƒä»“åº“ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥ä½¿ç”¨ç§æœ‰ä»“åº“å­˜å‚¨é•œåƒã€‚å¸¸è§çš„ Docker é•œåƒä»“åº“æœ‰ï¼š\nDocker Hubï¼šDocker å®˜æ–¹å…¬å…±é•œåƒä»“åº“ ç§æœ‰é•œåƒä»“åº“ï¼šé€šè¿‡ Docker Registry åˆ›å»ºè‡ªå·±çš„ç§æœ‰é•œåƒä»“åº“ï¼Œé€‚åˆä¼ä¸šå†…éƒ¨ä½¿ç”¨ 10. å¯¼å…¥åŠå¯¼å‡ºé•œåƒ # å¯¼å‡ºé•œåƒä¸ºtaråŒ… # # ç›´æ¥å¯¼å‡ºä¸ºtaråŒ… docker save -o image.tar image:tag docker save image_id -o /home/mysql.tar docker save image_id \u0026gt; /home/mysql.tar #å¯¼å‡ºå¤šä¸ªé•œåƒä¸º1ä¸ªtaråŒ… docker save -o \u0026lt;output-file.tar\u0026gt; \u0026lt;image1\u0026gt;:\u0026lt;tag1\u0026gt; \u0026lt;image2\u0026gt;:\u0026lt;tag2\u0026gt; ... å¯¼å…¥taråŒ…ä¸ºé•œåƒ # docker load -i mysql.tar [root@localhostÂ ~]#Â dockerÂ loadÂ -iÂ /usr/local/rancher-v2.3.5.tar 43c67172d1d1:Â LoadingÂ layerÂ [==================================================\u0026gt;]Â 65.57MB/65.57MB 21ec61b65b20:Â LoadingÂ layerÂ [==============================...... c22c9a5a8211:Â LoadingÂ layerÂ [==================================================\u0026gt;]Â 3.072kB/3.072kB LoadedÂ image:Â rancher/rancher:v2.3.5 11. å¤‡ä»½é•œåƒ # docker save $(docker images | sed 1d | awk â€˜{print $1}â€™) \u0026gt; centos-all.tar å¸¸è§é•œåƒå‘½ä»¤æ€»ç»“ # å‘½ä»¤ ä½œç”¨ docker images åˆ—å‡ºæ‰€æœ‰æœ¬åœ°é•œåƒ docker pull \u0026lt;image_name\u0026gt; ä»ä»“åº“æ‹‰å–é•œåƒ docker build -t \u0026lt;name\u0026gt;:\u0026lt;tag\u0026gt; æ ¹æ® Dockerfile æ„å»ºé•œåƒ docker tag \u0026lt;image\u0026gt; \u0026lt;new_tag\u0026gt; ä¸ºé•œåƒæ·»åŠ æ ‡ç­¾ docker push \u0026lt;image\u0026gt; æ¨é€é•œåƒåˆ°è¿œç¨‹ä»“åº“ docker rmi \u0026lt;image\u0026gt; åˆ é™¤æœ¬åœ°é•œåƒ docker system prune æ¸…ç†æ— ç”¨çš„é•œåƒã€å®¹å™¨ã€ç½‘ç»œç­‰ docker save -o ä¿å­˜é•œåƒåˆ°æœ¬åœ° docker load -i å¯¼å…¥æœ¬åœ°é•œåƒ ä¸‰ã€Dockerå®¹å™¨ç®¡ç† # 1. å®¹å™¨æ¦‚è¿° # 1.1 ä»€ä¹ˆæ˜¯å®¹å™¨ # é€šè¿‡Imageåˆ›å»º(copy) åœ¨Image layerä¹‹ä¸Šå»ºç«‹ä¸€ä¸ªcontainer layerï¼ˆå¯è¯»å†™ï¼‰ ç±»æ¯”é¢å‘å¯¹è±¡ï¼šç±»å’Œå®ä¾‹ Imageè´Ÿè´£appçš„å­˜å‚¨å’Œåˆ†å‘ï¼ŒContainerè´Ÿè´£è¿è¡Œapp 1.2 å®¹å™¨ä¸é•œåƒçš„å…³ç³» # é•œåƒï¼šé•œåƒæ˜¯åªè¯»æ–‡ä»¶ï¼Œæä¾›è¿è¡Œç¨‹åºå®Œæ•´çš„è½¯ç¡¬ä»¶èµ„æºã€‚ å®¹å™¨ï¼šå®¹å™¨æ˜¯é•œåƒçš„å®ä¾‹ï¼Œç”±dockerè´Ÿè´£åˆ›å»ºï¼Œå®¹å™¨ä¹‹é—´å½¼æ­¤éš”ç¦» 2. å®¹å™¨çš„ä½¿ç”¨ # 2.1 å¯åŠ¨å®¹å™¨ï¼ˆRunï¼‰ # ä½¿ç”¨ docker run å‘½ä»¤å¯ä»¥ä»é•œåƒå¯åŠ¨ä¸€ä¸ªæ–°çš„å®¹å™¨ï¼Œå¹¶è¿è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚è¯¥å‘½ä»¤ä¹Ÿå¯ç”¨æ¥è®¾ç½®å®¹å™¨çš„ç¯å¢ƒå˜é‡ã€æŒ‚è½½å·ã€è®¾ç½®ç«¯å£æ˜ å°„ç­‰ã€‚\ndocker run [OPTIONS] \u0026lt;image_name\u0026gt; [COMMAND] ä¾‹å¦‚ï¼Œä½¿ç”¨ nginx é•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶å°†æœ¬åœ° 80 ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„ 80 ç«¯å£ï¼š\ndocker run -d -p 80:80 --name my-nginx nginx egï¼š ä»¥ubuntuä¸ºä¾‹ï¼Œå¯åŠ¨åè¦äº¤äº’å…ˆå£°æ˜äº¤äº’æ¨¡å¼ï¼Œå…¶æ¬¡äº¤äº’å¾—éœ€è¦ä¸€ä¸ªç»ˆç«¯ï¼Œå› æ­¤å‚æ•°ä¸º-it docker run -it ubuntu /bin/bash #ä¼ªç»ˆç«¯ç™»é™† docker run -it --name=myubuntu ubuntu /bin/bash #æŒ‡å®šåç§° docker run -d redis:6.0.8 #åå°è¿è¡Œã€å®ˆæŠ¤å¼å®¹å™¨ æ³¨æ„ ä¸Šé¢çš„docker run -d ubuntu æ‰§è¡Œåï¼Œä½¿ç”¨docker ps -aè¿›è¡ŒæŸ¥çœ‹ï¼Œä¼šå‘ç°å®¹å™¨å·²ç»é€€å‡º å¾ˆé‡è¦çš„è¦è¯´æ˜çš„ä¸€ç‚¹: Dockerå®¹å™¨åå°è¿è¡Œ,å°±å¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹. å¸¸ç”¨é€‰é¡¹ï¼š\n-dï¼šåå°è¿è¡Œå®¹å™¨ï¼ˆå³è„±ç¦»ç»ˆç«¯ï¼‰ -pï¼šç«¯å£æ˜ å°„ --nameï¼šç»™å®¹å™¨æŒ‡å®šä¸€ä¸ªåå­— -eï¼šè®¾ç½®ç¯å¢ƒå˜é‡ é€‰é¡¹ æè¿° -i, --interactive äº¤äº’å¼æ¨¡å¼ï¼Œä¿æŒå®¹å™¨æ ‡å‡†è¾“å…¥æ‰“å¼€ -t, --tty åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼Œç”¨äºè¿æ¥åˆ°å®¹å™¨çš„ç»ˆç«¯ -d, --detach åœ¨åå°è¿è¡Œå®¹å™¨ï¼Œä¸é˜»å¡ç»ˆç«¯ -e, --env è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ ¼å¼ï¼š-e \u0026lt;key\u0026gt;=\u0026lt;value\u0026gt; -p, --publish list å‘å¸ƒå®¹å™¨ç«¯å£åˆ°ä¸»æœºï¼Œæ ¼å¼ï¼š-p \u0026lt;host_port\u0026gt;:\u0026lt;container_port\u0026gt; -P, --publish-all å‘å¸ƒå®¹å™¨æ‰€æœ‰ EXPOSE çš„ç«¯å£åˆ°å®¿ä¸»æœºéšæœºç«¯å£ --name string æŒ‡å®šå®¹å™¨çš„åç§° -h, --hostname è®¾ç½®å®¹å™¨çš„ä¸»æœºå --ip string æŒ‡å®šå®¹å™¨çš„ IP åœ°å€ï¼Œä»…é™äºè‡ªå®šä¹‰ç½‘ç»œ --network è¿æ¥å®¹å™¨åˆ°æŒ‡å®šçš„ç½‘ç»œ -v, --volume list å°†å®¿ä¸»æœºç›®å½•æˆ–å·æŒ‚è½½åˆ°å®¹å™¨ä¸­ï¼Œæ ¼å¼ï¼š-v \u0026lt;host_path\u0026gt;:\u0026lt;container_path\u0026gt; --mount mount ä½¿ç”¨æ–°æ–¹å¼å°†æ–‡ä»¶ç³»ç»Ÿæˆ–å­˜å‚¨æŒ‚è½½åˆ°å®¹å™¨ï¼Œæ ¼å¼ï¼š--mount type=bind,source=\u0026lt;source\u0026gt;,target=\u0026lt;target\u0026gt; --restart string è®¾ç½®å®¹å™¨é€€å‡ºæ—¶çš„é‡å¯ç­–ç•¥ï¼Œé»˜è®¤å€¼ä¸º noï¼Œå¯é€‰å€¼ï¼š[always -m, --memory é™åˆ¶å®¹å™¨çš„æœ€å¤§å†…å­˜ä½¿ç”¨é‡ --memory-swap å®¹å™¨å…è®¸ä½¿ç”¨çš„äº¤æ¢ç©ºé—´å¤§å°ï¼ˆåŒ…æ‹¬å†…å­˜å’Œ swapï¼‰ --memory-swappiness=\u0026lt;0-100\u0026gt; è®¾ç½®å®¹å™¨ä½¿ç”¨ swap çš„å€¾å‘æ€§ï¼Œå–å€¼èŒƒå›´ [0-100]ï¼Œé»˜è®¤ä¸º -1 --oom-kill-disable ç¦ç”¨ OOM Killerï¼Œå½“å®¹å™¨å†…å­˜è€—å°½æ—¶ä¸ä¼šè¢«æ€æ‰ --cpus è®¾ç½®å®¹å™¨å¯ä»¥ä½¿ç”¨çš„ CPU æ•°é‡ --cpuset-cpus é™åˆ¶å®¹å™¨ä½¿ç”¨ç‰¹å®šçš„ CPU æ ¸å¿ƒï¼Œå¦‚ --cpuset-cpus=\u0026quot;0-3,0,1\u0026quot; --cpu-shares è®¾ç½®å®¹å™¨çš„ CPU æƒé‡ï¼Œç”¨äº CPU èµ„æºçš„åˆ†é…ï¼ˆç›¸å¯¹æƒé‡ï¼‰ 2.2 æŸ¥çœ‹å®¹å™¨åˆ—è¡¨ # ä½¿ç”¨ docker ps å‘½ä»¤æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ã€‚å¦‚æœè¦æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ˆåŒ…æ‹¬å·²åœæ­¢çš„ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ docker ps -aã€‚\ndocker ps # æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ docker ps -a # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼ŒåŒ…æ‹¬å·²åœæ­¢çš„ å‚æ•°ï¼š -a :åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨+å†å²ä¸Šè¿è¡Œè¿‡çš„ -l :æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ã€‚ -n nuï¼šæ˜¾ç¤ºæœ€è¿‘nuä¸ªåˆ›å»ºçš„å®¹å™¨ã€‚ -q :é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·ã€‚ è¾“å‡ºç¤ºä¾‹ï¼š\nCONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 1a2b3c4d5e6f nginx \u0026#34;/docker-entrypoint.â€¦\u0026#34; 2 minutes ago Up 2 minutes 0.0.0.0:80-\u0026gt;80/tcp my-nginx 2.3 è¿›å…¥ã€é€€å‡ºå®¹å™¨ # è¿›å…¥å®¹å™¨ # å¦‚æœæƒ³è¦è¿›å…¥å®¹å™¨çš„å†…éƒ¨è¿›è¡Œè°ƒè¯•æˆ–æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ docker exec å‘½ä»¤ï¼š\ndocker exec -it \u0026lt;container_id_or_name\u0026gt; /bin/bash ä¾‹å¦‚ï¼Œè¿›å…¥åä¸º my-nginx çš„å®¹å™¨ï¼š\ndocker exec -it my-nginx /bin/bash é€€å‡ºå®¹å™¨ # â‘  exit runè¿›å»å®¹å™¨ï¼Œexité€€å‡ºï¼Œå®¹å™¨åœæ­¢ â‘¡ ctrl+p+q runè¿›å»å®¹å™¨ï¼Œctrl+p+qé€€å‡ºï¼Œå®¹å™¨ä¸åœæ­¢ å®¹å™¨å†…å¤–çš„æ–‡ä»¶å¤åˆ¶ # docker cp å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„ #ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š eg: #ä»¥ubuntuä¸ºä¾‹ï¼Œæˆ‘ä»¬åœ¨/tmpç›®å½•ä¸‹é€šè¿‡touch a.txtåˆ›å»ºaæ–‡æœ¬ï¼Œå°†å…¶å¤åˆ¶åˆ°æœ¬æœºdownloadç›®å½•ä¸‹ docker cp 958443b97285:/tmp/a.txt /download #æœ‰ä¸€ä¸ªåä¸º my_container çš„å®¹å™¨ï¼Œå¹¶ä¸”å¸Œæœ›å°†ä¸»æœºä¸Šçš„æ–‡ä»¶ /tmp/myfile.txt å¤åˆ¶åˆ°å®¹å™¨å†…çš„ /app ç›®å½•ï¼š docker cp /tmp/myfile.txt my_container:/app/ 2.4 åœæ­¢å®¹å™¨ # è¦åœæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ï¼Œä½¿ç”¨ docker stop å‘½ä»¤ã€‚å¯ä»¥æ ¹æ®å®¹å™¨çš„ ID æˆ–åç§°åœæ­¢å®¹å™¨ã€‚\ndocker stop \u0026lt;container_id_or_name\u0026gt; ä¾‹å¦‚ï¼Œåœæ­¢åä¸º my-nginx çš„å®¹å™¨ï¼š\ndocker stop my-nginx 2.5 é‡å¯å®¹å™¨ # è¦é‡å¯ä¸€ä¸ªå®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ docker restart å‘½ä»¤ï¼Œè¿™å¯¹äºæ›´æ–°é…ç½®æˆ–è€…é‡å¯å®¹å™¨åº”ç”¨éå¸¸æœ‰ç”¨ã€‚\ndocker restart \u0026lt;container_id_or_name\u0026gt; ä¾‹å¦‚ï¼Œé‡å¯åä¸º my-nginx çš„å®¹å™¨ï¼š\ndocker restart my-nginx 2.6 åˆ é™¤å®¹å™¨ # åˆ é™¤å·²åœæ­¢çš„å®¹å™¨ï¼Œå¯ä»¥ä½¿ç”¨ docker rm å‘½ä»¤ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåˆ é™¤å®¹å™¨æ—¶ï¼Œè¯¥å®¹å™¨å†…çš„æ•°æ®ä¼šä¸¢å¤±ï¼Œé™¤éä½¿ç”¨äº†å·ï¼ˆVolumesï¼‰æ¥æŒä¹…åŒ–æ•°æ®ã€‚\ndocker rm \u0026lt;container_id_or_name\u0026gt; ä¾‹å¦‚ï¼Œåˆ é™¤åä¸º my-nginx çš„å®¹å™¨ï¼š\ndocker rm my-nginx å¦‚æœå®¹å™¨åœ¨è¿è¡Œï¼Œä¸”ä½ å¸Œæœ›åŒæ—¶åœæ­¢å¹¶åˆ é™¤å®ƒï¼Œå¯ä»¥ä½¿ç”¨ -f å¼ºåˆ¶åˆ é™¤å®¹å™¨ï¼š\ndocker rm -f \u0026lt;container_id_or_name\u0026gt; 2.7 æŸ¥çœ‹å®¹å™¨æ—¥å¿— # è¦æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ docker logs å‘½ä»¤ã€‚è¿™å¯¹äºè°ƒè¯•åº”ç”¨ç¨‹åºæˆ–æ’æŸ¥é”™è¯¯éå¸¸æœ‰ç”¨ã€‚\ndocker logs \u0026lt;container_id_or_name\u0026gt; ä¾‹å¦‚ï¼ŒæŸ¥çœ‹åä¸º my-nginx å®¹å™¨çš„æ—¥å¿—ï¼š\ndocker logs my-nginx å¦‚æœè¦å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼Œå¯ä»¥ä½¿ç”¨ -f é€‰é¡¹ï¼š\ndocker logs -f \u0026lt;container_id_or_name\u0026gt; 2.8 æŸ¥çœ‹å®¹å™¨çš„è¯¦ç»†æƒ…å†µ # è¦æŸ¥çœ‹å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼ˆå¦‚ CPUã€å†…å­˜ç­‰ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ docker stats å‘½ä»¤ã€‚å®ƒä¼šæ˜¾ç¤ºæ‰€æœ‰å®¹å™¨çš„èµ„æºä½¿ç”¨ä¿¡æ¯ï¼Œæˆ–è€…ä½ å¯ä»¥æŒ‡å®šæŸä¸ªå®¹å™¨æŸ¥çœ‹å…¶èµ„æºä½¿ç”¨æƒ…å†µã€‚\ndocker stats # æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µ docker stats \u0026lt;container_id_or_name\u0026gt; # æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µ å‚æ•°ï¼š --all , -a :æ˜¾ç¤ºæ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬æœªè¿è¡Œçš„ã€‚ --format :æŒ‡å®šè¿”å›å€¼çš„æ¨¡æ¿æ–‡ä»¶ã€‚ --no-stream :å±•ç¤ºå½“å‰çŠ¶æ€å°±ç›´æ¥é€€å‡ºäº†ï¼Œä¸å†å®æ—¶æ›´æ–°ã€‚ --no-trunc :ä¸æˆªæ–­è¾“å‡ºã€‚ egï¼š docker stats docker stats mynginx # å®¹å™¨å docker stats af7928654200 # å®¹å™¨ID å­—æ®µè§£æ CONTAINER ID ä¸ NAME: å®¹å™¨ ID ä¸åç§°ã€‚ CPU % ä¸ MEM %: å®¹å™¨ä½¿ç”¨çš„ CPU å’Œå†…å­˜çš„ç™¾åˆ†æ¯”ã€‚ MEM USAGE / LIMIT: å®¹å™¨æ­£åœ¨ä½¿ç”¨çš„æ€»å†…å­˜ï¼Œä»¥åŠå…è®¸ä½¿ç”¨çš„å†…å­˜æ€»é‡ã€‚ NET I/O: å®¹å™¨é€šè¿‡å…¶ç½‘ç»œæ¥å£å‘é€å’Œæ¥æ”¶çš„æ•°æ®é‡ã€‚ BLOCK I/O: å®¹å™¨ä»ä¸»æœºä¸Šçš„å—è®¾å¤‡è¯»å–å’Œå†™å…¥çš„æ•°æ®é‡ã€‚ PIDs: å®¹å™¨åˆ›å»ºçš„è¿›ç¨‹æˆ–çº¿ç¨‹æ•°ã€‚ # docker statsç»Ÿè®¡ç»“æœåªèƒ½æ˜¯å½“å‰å®¿ä¸»æœºçš„å…¨éƒ¨å®¹å™¨ï¼Œæ•°æ®èµ„æ–™æ˜¯å®æ—¶çš„ï¼Œæ²¡æœ‰åœ°æ–¹å­˜å‚¨ã€æ²¡æœ‰å¥åº·æŒ‡æ ‡è¿‡çº¿é¢„è­¦ç­‰åŠŸèƒ½ï¼Œå¦‚æœç°è±¡è¦å®ç°ç›‘æ§æ•°æ®æŒä¹…åŒ–å¹¶ä»¥å›¾è¡¨ç­‰å½¢å¼å±•ç°ï¼Œå¯ä»¥ä½¿ç”¨CIGï¼Œå³CAdvisorç›‘æ§æ”¶é›†+InfluxDBå­˜å‚¨æ•°æ®+Granfanaå±•ç¤ºå›¾è¡¨ è¦æŸ¥çœ‹å®¹å™¨é‡Œçš„è¿›ç¨‹ä½¿ç”¨æƒ…å†µï¼Œä½¿ç”¨docker top æŸ¥çœ‹å®¹å™¨å†…çš„è¿›ç¨‹\ndocker top å®¹å™¨ID #æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹ 2.9 ç®¡ç†å®¹å™¨ç½‘ç»œ # Docker å®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ Docker ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚ä½ å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œã€è¿æ¥å®¹å™¨åˆ°ç½‘ç»œï¼Œæˆ–è€…æŸ¥çœ‹ç½‘ç»œé…ç½®ã€‚\nåˆ›å»ºç½‘ç»œï¼š\ndocker network create \u0026lt;network_name\u0026gt; è¿æ¥å®¹å™¨åˆ°æŒ‡å®šç½‘ç»œï¼š\ndocker network connect \u0026lt;network_name\u0026gt; \u0026lt;container_id_or_name\u0026gt; æŸ¥çœ‹å®¹å™¨ç½‘ç»œï¼š\ndocker network ls åˆ é™¤ç½‘ç»œ\ndocker network rm XXXç½‘ç»œåå­— æŸ¥çœ‹ç½‘ç»œç›¸å…³ä¿¡æ¯\ndocker network inspect XXXç½‘ç»œåå­— 2.10 å®¹å™¨ä¸å·ï¼ˆVolumesï¼‰ # ä½¿ç”¨å· # ä¸ºäº†æŒä¹…åŒ–å®¹å™¨ä¸­çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ Docker å·ï¼ˆVolumesï¼‰ã€‚å·å­˜å‚¨åœ¨ Docker å®ˆæŠ¤è¿›ç¨‹å¤–éƒ¨ï¼Œå®¹å™¨åœæ­¢æˆ–åˆ é™¤æ—¶ï¼Œå·ä¸­çš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚å¯ä»¥å°†å®¹å™¨ä¸­çš„ç›®å½•æŒ‚è½½åˆ°å·ä¸Šã€‚\nåˆ›å»ºä¸€ä¸ªå·ï¼š\ndocker volume create \u0026lt;volume_name\u0026gt; ä½¿ç”¨å·å¯åŠ¨å®¹å™¨ï¼š\ndocker run -d -v \u0026lt;volume_name\u0026gt;:\u0026lt;container_path\u0026gt; \u0026lt;image_name\u0026gt; ä¾‹å¦‚ï¼Œä½¿ç”¨ my-volume å·å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼š\ndocker run -d -v my-volume:/data nginx docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•:[OPTION] é•œåƒå å‚æ•°ï¼š rw å¯è¯»å¯å†™ï¼ˆread + writeï¼‰ ro å®¹å™¨å®ä¾‹å†…éƒ¨è¢«é™åˆ¶ï¼Œåªèƒ½è¯»å–ä¸èƒ½å†™ï¼Œä»…è¯»ï¼ˆread onlyï¼‰ egï¼š docker run -it --privileged=true --name=u1 -v /tmp/docker_data:/tmp/dockertest:ro ubuntu /bin/bash docker run -it --privileged=true --name=u2 -v /tmp/docker_data:/tmp/dockertest ubuntu /bin/bash # ä¸å†™OPTIONé»˜è®¤rw æŒ‚è½½åå¯é€šè¿‡ã€docker inspect å®¹å™¨IDã€‘æŸ¥çœ‹æ˜¯å¦æŒ‚è½½æˆåŠŸ å®¹å™¨æ•°æ®å·ç»§æ‰¿ # docker run -it --privileged=true --volumes-from çˆ¶ç±» --name u2 ubuntu exampleï¼š # æ–°åˆ›å»ºu3å®¹å™¨ç»§æ‰¿u2å®¹å™¨çš„æ•°æ®å·æŒ‚è½½ï¼Œæ­¤æ—¶u2å°±ç®—stopä¹Ÿä¸å½±å“u3 docker run -it --privileged=true --volumes-from u2 --name u3 ubuntu 2.11 å®¹å™¨çš„å¤‡ä»½ # docker commit -m=\u0026#34;æäº¤çš„æè¿°ä¿¡æ¯\u0026#34; -a=\u0026#34;ä½œè€…\u0026#34; å®¹å™¨ID è¦åˆ›å»ºçš„ç›®æ ‡é•œåƒå:[æ ‡ç­¾å] # ä¿å­˜å½“å‰å®¹å™¨çš„çŠ¶æ€ docker commit -a \u0026#34;author\u0026#34; -m \u0026#34;meassage\u0026#34; container_id docker commit -a \u0026#34;author\u0026#34; -m \u0026#34;meassage\u0026#34; container_name eg: docker pull ubuntu docker exec --it container_id /bin/bash apt-get update apt-get -y install vim docker commit -m=\u0026#34;ubuntu-add-vim\u0026#34; -a=\u0026#34;zjy\u0026#34; a4b1b1cc54f0 atguigu/myubuntu:1.3 éªŒè¯ï¼š docker systemd df docker images -a ä»…ä¼šä¿å­˜å½“å‰å®¹å™¨å†…çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬cpè¿›å®¹å™¨çš„æ–‡ä»¶ï¼‰ï¼Œä½†ä¸ä¼šä¿å­˜æŒ‚è½½çš„volumeæˆ–bind\n2.12å¸¸è§å®¹å™¨å‘½ä»¤æ€»ç»“ # å‘½ä»¤ æè¿° docker ps åˆ—å‡ºå½“å‰è¿è¡Œä¸­çš„å®¹å™¨ docker inspect æŸ¥çœ‹ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ docker exec åœ¨è¿è¡Œä¸­çš„å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤ docker commit ä»å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒ docker cp æ‹·è´æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹åˆ°å®¹å™¨ä¸­æˆ–ä»å®¹å™¨ä¸­æ‹·è´åˆ°ä¸»æœº docker logs è·å–å®¹å™¨çš„æ—¥å¿—è¾“å‡º docker port åˆ—å‡ºæˆ–æŒ‡å®šå®¹å™¨ç«¯å£æ˜ å°„ docker top æ˜¾ç¤ºå®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ docker stats æ˜¾ç¤ºå®¹å™¨çš„å®æ—¶èµ„æºä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯ docker stop åœæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªè¿è¡Œä¸­çš„å®¹å™¨ docker start å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå·²åœæ­¢çš„å®¹å™¨ docker restart é‡å¯ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ docker rm åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ docker prune ç§»é™¤æ‰€æœ‰å·²åœæ­¢çš„å®¹å™¨ï¼Œå¹¶é‡Šæ”¾å ç”¨çš„ç³»ç»Ÿèµ„æº å››ã€Dockerç½‘ç»œç®¡ç† # Dockerç½‘ç»œæ¶æ„çš„è®¾è®¡è§„èŒƒæ˜¯CNMã€‚CNMä¸­è§„å®šäº†Dockerç½‘ç»œçš„åŸºç¡€ç»„æˆè¦ç´ ï¼Œå®Œæ•´å†…å®¹è§GitHubçš„docker/libnetworkåº“ã€‚\næ¨èé€šç¯‡é˜…è¯»è¯¥è§„èŒƒï¼Œä¸è¿‡å…¶å®æŠ½è±¡æ¥è®²ï¼ŒCNMå®šä¹‰äº†3ä¸ªåŸºæœ¬è¦ç´ ï¼šæ²™ç›’ï¼ˆSandboxï¼‰ã€ç»ˆç«¯ï¼ˆEndpointï¼‰å’Œç½‘ç»œï¼ˆNetworkï¼‰ã€‚\næ²™ç›’æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç»œæ ˆã€‚å…¶ä¸­åŒ…æ‹¬ä»¥å¤ªç½‘æ¥å£ã€ç«¯å£ã€è·¯ç”±è¡¨ä»¥åŠDNSé…ç½®ã€‚\nç»ˆç«¯å°±æ˜¯è™šæ‹Ÿç½‘ç»œæ¥å£ã€‚å°±åƒæ™®é€šç½‘ç»œæ¥å£ä¸€æ ·ï¼Œç»ˆç«¯ä¸»è¦èŒè´£æ˜¯è´Ÿè´£åˆ›å»ºè¿æ¥ã€‚åœ¨CNMä¸­ï¼Œç»ˆç«¯è´Ÿè´£å°†æ²™ç›’è¿æ¥åˆ°ç½‘ç»œã€‚\nç½‘ç»œæ˜¯802.1dç½‘æ¡¥ï¼ˆç±»ä¼¼å¤§å®¶ç†ŸçŸ¥çš„äº¤æ¢æœºï¼‰çš„è½¯ä»¶å®ç°ã€‚å› æ­¤ï¼Œç½‘ç»œå°±æ˜¯éœ€è¦äº¤äº’çš„ç»ˆç«¯çš„é›†åˆï¼Œå¹¶ä¸”ç»ˆç«¯ä¹‹é—´ç›¸äº’ç‹¬ç«‹\nDockerç¯å¢ƒä¸­æœ€å°çš„è°ƒåº¦å•ä½å°±æ˜¯å®¹å™¨ï¼Œè€ŒCNMä¹Ÿæ°å¦‚å…¶åï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›ç½‘ç»œåŠŸèƒ½ã€‚\néœ€è¦é‡ç‚¹ç†è§£çš„æ˜¯ï¼Œç»ˆç«¯ä¸å¸¸è§çš„ç½‘ç»œé€‚é…å™¨ç±»ä¼¼ï¼Œè¿™æ„å‘³ç€ç»ˆç«¯åªèƒ½æ¥å…¥æŸä¸€ä¸ªç½‘ç»œã€‚å› æ­¤ï¼Œå¦‚æœå®¹å™¨éœ€è¦æ¥å…¥åˆ°å¤šä¸ªç½‘ç»œï¼Œå°±éœ€è¦å¤šä¸ªç»ˆç«¯ã€‚\nç½‘ç»œéƒ¨åˆ†ä»£ç éƒ½å­˜åœ¨äºdaemonå½“ä¸­,Dockerå°†è¯¥ç½‘ç»œéƒ¨åˆ†ä»daemonä¸­æ‹†åˆ†ï¼Œå¹¶é‡æ„ä¸ºä¸€ä¸ªå«ä½œLibnetworkçš„å¤–éƒ¨ç±»åº“ã€‚\nLibnetworkå®ç°äº†CNMä¸­å®šä¹‰çš„å…¨éƒ¨3ä¸ªç»„ä»¶ã€‚æ­¤å¤–å®ƒè¿˜å®ç°äº†æœ¬åœ°æœåŠ¡å‘ç°ï¼ˆService Discoveryï¼‰ã€åŸºäºIngressçš„å®¹å™¨è´Ÿè½½å‡è¡¡ï¼Œä»¥åŠç½‘ç»œæ§åˆ¶å±‚å’Œç®¡ç†å±‚åŠŸèƒ½ã€‚\nå¦‚æœè¯´Libnetworkå®ç°äº†æ§åˆ¶å±‚å’Œç®¡ç†å±‚åŠŸèƒ½ï¼Œé‚£ä¹ˆé©±åŠ¨å°±è´Ÿè´£å®ç°æ•°æ®å±‚ã€‚æ¯”å¦‚ï¼Œç½‘ç»œè¿é€šæ€§å’Œéš”ç¦»æ€§æ˜¯ç”±é©±åŠ¨æ¥å¤„ç†çš„ï¼Œé©±åŠ¨å±‚å®é™…åˆ›å»ºç½‘ç»œå¯¹è±¡ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå…¶å…³ç³»å¦‚å›¾æ‰€ç¤ºã€‚\nDockerå°è£…äº†è‹¥å¹²å†…ç½®é©±åŠ¨ï¼Œé€šå¸¸è¢«ç§°ä½œåŸç”Ÿé©±åŠ¨æˆ–è€…æœ¬åœ°é©±åŠ¨ã€‚åœ¨Linuxä¸ŠåŒ…æ‹¬Bridge ã€Overlay ä»¥åŠMacvlan\n1. Bridge # é»˜è®¤Bridge # å½“ Docker è¿›ç¨‹å¯åŠ¨æ—¶ï¼Œä¼šåœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªåä¸º docker0 çš„è™šæ‹Ÿç½‘æ¡¥ï¼Œæ­¤ä¸»æœºä¸Šå¯åŠ¨çš„ Dockerå®¹å™¨ä¼šè¿æ¥åˆ°è¿™ä¸ªè™šæ‹Ÿç½‘æ¡¥ä¸Šã€‚è™šæ‹Ÿç½‘æ¡¥çš„å·¥ä½œæ–¹å¼å’Œç‰©ç†äº¤æ¢æœºç±»ä¼¼ï¼Œè¿™æ ·ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨å°±é€šè¿‡äº¤æ¢æœºè¿åœ¨äº†ä¸€ä¸ªäºŒå±‚ç½‘ç»œä¸­ã€‚\nä» docker0 å­ç½‘ä¸­åˆ†é…ä¸€ä¸ª IP ç»™å®¹å™¨ä½¿ç”¨ï¼Œå¹¶è®¾ç½® docker0 çš„ IP åœ°å€ä¸ºå®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚åœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€å¯¹è™šæ‹Ÿç½‘å¡ veth pair è®¾å¤‡ï¼Œ Dockerå°† veth pair è®¾å¤‡çš„ä¸€ç«¯æ”¾åœ¨æ–°åˆ›å»ºçš„å®¹å™¨ä¸­ï¼Œå¹¶å‘½åä¸º eth0 ï¼ˆå®¹å™¨çš„ç½‘å¡ï¼‰ï¼Œå¦ä¸€ç«¯æ”¾åœ¨ä¸»æœºä¸­ï¼Œä»¥ vethxxx è¿™æ ·ç±»ä¼¼çš„åå­—å‘½åï¼Œå¹¶å°†è¿™ä¸ªç½‘ç»œè®¾å¤‡åŠ å…¥åˆ° docker0 ç½‘æ¡¥ä¸­ã€‚å¯ä»¥é€šè¿‡brctl showå‘½ä»¤æŸ¥çœ‹\nDockeré»˜è®¤â€œbridgeâ€ç½‘ç»œå’ŒLinuxå†…æ ¸ä¸­çš„â€œdocker0â€ç½‘æ¡¥ä¹‹é—´çš„å…³ç³»å¦‚å›¾\nè‡ªå®šä¹‰Bridge # ä½¿ç”¨docker network create å‘½ä»¤åˆ›å»ºæ–°çš„å•æœºæ¡¥æ¥ç½‘ç»œï¼Œåä¸ºâ€œlocalnetâ€ã€‚\ndocker network create -d bridge localnet æ–°çš„ç½‘ç»œåˆ›å»ºæˆåŠŸï¼Œå¹¶ä¸”ä¼šå‡ºç°åœ¨docker network ls å‘½åçš„è¾“å‡ºå†…å®¹å½“ä¸­ã€‚å¦‚æœè¯»è€…ä½¿ç”¨Linuxï¼Œé‚£ä¹ˆåœ¨ä¸»æœºå†…æ ¸ä¸­è¿˜ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Linuxç½‘æ¡¥\næ¥ä¸‹æ¥é€šè¿‡ä½¿ç”¨Linux brctl å·¥å…·æ¥æŸ¥çœ‹ç³»ç»Ÿä¸­çš„Linuxç½‘æ¡¥ã€‚å¯èƒ½éœ€è¦é€šè¿‡å‘½ä»¤apt-get install bridge-utils æ¥å®‰è£…brctl äºŒè¿›åˆ¶åŒ…ï¼Œæˆ–è€…æ ¹æ®æ‰€ä½¿ç”¨çš„Linuxå‘è¡Œç‰ˆé€‰æ‹©åˆé€‚çš„å‘½ä»¤ã€‚\nroot@blog:/home/hwz# brctl show bridge name bridge id STP enabled interfaces br-5ac679535b8c 8000.0242858a17dd no veth4b19961 docker0 8000.0242ac80c4ca no vethf1e3e13 docker_gwbridge 8000.02425bb9fa03 no vethaad561c Linuxä¸Šé»˜è®¤çš„Bridgeç½‘ç»œæ˜¯ä¸æ”¯æŒé€šè¿‡Docker DNS*æœåŠ¡è¿›è¡ŒåŸŸåè§£æçš„ã€‚è‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œå¯ä»¥*ï¼\nï¼ˆ1ï¼‰åˆ›å»ºåä¸ºâ€œc2â€çš„å®¹å™¨ï¼Œå¹¶æ¥å…¥â€œc1â€æ‰€åœ¨çš„localnet ç½‘ç»œã€‚ //Linux $ docker container run -it --name c2 \\ --network localnet \\ alpine sh ï¼ˆ2ï¼‰åœ¨â€œc2â€å®¹å™¨ä¸­ï¼Œé€šè¿‡â€œc1â€å®¹å™¨åç§°æ‰§è¡Œping å‘½ä»¤ã€‚ \u0026gt; ping c1 Pinging c1 [172.26.137.130] with 32 bytes of data: Reply from 172.26.137.130: bytes=32 time=1ms TTL=128 Reply from 172.26.137.130: bytes=32 time=1ms TTL=128 Control-C å‘½ä»¤ç”Ÿæ•ˆäº†ï¼è¿™æ˜¯å› ä¸ºc2å®¹å™¨è¿è¡Œäº†ä¸€ä¸ªæœ¬åœ°DNSè§£æå™¨ï¼Œè¯¥è§£æå™¨å°†è¯·æ±‚è½¬å‘åˆ°äº†Dockerå†…éƒ¨DNSæœåŠ¡å™¨å½“ä¸­ã€‚Dockerçš„ DNSæœåŠ¡å™¨ä¸­è®°å½•äº†å®¹å™¨å¯åŠ¨æ—¶é€šè¿‡\u0026ndash;name æˆ–è€…\u0026ndash;net-alias å‚æ•°æŒ‡å®šçš„åç§°ä¸å®¹å™¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚\n**æ¡¥æ¥ç½‘ç»œä¸­çš„å®¹å™¨åªèƒ½ä¸ä½äºç›¸åŒç½‘ç»œä¸­çš„å®¹å™¨è¿›è¡Œé€šä¿¡ã€‚**ä½†æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨ç«¯å£æ˜ å°„ï¼ˆPort Mappingï¼‰æ¥ç»•å¼€è¿™ä¸ªé™åˆ¶ã€‚\nåœ¨ç«¯å£æ˜ å°„æ—¶ï¼ŒDocker å¹¶ä¸å…³å¿ƒå®¿ä¸»æœºå’Œå®¹å™¨çš„ IP åœ°å€æ˜¯å¦åœ¨åŒä¸€ç½‘æ®µã€‚Docker è´Ÿè´£å¤„ç†ä»å®¿ä¸»æœºæ¥æ”¶åˆ°çš„æµé‡ï¼Œå¹¶å°†å…¶è½¬å‘åˆ°æ­£ç¡®çš„å®¹å™¨ã€‚ç«¯å£æ˜ å°„çš„å…³é”®åœ¨äºç½‘ç»œå±‚é¢çš„è·¯ç”±å’Œ NAT è½¬æ¢ï¼Œè€Œä¸æ˜¯ IP åœ°å€çš„ç›´æ¥é€šä¿¡ã€‚\nç«¯å£æ˜ å°„å…è®¸å°†æŸä¸ªå®¹å™¨ç«¯å£æ˜ å°„åˆ°Dockerä¸»æœºç«¯å£ä¸Šã€‚å¯¹äºé…ç½®ä¸­æŒ‡å®šçš„Dockerä¸»æœºç«¯å£ï¼Œä»»ä½•å‘é€åˆ°è¯¥ç«¯å£çš„æµé‡ï¼Œéƒ½ä¼šè¢«è½¬å‘åˆ°å®¹å™¨ã€‚å›¾ä¸­å±•ç¤ºäº†å…·ä½“æµé‡åŠ¨å‘ã€‚\n2. Container # æŒ‡å®šæ–°åˆ›å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ª Network Namespace ï¼Œè€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«ã€‚æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„ IP ï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº« IP ã€ç«¯å£èŒƒå›´ç­‰ã€‚åŒæ ·ï¼Œä¸¤ä¸ªå®¹å™¨é™¤äº†ç½‘ç»œæ–¹é¢ï¼Œå…¶ä»–çš„å¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯éš”ç¦»çš„ã€‚ä¸¤ä¸ªå®¹å™¨çš„è¿›ç¨‹å¯ä»¥é€šè¿‡ lo ç½‘å¡è®¾å¤‡é€šä¿¡ã€‚\n# å‚æ•° docker run --network container:\u0026lt;container_id\u0026gt; \u0026lt;image\u0026gt; æ–°çš„å®¹å™¨å°†å…±äº«æŒ‡å®šå®¹å™¨çš„ç½‘ç»œå †æ ˆï¼ŒåŒ…æ‹¬ IP åœ°å€ã€ç«¯å£ç­‰ã€‚è¿™ç§æ¨¡å¼ä½¿å¾—å¤šä¸ªå®¹å™¨å¯ä»¥å…±äº«ç½‘ç»œé…ç½®ï¼Œä½†å¹¶æ²¡æœ‰ç‹¬ç«‹çš„ç½‘ç»œç©ºé—´ã€‚ 3. Host # å¦‚æœå¯åŠ¨å®¹å™¨çš„æ—¶å€™ä½¿ç”¨ host æ¨¡å¼ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨å°†ä¸ä¼šè·å¾—ä¸€ä¸ªç‹¬ç«‹çš„ Network Namespace ï¼Œè€Œæ˜¯å’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ª Network Namespace ã€‚å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„ IP ç­‰ï¼Œè€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„ IP å’Œç«¯å£ã€‚ä½†æ˜¯ï¼Œå®¹å™¨çš„å…¶ä»–æ–¹é¢ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯å’Œå®¿ä¸»æœºéš”ç¦»çš„ã€‚\ndocker run --network host \u0026lt;image\u0026gt; 4.None # none ç½‘ç»œæ¨¡å¼ä¼šä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªç‹¬ç«‹çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œä½†è¯¥å®¹å™¨æ²¡æœ‰ä»»ä½•ç½‘ç»œè¿æ¥ã€‚ å·¥ä½œåŸç†ï¼šå®¹å™¨åœ¨ none ç½‘ç»œæ¨¡å¼ä¸‹ä¸ä¼šè‡ªåŠ¨è¿æ¥åˆ°ä»»ä½•ç½‘ç»œï¼Œå®¹å™¨æ²¡æœ‰ IP åœ°å€ï¼Œä¹Ÿä¸èƒ½è®¿é—®å¤–éƒ¨ç½‘ç»œã€‚ä½ éœ€è¦æ‰‹åŠ¨é…ç½®å®¹å™¨çš„ç½‘ç»œè¿æ¥ï¼ˆå¦‚ä½¿ç”¨ docker exec è¿›å…¥å®¹å™¨å¹¶è¿›è¡Œæ‰‹åŠ¨é…ç½®ï¼‰ï¼Œæˆ–è€…é€šè¿‡æ‰‹åŠ¨åˆ›å»ºè™šæ‹Ÿç½‘ç»œè®¾å¤‡æ¥å®ç°å®¹å™¨é—´çš„é€šä¿¡ã€‚ é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºéœ€è¦å®Œå…¨æ§åˆ¶å®¹å™¨ç½‘ç»œé…ç½®çš„åœºæ™¯ï¼Œæˆ–è€…ä½ å¸Œæœ›å®¹å™¨å®Œå…¨æ²¡æœ‰ç½‘ç»œè®¿é—®æƒé™æ—¶ï¼ˆä¾‹å¦‚ï¼Œåšä¸€ä¸ªå®Œå…¨éš”ç¦»çš„å®‰å…¨å®¹å™¨ï¼‰ã€‚ docker run --network none \u0026lt;image\u0026gt; ç½‘ç»œæ¨¡å¼ æè¿° é€‚ç”¨åœºæ™¯ Bridge é»˜è®¤ç½‘ç»œï¼Œå®¹å™¨è¿æ¥åˆ°è™šæ‹Ÿæ¡¥æ¥ç½‘ç»œ å¤šä¸ªå®¹å™¨éœ€è¦ç›¸äº’é€šä¿¡å¹¶ä¸”å¯ä»¥ä¸å®¿ä¸»æœºæˆ–å¤–éƒ¨ç½‘ç»œé€šä¿¡ã€‚ Container å®¹å™¨å…±äº«å¦ä¸€ä¸ªå®¹å™¨çš„ç½‘ç»œå †æ ˆ ç´§å¯†é›†æˆçš„å®¹å™¨å…±äº«ç½‘ç»œå’Œç«¯å£ï¼Œå¦‚è¿è¡Œå¤šä¸ªæœåŠ¡çš„å®¹å™¨ã€‚ Host å®¹å™¨ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œå †æ ˆ ç½‘ç»œæ€§èƒ½è¦æ±‚é«˜çš„åº”ç”¨ï¼Œä¸”ä¸ä»‹æ„å®¹å™¨ä¸å®¿ä¸»æœºç¼ºä¹éš”ç¦»ã€‚ None å®¹å™¨æ²¡æœ‰ä»»ä½•ç½‘ç»œè¿æ¥ å®Œå…¨éš”ç¦»çš„å®¹å™¨æˆ–éœ€è¦æ‰‹åŠ¨é…ç½®ç½‘ç»œçš„ç‰¹æ®Šåœºæ™¯ã€‚ 5. Overlay # è¦†ç›–ç½‘ç»œé€‚ç”¨äºå¤šæœºç¯å¢ƒã€‚å®ƒå…è®¸å•ä¸ªç½‘ç»œåŒ…å«å¤šä¸ªä¸»æœºï¼Œè¿™æ ·ä¸åŒä¸»æœºä¸Šçš„å®¹å™¨é—´å°±å¯ä»¥åœ¨é“¾è·¯å±‚å®ç°é€šä¿¡ã€‚è¦†ç›–ç½‘ç»œæ˜¯ç†æƒ³çš„å®¹å™¨é—´é€šä¿¡æ–¹å¼ï¼Œæ”¯æŒå®Œå…¨å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œå¹¶ä¸”å…·å¤‡è‰¯å¥½çš„ä¼¸ç¼©æ€§ã€‚è¿™ç§ç½‘ç»œç±»å‹ç‰¹åˆ«é€‚ç”¨äºå®¹å™¨ç¼–æ’å’Œé›†ç¾¤ç¯å¢ƒï¼Œå¦‚Docker Swarm æˆ– Kubernetes\nå³ä½¿å®¹å™¨æ‰€åœ¨çš„Dockerä¸»æœºä½äºä¸åŒçš„åº•å±‚ç½‘ç»œä¸Šï¼Œè¯¥è¦†ç›–ç½‘ç»œä¾ç„¶æ˜¯ç›¸é€šçš„ã€‚æœ¬è´¨ä¸Šè¯´ï¼Œè¦†ç›–ç½‘ç»œæ˜¯åˆ›å»ºäºåº•å±‚å¼‚æ„ç½‘ç»œä¹‹ä¸Šçš„ä¸€ä¸ªæ–°çš„äºŒå±‚å®¹å™¨ç½‘ç»œã€‚ ä¸¤ä¸ªåº•å±‚ç½‘ç»œé€šè¿‡ä¸€ä¸ªä¸‰å±‚äº¤æ¢æœºè¿æ¥ï¼Œè€ŒåŸºäºè¿™ä¸¤ä¸ªç½‘ç»œä¹‹ä¸Šæ˜¯ä¸€ä¸ªè¦†ç›–ç½‘ç»œã€‚Dockerä¸»æœºé€šè¿‡ä¸¤ä¸ªåº•å±‚ç½‘ç»œç›¸è¿ï¼Œè€Œå®¹å™¨åˆ™é€šè¿‡è¦†ç›–ç½‘ç»œç›¸è¿ã€‚å¯¹äºåŒä¸€è¦†ç›–ç½‘ç»œä¸­çš„å®¹å™¨æ¥è¯´ï¼Œå³ä½¿å…¶å„è‡ªæ‰€åœ¨çš„Dockerä¸»æœºæ¥å…¥çš„æ˜¯ä¸åŒçš„åº•å±‚ç½‘ç»œï¼Œä¹Ÿæ˜¯äº’é€šçš„\nåŸç†ï¼šè™šæ‹Ÿç½‘ç»œï¼šDocker åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç½‘ç»œï¼Œè¦†ç›–åœ¨å¤šä¸ªç‰©ç†ä¸»æœºä¹‹ä¸Šã€‚å®¹å™¨å¯ä»¥åœ¨è¿™ä¸ªè™šæ‹Ÿç½‘ç»œä¸­ç›¸äº’é€šä¿¡ï¼Œå°±åƒå®ƒä»¬åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ä¸­ä¸€æ ·ã€‚\n**ç‰¹ç‚¹ï¼š**æ— éœ€ç«¯å£æ˜ å°„ï¼šä¸å•æœºæ¡¥æ¥ç½‘ç»œä¸åŒï¼Œoverlay ç½‘ç»œä¸­çš„å®¹å™¨ä¸éœ€è¦å°†ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºä¸Šã€‚å®¹å™¨å¯ä»¥ç›´æ¥é€šè¿‡ overlay ç½‘ç»œè®¿é—®å…¶ä»–å®¹å™¨\nè¦†ç›–ç½‘ç»œçš„åˆ›å»º # docker network create -d overlay net_name è¦å®Œæˆä¸‹é¢çš„ç¤ºä¾‹ï¼Œéœ€è¦ä¸¤å°Dockerä¸»æœºï¼Œå¹¶é€šè¿‡ä¸€ä¸ªè·¯ç”±å™¨ä¸Šä¸¤ä¸ªç‹¬ç«‹çš„äºŒå±‚ç½‘ç»œè¿æ¥åœ¨ä¸€èµ·ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œæ³¨æ„èŠ‚ç‚¹ä½äºä¸åŒç½‘ç»œä¹‹ä¸Š\nLinuxå†…æ ¸ç‰ˆæœ¬ä¸èƒ½ä½äº4.4ï¼ˆé«˜ç‰ˆæœ¬æ›´å¥½ï¼‰ï¼ŒWindowséœ€è¦Windows Server 2016ç‰ˆæœ¬ï¼Œå¹¶ä¸”åº”å®‰è£…æœ€æ–°çš„è¡¥ä¸\n1ï¼æ„å»ºSwarm\né¦–å…ˆéœ€è¦å°†ä¸¤å°ä¸»æœºé…ç½®ä¸ºåŒ…å«ä¸¤ä¸ªèŠ‚ç‚¹çš„Swarmé›†ç¾¤ã€‚æ¥ä¸‹æ¥ä¼šåœ¨node1èŠ‚ç‚¹ä¸Šè¿è¡Œdocker swarm init å‘½ä»¤ä½¿å…¶æˆä¸ºç®¡ç†èŠ‚ç‚¹ï¼Œç„¶ååœ¨node2èŠ‚ç‚¹ä¸Šè¿è¡Œdocker swarm join å‘½ä»¤æ¥ä½¿å…¶æˆä¸ºå·¥ä½œèŠ‚ç‚¹ã€‚\nå¦‚æœè¯»è€…éœ€è¦åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­ç»§ç»­ä¸‹é¢çš„ç¤ºä¾‹ï¼Œåˆ™éœ€è¦å…ˆå°†ç¯å¢ƒä¸­çš„IPåœ°å€ã€å®¹å™¨IDå’ŒTokenç­‰æ›¿æ¢ä¸ºæ­£ç¡®çš„å€¼ã€‚\nåœ¨node1 èŠ‚ç‚¹ä¸Šè¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚\n$ docker swarm init \\ ------------------------------------------------------------ --advertise-addr=172.31.1.5 \\--listen-addr=172.31.1.5:2377Swarm initialized: current node (1ex3...o3px) is now a manager. åœ¨node2 ä¸Šè¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚å¦‚æœéœ€è¦åœ¨Windowsç¯å¢ƒä¸‹ç”Ÿæ•ˆï¼Œåˆ™éœ€è¦ä¿®æ”¹Windowsé˜²ç«å¢™è§„åˆ™ï¼Œæ‰“å¼€2377/tcp ã€7946/tcp ä»¥åŠ7946/udp ç­‰å‡ ä¸ªç«¯å£ã€‚ $ docker swarm join \\ --token SWMTKN-1-0hz2ec...2vye \\172.31.1.5:2377This node joined a swarm as a worker. 2ï¼åˆ›å»ºæ–°çš„è¦†ç›–ç½‘ç»œ\nç°åœ¨åˆ›å»ºä¸€ä¸ªåä¸ºuber-net çš„è¦†ç›–ç½‘ç»œã€‚\nåœ¨node1 ï¼ˆç®¡ç†èŠ‚ç‚¹ï¼‰èŠ‚ç‚¹ä¸Šè¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚\n$ docker network create -d overlay uber-netc740ydi1lm89khn5kd52skrd9 ------------------------------------------------------------ åˆ›å»ºäº†ä¸€ä¸ªå´­æ–°çš„è¦†ç›–ç½‘ç»œï¼Œèƒ½è¿æ¥Swarmé›†ç¾¤å†…çš„æ‰€æœ‰ä¸»æœºï¼Œå¹¶ä¸”è¯¥ç½‘ç»œè¿˜åŒ…æ‹¬ä¸€ä¸ªTLSåŠ å¯†çš„æ§åˆ¶å±‚ï¼å¦‚æœè¿˜æƒ³å¯¹æ•°æ®å±‚åŠ å¯†çš„è¯ï¼Œåªéœ€åœ¨å‘½ä»¤ä¸­å¢åŠ -o encrypted å‚æ•°ã€‚ $ docker network ls NETWORK ID NAME DRIVER SCOPEddac4ff813b7 bridge bridge ocal389a7e7e8607 docker_gwbridge bridge locala09f7e6b2ac6 host host localehw16ycy980s ingress overlay swarm2b26c11d3469 none null local**c740ydi1lm89** **uber-net** **overlay** **swarm** å¦‚æœåœ¨node2 èŠ‚ç‚¹ä¸Šè¿è¡Œdocker network ls å‘½ä»¤ï¼Œå°±ä¼šå‘ç°æ— æ³•çœ‹åˆ°uber-net ç½‘ç»œã€‚è¿™æ˜¯å› ä¸ºåªæœ‰å½“è¿è¡Œä¸­çš„å®¹å™¨è¿æ¥åˆ°è¦†ç›–ç½‘ç»œçš„æ—¶å€™ï¼Œè¯¥ç½‘ç»œæ‰å˜ä¸ºå¯ç”¨çŠ¶æ€ã€‚è¿™ç§å»¶è¿Ÿç”Ÿæ•ˆç­–ç•¥é€šè¿‡å‡å°‘ç½‘ç»œæ¢³ç†ï¼Œæå‡äº†ç½‘ç»œçš„æ‰©å±•æ€§ã€‚\n3ï¼å°†æœåŠ¡è¿æ¥åˆ°è¦†ç›–ç½‘ç»œ\nç°åœ¨è¦†ç›–ç½‘ç»œå·²ç»å°±ç»ªï¼Œæ¥ä¸‹æ¥æ–°å»ºä¸€ä¸ªDockeræœåŠ¡å¹¶è¿æ¥åˆ°è¯¥ç½‘ç»œã€‚DockeræœåŠ¡ä¼šåŒ…å«ä¸¤ä¸ªå‰¯æœ¬ï¼ˆå®¹å™¨ï¼‰ï¼Œä¸€ä¸ªè¿è¡Œåœ¨node1 èŠ‚ç‚¹ä¸Šï¼Œä¸€ä¸ªè¿è¡Œåœ¨node2 èŠ‚ç‚¹ä¸Šã€‚è¿™æ ·ä¼šè‡ªåŠ¨å°†node2 èŠ‚ç‚¹æ¥å…¥uber-net ç½‘ç»œã€‚\nåœ¨node1èŠ‚ç‚¹ä¸Šè¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚ ------------------------------------------------------------ $ docker service create --name test \\ --network uber-net \\--replicas 2 \\ubuntu sleep infinity è¯¥å‘½ä»¤åˆ›å»ºäº†åä¸ºtest çš„æ–°æœåŠ¡ï¼Œ è¿æ¥åˆ°äº†uber-net è¿™ä¸ªè¦†ç›–ç½‘ç»œï¼Œ åŸºäºæŒ‡å®šçš„é•œåƒåˆ›å»ºäº†ä¸¤ä¸ªå‰¯æœ¬ï¼ˆå®¹å™¨ï¼‰ã€‚ åœ¨ä¸¤ä¸ªç¤ºä¾‹ä¸­ï¼Œå‡åœ¨å®¹å™¨ä¸­é‡‡ç”¨sleepå‘½ä»¤æ¥ä¿æŒå®¹å™¨è¿è¡Œï¼Œå¹¶åœ¨ä¼‘çœ ç»“æŸåé€€å‡ºè¯¥å®¹å™¨ã€‚ ç”±äºè¿è¡Œäº†ä¸¤ä¸ªå‰¯æœ¬ï¼ˆå®¹å™¨ï¼‰ï¼Œè€ŒSwarmåŒ…å«ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šè¿è¡Œä¸€ä¸ªå‰¯æœ¬ã€‚\n$ docker service ps test ------------------------------------------------------------ ID NAME IMAGE NODE DESIRED STATE CURRENT STATE 77q...rkx test.1 ubuntu node1 Running Running 97v...pa5 test.2 ubuntu node2 Running Running å½“Swarmåœ¨è¦†ç›–ç½‘ç»œä¹‹ä¸Šå¯åŠ¨å®¹å™¨æ—¶ï¼Œä¼šè‡ªåŠ¨å°†å®¹å™¨è¿è¡Œæ‰€åœ¨èŠ‚ç‚¹åŠ å…¥åˆ°ç½‘ç»œå½“ä¸­ã€‚è¿™æ„å‘³ç€æ­¤æ—¶åœ¨node2 èŠ‚ç‚¹ä¸Šå°±å¯ä»¥çœ‹åˆ°uber-net ç½‘ç»œäº†\n4ï¼æµ‹è¯•è¦†ç›–ç½‘ç»œ\nç°åœ¨ä½¿ç”¨pingå‘½ä»¤æ¥æµ‹è¯•è¦†ç›–ç½‘ç»œã€‚\nåœ¨ä¸¤ä¸ªç‹¬ç«‹çš„ç½‘ç»œä¸­åˆ†åˆ«æœ‰ä¸€å°Dockerä¸»æœºï¼Œå¹¶ä¸”ä¸¤è€…éƒ½æ¥å…¥äº†åŒä¸€ä¸ªè¦†ç›–ç½‘ç»œã€‚ç›®å‰åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸€ä¸ªå®¹å™¨æ¥å…¥äº†è¦†ç›–ç½‘ç»œã€‚æµ‹è¯•ä¸€ä¸‹ä¸¤ä¸ªå®¹å™¨ä¹‹é—´æ˜¯å¦å¯ä»¥pingé€šã€‚\nä¸ºäº†æ‰§è¡Œè¯¥æµ‹è¯•ï¼Œéœ€è¦çŸ¥é“æ¯ä¸ªå®¹å™¨çš„IPåœ°å€ï¼ˆä¸ºäº†æµ‹è¯•ï¼Œæš‚æ—¶å¿½ç•¥ç›¸åŒè¦†ç›–ç½‘ç»œä¸Šçš„å®¹å™¨å¯ä»¥é€šè¿‡åç§°æ¥äº’ç›¸pingé€šçš„äº‹å®ï¼‰ã€‚\nè¿è¡Œdocker network inspect æŸ¥çœ‹è¢«åˆ†é…ç»™è¦†ç›–ç½‘ç»œçš„Subnet ã€‚ ------------------------------------------------------------ $ docker network inspect uber-net [{\u0026#34;Name\u0026#34;: \u0026#34;uber-net\u0026#34;,\u0026#34;Id\u0026#34;: \u0026#34;c740ydi1lm89khn5kd52skrd9\u0026#34;,\u0026#34;Scope\u0026#34;: \u0026#34;swarm\u0026#34;,\u0026#34;Driver\u0026#34;: \u0026#34;overlay\u0026#34;,\u0026#34;EnableIPv6\u0026#34;: false,\u0026#34;IPAM\u0026#34;: {\u0026#34;Driver\u0026#34;: \u0026#34;default\u0026#34;,\u0026#34;Options\u0026#34;: null,\u0026#34;Config\u0026#34;: [{\u0026#34;Subnet\u0026#34;: \u0026#34;10.0.0.0/24\u0026#34;,\u0026#34;Gateway\u0026#34;: \u0026#34;10.0.0.1\u0026#34;}\u0026lt;Snip\u0026gt; uber-net çš„å­ç½‘æ˜¯10.0.0.0/24 ã€‚æ³¨æ„ï¼Œè¿™ä¸ä¸¤ä¸ªèŠ‚ç‚¹çš„ä»»æ„åº•å±‚ç‰©ç†ç½‘ç»œIPå‡ä¸ç›¸ç¬¦ï¼ˆ172.31.1.0/24 å’Œ192.168.1.0/24 ï¼‰ã€‚ åœ¨node1 å’Œnode2 èŠ‚ç‚¹ä¸Šè¿è¡Œä¸‹é¢ä¸¤æ¡å‘½ä»¤ã€‚è¿™ä¸¤æ¡å‘½ä»¤å¯ä»¥è·å–åˆ°å®¹å™¨IDå’ŒIPåœ°å€ã€‚ $ docker container ls CONTAINER ID IMAGE COMMAND CREATED STATUS 396c8b142a85 ubuntu:latest \u0026#34;sleep infinity\u0026#34; 2 hours ago Up 2 hrs $ docker container inspect \\ --format=\u0026#39;{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}\u0026#39;\\ 396c8b142a85 10.0.0.3 ç”±å›¾å¯çŸ¥ï¼Œä¸€ä¸ªäºŒå±‚è¦†ç›–ç½‘ç»œæ¨ªè·¨ä¸¤å°ä¸»æœºï¼Œå¹¶ä¸”æ¯ä¸ªå®¹å™¨åœ¨è¦†ç›–ç½‘ç»œä¸­éƒ½æœ‰è‡ªå·±çš„IPåœ°å€ã€‚\nè¿™æ„å‘³ç€node1 èŠ‚ç‚¹ä¸Šçš„å®¹å™¨å¯ä»¥é€šè¿‡node2 èŠ‚ç‚¹ä¸Šå®¹å™¨çš„IPåœ°å€10.0.0.4 æ¥pingé€šï¼Œè¯¥IPåœ°å€å±äºè¦†ç›–ç½‘ç»œã€‚å°½ç®¡ä¸¤ä¸ªèŠ‚ç‚¹åˆ†å±äºä¸åŒçš„äºŒå±‚ç½‘ç»œï¼Œè¿˜æ˜¯å¯ä»¥ç›´æ¥pingé€šã€‚éªŒè¯å¦‚ä¸‹ï¼š\n$ docker container exec -it 396c8b142a85 bash ------------------------------------------------------------ root@396c8b142a85:/# apt-get update root@396c8b142a85:/# apt-get install iputils-ping Reading package lists... DoneBuilding dependency treeReading state information... DoneSetting up iputils-ping (3:20121221-5ubuntu2) ...Processing triggers for libc-bin (2.23-0ubuntu3) ... root@396c8b142a85:/# ping 10.0.0.4 PING 10.0.0.4 (10.0.0.4) 56(84) bytes of data.64 bytes from 10.0.0.4: icmp_seq=1 ttl=64 time=1.06 ms64 bytes from 10.0.0.4: icmp_seq=2 ttl=64 time=1.07 ms64 bytes from 10.0.0.4: icmp_seq=3 ttl=64 time=1.03 ms64 bytes from 10.0.0.4: icmp_seq=4 ttl=64 time=1.26 ms^C root@396c8b142a85:/# è¿˜å¯ä»¥åœ¨å®¹å™¨å†…éƒ¨è·Ÿè¸ªpingå‘½ä»¤çš„è·¯ç”±ä¿¡æ¯ã€‚è·¯ç”±ä¿¡æ¯åªæœ‰ä¸€è·³ï¼Œè¯æ˜å®¹å™¨é—´é€šä¿¡ç¡®å®é€šè¿‡è¦†ç›–ç½‘ç»œç›´è¿â€”â€”æ— é¡»å…³å¿ƒåº•å±‚ç½‘ç»œï¼Œè¿™å¤ªçœå¿ƒäº†ã€‚\n$ root@396c8b142a85:/# traceroute 10.0.0.4traceroute to 10.0.0.4 (10.0.0.4), 30 hops max, 60 byte packets1 test-svc.2.97v...a5.uber-net (10.0.0.4) 1.110ms 1.034ms 1.073ms åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»é€šè¿‡å•æ¡å‘½ä»¤åˆ›å»ºäº†è¦†ç›–ç½‘ç»œï¼Œå¹¶å‘è¯¥ç½‘ç»œä¸­æ¥å…¥äº†å®¹å™¨ã€‚è¿™äº›å®¹å™¨åˆ†å¸ƒåœ¨ä¸¤ä¸ªä¸åŒçš„ä¸»æœºä¸Šï¼Œä¸¤å°ä¸»æœºåˆ†å±äºä¸åŒçš„äºŒå±‚ç½‘ç»œã€‚åœ¨æ‰¾å‡ºä¸¤å°å®¹å™¨çš„IPä¹‹åï¼ŒéªŒè¯äº†å®¹å™¨å¯ä»¥é€šè¿‡è¦†ç›–ç½‘ç»œå®Œæˆç›´è¿ã€‚\nVXLAN # Vxalnä»‹ç» # Dockerä½¿ç”¨VXLANéš§é“æŠ€æœ¯åˆ›å»ºäº†è™šæ‹ŸäºŒå±‚è¦†ç›–ç½‘ç»œ\nåœ¨VXLANçš„è®¾è®¡ä¸­ï¼Œå…è®¸ç”¨æˆ·åŸºäºå·²ç»å­˜åœ¨çš„ç‰©ç†ä¸‰å±‚ç½‘ç»œç»“æ„åˆ›å»ºé€»è¾‘è™šæ‹Ÿçš„äºŒå±‚ç½‘ç»œã€‚åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­åˆ›å»ºäº†ä¸€ä¸ªå­ç½‘æ©ç ä¸º10.0.0.0/24çš„äºŒå±‚ç½‘ç»œï¼Œè¯¥ç½‘ç»œæ˜¯åŸºäºä¸€ä¸ªä¸‰å±‚IPç½‘ç»œå®ç°çš„ï¼Œä¸‰å±‚IPç½‘ç»œç”±172.31.1.0/24å’Œ192.168.1.0/24è¿™ä¸¤ä¸ªäºŒå±‚ç½‘ç»œæ„æˆã€‚å…·ä½“å¦‚å›¾æ‰€ç¤º\nVXLANçš„ç¾å¦™ä¹‹å¤„åœ¨äºå®ƒæ˜¯ä¸€ç§å°è£…æŠ€æœ¯ï¼Œèƒ½ä½¿ç°å­˜çš„è·¯ç”±å™¨å’Œç½‘ç»œæ¶æ„çœ‹èµ·æ¥å°±åƒæ™®é€šçš„IP/UDPåŒ…ä¸€æ ·ï¼Œå¹¶ä¸”å¤„ç†èµ·æ¥æ¯«æ— é—®é¢˜ã€‚\nä¸ºäº†åˆ›å»ºäºŒå±‚è¦†ç›–ç½‘ç»œï¼ŒVXLANåŸºäºç°æœ‰çš„ä¸‰å±‚IPç½‘ç»œåˆ›å»ºäº†éš§é“ã€‚åŸºç¡€ç½‘ç»œï¼ˆUnderlay Networkï¼‰è¿™ä¸ªæœ¯è¯­ï¼Œå®ƒç”¨äºæŒ‡ä»£ä¸‰å±‚ä¹‹ä¸‹çš„åŸºç¡€éƒ¨åˆ†\nVXLANéš§é“ä¸¤ç«¯éƒ½æ˜¯VXLANéš§é“ç»ˆç«¯ï¼ˆVXLAN Tunnel Endpoint, VTEPï¼‰ã€‚VTEPå®Œæˆäº†å°è£…å’Œè§£å‹çš„æ­¥éª¤ï¼Œä»¥åŠä¸€äº›åŠŸèƒ½å®ç°æ‰€å¿…éœ€çš„æ“ä½œï¼Œå¦‚å›¾æ‰€ç¤ºã€‚\nVxlanåœ¨å¤šä¸»æœºå®¹å™¨é€šä¿¡çš„åº”ç”¨ # é€šè¿‡IPç½‘ç»œå°†ä¸¤å°ä¸»æœºè¿æ¥èµ·æ¥ã€‚æ¯ä¸ªä¸»æœºè¿è¡Œäº†ä¸€ä¸ªå®¹å™¨ï¼Œä¹‹ååˆä¸ºå®¹å™¨è¿æ¥åˆ›å»ºäº†ä¸€ä¸ªVXLANè¦†ç›–ç½‘ç»œã€‚\nä¸ºäº†å®ç°ä¸Šè¿°åœºæ™¯ï¼Œåœ¨æ¯å°ä¸»æœºä¸Šéƒ½æ–°å»ºäº†ä¸€ä¸ªSandboxï¼ˆç½‘ç»œå‘½åç©ºé—´ï¼‰ã€‚æ­£å¦‚å‰æ–‡æ‰€è®²ï¼ŒSandboxå°±åƒä¸€ä¸ªå®¹å™¨ï¼Œä½†å…¶ä¸­è¿è¡Œçš„ä¸æ˜¯åº”ç”¨ï¼Œè€Œæ˜¯å½“å‰ä¸»æœºä¸Šç‹¬ç«‹çš„ç½‘ç»œæ ˆã€‚\nåœ¨Sandboxå†…éƒ¨åˆ›å»ºäº†ä¸€ä¸ªåä¸ºBr0 çš„è™šæ‹Ÿäº¤æ¢æœºï¼ˆåˆç§°åšè™šæ‹Ÿç½‘æ¡¥ï¼‰ï¼Œæ¯ä¸ªå®¹å™¨éƒ½ä¼šæœ‰è‡ªå·±çš„è™šæ‹Ÿä»¥å¤ªç½‘ï¼ˆvethï¼‰é€‚é…å™¨ï¼Œå¹¶æ¥å…¥æœ¬åœ°Br0 è™šæ‹Ÿäº¤æ¢æœº\nåŒæ—¶Sandboxå†…éƒ¨è¿˜åˆ›å»ºäº†ä¸€ä¸ªVTEPï¼Œå…¶ä¸­ä¸€ç«¯æ¥å…¥åˆ°åä¸ºBr0 çš„è™šæ‹Ÿäº¤æ¢æœºå½“ä¸­ï¼Œå¦ä¸€ç«¯æ¥å…¥ä¸»æœºç½‘ç»œæ ˆï¼ˆVTEPï¼‰ã€‚\nåœ¨ä¸»æœºç½‘ç»œæ ˆä¸­çš„ç»ˆç«¯ä»ä¸»æœºæ‰€è¿æ¥çš„åŸºç¡€ç½‘ç»œä¸­è·å–åˆ°IPåœ°å€ï¼Œå¹¶ä»¥UDP Socketçš„æ–¹å¼ç»‘å®šåˆ°4789ç«¯å£ã€‚\n# ç›¸å…³åè¯ 1. Vethï¼ˆVirtual Ethernetï¼‰æ˜¯ä¸€ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œé€šå¸¸ç”¨äºåœ¨è™šæ‹Ÿæœºæˆ–å®¹å™¨ä¸­åˆ›å»ºè™šæ‹Ÿçš„ç½‘ç»œæ¥å£ 2. VTEPï¼ˆVXLAN Tunnel Endpointsï¼‰ æ˜¯ä¸€ç§ç½‘ç»œè®¾å¤‡ï¼Œç”¨äºåœ¨ VXLANï¼ˆVirtual Extensible Local Area Networkï¼‰ç½‘ç»œæ¶æ„ä¸­åˆ›å»ºå’Œç®¡ç†éš§é“ã€‚VXLAN æ˜¯ä¸€ç§ç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œé€šè¿‡å°è£…ä»¥å¤ªç½‘å¸§åœ¨ UDP åŒ…ä¸­ï¼Œå…è®¸è·¨è¶Šå¹¿åŸŸç½‘ï¼ˆWANï¼‰çš„ç½‘ç»œæµé‡ä¼ è¾“ã€‚ 3. VXLANï¼ˆVirtual Extensible Local Area Networkï¼Œè™šæ‹Ÿå¯æ‰©å±•å±€åŸŸç½‘ï¼‰æ˜¯ä¸€ç§ç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®ƒå…è®¸åœ¨ç‰©ç†ç½‘ç»œä¹‹ä¸Šåˆ›å»ºå¤šä¸ªè™šæ‹Ÿç½‘ç»œã€‚VXLANï¼šå·¥ä½œåœ¨ç½‘ç»œå±‚ä¹‹ä¸Šï¼ˆOSI æ¨¡å‹çš„ç¬¬ä¸‰å±‚æˆ–ç¬¬å››å±‚ï¼‰ã€‚VXLAN é€šè¿‡åœ¨ä»¥å¤ªç½‘å¸§å¤–å°è£…ä¸€ä¸ª UDP åŒ…æ¥å®ç°ç½‘ç»œè™šæ‹ŸåŒ– å®¹å™¨é€šä¿¡è¿‡ç¨‹ # å°†node1ä¸Šçš„å®¹å™¨ç§°ä¸ºC1 ï¼Œnode2ä¸Šçš„å®¹å™¨ç§°ä¸ºC2 ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚å‡è®¾C1 å¸Œæœ›pingé€šC2\n# å‘é€è¿‡ç¨‹ (1)C1 å‘èµ·pingè¯·æ±‚ï¼Œç›®æ ‡IPä¸ºC2 çš„åœ°å€10.0.0.4 ã€‚ (2)è¯¥è¯·æ±‚çš„æµé‡é€šè¿‡è¿æ¥åˆ°Br0 è™šæ‹Ÿäº¤æ¢æœºçš„vethæ¥å£å‘å‡ºã€‚ (3)è™šæ‹Ÿäº¤æ¢æœºå¹¶ä¸çŸ¥é“å°†åŒ…å‘é€åˆ°å“ªé‡Œï¼Œå› ä¸ºåœ¨è™šæ‹Ÿäº¤æ¢æœºçš„MACåœ°å€æ˜ å°„è¡¨ï¼ˆARPæ˜ å°„è¡¨ï¼‰ä¸­å¹¶æ²¡æœ‰ä¸å½“å‰ç›®çš„IPå¯¹åº”çš„MACåœ°å€ã€‚æ‰€ä»¥è™šæ‹Ÿäº¤æ¢æœºä¼šå°†è¯¥åŒ…å‘é€åˆ°å…¶ä¸Šçš„å…¨éƒ¨ç«¯å£ã€‚ (4)è¿æ¥åˆ°Br0 çš„VTEPæ¥å£çŸ¥é“å¦‚ä½•è½¬å‘è¿™ä¸ªæ•°æ®å¸§ï¼Œæ‰€ä»¥ä¼šå°†è‡ªå·±çš„MACåœ°å€è¿”å›ã€‚è¿™å°±æ˜¯ä¸€ä¸ªä»£ç†ARPå“åº”ï¼Œå¹¶ä¸”è™šæ‹Ÿäº¤æ¢æœºBr0 æ ¹æ®è¿”å›ç»“æœå­¦ä¼šäº†å¦‚ä½•è½¬å‘è¯¥åŒ…ã€‚ (5)æ¥ä¸‹æ¥è™šæ‹Ÿäº¤æ¢æœºä¼šæ›´æ–°è‡ªå·±çš„ARPæ˜ å°„è¡¨ï¼Œå°†10.0.0.4æ˜ å°„åˆ°æœ¬åœ°VTEPçš„MACåœ°å€ä¸Šã€‚ (6)ç°åœ¨Br0 äº¤æ¢æœºå·²ç»å­¦ä¼šå¦‚ä½•è½¬å‘ç›®æ ‡ä¸ºC2 çš„æµé‡ï¼Œæ¥ä¸‹æ¥æ‰€æœ‰å‘é€åˆ°C2 çš„åŒ…éƒ½ä¼šè¢«ç›´æ¥è½¬å‘åˆ°VTEPæ¥å£ã€‚ (7)VTEPæ¥å£çŸ¥é“C2ï¼Œæ˜¯å› ä¸ºæ‰€æœ‰æ–°å¯åŠ¨çš„å®¹å™¨éƒ½ä¼šå°†è‡ªå·±çš„ç½‘ç»œè¯¦æƒ…é‡‡ç”¨ç½‘ç»œå†…ç½®Gossipåè®®å‘é€ç»™ç›¸åŒSwarmé›†ç¾¤å†…çš„å…¶ä»–èŠ‚ç‚¹ã€‚ # æ¥æ”¶è¿‡ç¨‹ (1)äº¤æ¢æœºä¼šå°†åŒ…è½¬å‘åˆ°VTEPæ¥å£ï¼ŒVTEPå®Œæˆæ•°æ®å¸§çš„å°è£…ï¼Œè¿™æ ·å°±èƒ½åœ¨åº•å±‚ç½‘ç»œä¼ è¾“ã€‚å…·ä½“æ¥è¯´ï¼Œå°è£…æ“ä½œå°±æ˜¯æŠŠVXLAN Headerä¿¡æ¯æ·»åŠ ä»¥å¤ªå¸§å½“ä¸­ã€‚ (2)VXLAN Headerä¿¡æ¯åŒ…å«äº†VXLANç½‘ç»œIDï¼ˆVNIDï¼‰ï¼Œå…¶ä½œç”¨æ˜¯è®°å½•VLANåˆ°VXLANçš„æ˜ å°„å…³ç³»ã€‚æ¯ä¸ªVLANéƒ½å¯¹åº”ä¸€ä¸ªVNIDï¼Œä»¥ä¾¿åŒ…å¯ä»¥åœ¨è§£æåè¢«è½¬å‘åˆ°æ­£ç¡®çš„VLANã€‚ (3)å°è£…çš„æ—¶å€™ä¼šå°†æ•°æ®å¸§æ”¾åˆ°UDPåŒ…ä¸­ï¼Œå¹¶è®¾ç½®UDPçš„ç›®çš„IPå­—æ®µä¸ºnode2èŠ‚ç‚¹çš„VTEPçš„IPåœ°å€ï¼ŒåŒæ—¶è®¾ç½®UDP Socketç«¯å£ä¸º4789ã€‚è¿™ç§å°è£…æ–¹å¼ä¿è¯äº†åº•å±‚ç½‘ç»œä¹‹é—´æ˜¯é€æ˜çš„ï¼Œä¹Ÿå¯ä»¥å®Œæˆæ•°æ®ä¼ è¾“ã€‚ (4)å½“åŒ…åˆ°è¾¾node2ä¹‹åï¼Œå†…æ ¸å‘ç°ç›®çš„ç«¯å£ä¸ºUDPç«¯å£4789ï¼ŒåŒæ—¶è¿˜çŸ¥é“å­˜åœ¨VTEPæ¥å£ç»‘å®šåˆ°è¯¥Socketã€‚æ‰€ä»¥å†…æ ¸å°†åŒ…å‘ç»™VTEPï¼Œç”±VTEPè¯»å–VNIDï¼Œè§£å‹åŒ…ä¿¡æ¯ï¼Œå¹¶æ ¹æ®VNIDå‘é€åˆ°æœ¬åœ°åä¸ºBr0 çš„è¿æ¥åˆ°VLANçš„äº¤æ¢æœºã€‚åœ¨è¯¥äº¤æ¢æœºä¸Šï¼ŒåŒ…è¢«å‘é€ç»™å®¹å™¨C2 è¦†ç›–ç½‘ç»œå®ç°ä¸‰å±‚è·¯ç”± # Dockeræ”¯æŒä½¿ç”¨åŒæ ·çš„è¦†ç›–ç½‘ç»œå®ç°ä¸‰å±‚è·¯ç”±ã€‚ä¾‹å¦‚ï¼Œè¯»è€…å¯ä»¥åˆ›å»ºåŒ…å«ä¸¤ä¸ªå­ç½‘çš„è¦†ç›–ç½‘ç»œï¼ŒDockerä¼šè´Ÿè´£å­ç½‘é—´çš„è·¯ç”±ã€‚åˆ›å»ºçš„å‘½ä»¤å¦‚ä¸‹\ndocker network create --subnet=10.1.1.0/24 --subnet=11.1.1.0/24 -d overlayprod-net è¯¥å‘½ä»¤ä¼šåœ¨Sandboxä¸­åˆ›å»ºä¸¤ä¸ªè™šæ‹Ÿäº¤æ¢æœºï¼Œé»˜è®¤æ”¯æŒè·¯ç”±ã€‚ 6. Macvlan # èƒ½å¤Ÿå°†å®¹å™¨åŒ–åº”ç”¨è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿä»¥åŠç‰©ç†ç½‘ç»œçš„èƒ½åŠ›æ˜¯éå¸¸å¿…è¦çš„ã€‚å¸¸è§çš„ä¾‹å­æ˜¯éƒ¨åˆ†å®¹å™¨åŒ–çš„åº”ç”¨â€”â€”åº”ç”¨ä¸­å·²å®¹å™¨åŒ–çš„éƒ¨åˆ†éœ€è¦ä¸é‚£äº›è¿è¡Œåœ¨ç‰©ç†ç½‘ç»œå’ŒVLANä¸Šçš„æœªå®¹å™¨åŒ–éƒ¨åˆ†è¿›è¡Œé€šä¿¡ã€‚\nDockerå†…ç½®çš„Macvlan é©±åŠ¨ï¼ˆWindowsä¸Šæ˜¯Transparent ï¼‰å°±æ˜¯ä¸ºæ­¤åœºæ™¯è€Œç”Ÿã€‚é€šè¿‡ä¸ºå®¹å™¨æä¾›MACå’ŒIPåœ°å€ï¼Œè®©å®¹å™¨åœ¨ç‰©ç†ç½‘ç»œä¸Šæˆä¸ºâ€œä¸€ç­‰å…¬æ°‘â€\nMacvlançš„ä¼˜ç‚¹æ˜¯æ€§èƒ½ä¼˜å¼‚ï¼Œå› ä¸ºæ— é¡»ç«¯å£æ˜ å°„æˆ–è€…é¢å¤–æ¡¥æ¥ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ä¸»æœºæ¥å£ï¼ˆæˆ–è€…å­æ¥å£ï¼‰è®¿é—®å®¹å™¨æ¥å£ã€‚ä½†æ˜¯ï¼ŒMacvlançš„ç¼ºç‚¹æ˜¯éœ€è¦å°†ä¸»æœºç½‘å¡ï¼ˆNICï¼‰è®¾ç½®ä¸ºæ··æ‚æ¨¡å¼ï¼ˆPromiscuous Modeï¼‰ ï¼Œè¿™åœ¨å¤§éƒ¨åˆ†å…¬æœ‰äº‘å¹³å°ä¸Šæ˜¯ä¸å…è®¸çš„ã€‚æ‰€ä»¥Macvlanå¯¹äºå…¬å¸å†…éƒ¨çš„æ•°æ®ä¸­å¿ƒç½‘ç»œæ¥è¯´å¾ˆæ£’ï¼ˆå‡è®¾å…¬å¸ç½‘ç»œç»„èƒ½æ¥å—NICè®¾ç½®ä¸ºæ··æ‚æ¨¡å¼ï¼‰ï¼Œä½†æ˜¯Macvlanåœ¨å…¬æœ‰äº‘ä¸Šå¹¶ä¸å¯è¡Œ\næ­£å¸¸æ¨¡å¼ï¼šåœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼Œç½‘ç»œæ¥å£å¡åªæ¥æ”¶ç›®çš„åœ°æ˜¯å®ƒè‡ªèº« MAC åœ°å€çš„æ•°æ®åŒ…ï¼Œä»¥åŠå¹¿æ’­å’Œå¤šæ’­çš„æ•°æ®åŒ…ã€‚ æ··æ‚æ¨¡å¼ï¼šå½“ç½‘ç»œæ¥å£å¡è¢«è®¾ç½®ä¸ºæ··æ‚æ¨¡å¼æ—¶ï¼Œå®ƒä¼šæ¥æ”¶æ‰€æœ‰ç»è¿‡çš„ç½‘ç»œæµé‡ï¼ŒåŒ…æ‹¬é‚£äº›ä¸å‘é€ç»™å®ƒçš„æ•°æ®åŒ…ã€‚è¿™æ„å‘³ç€NICèƒ½å¤Ÿçœ‹åˆ°åœ¨åŒä¸€ç½‘ç»œæ®µä¸Šçš„æ‰€æœ‰æ•°æ®åŒ…ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸“é—¨å‘ç»™å®ƒçš„ ä¸¾ä¾‹ï¼š\nå‡è®¾ã€æœ‰ä¸€ä¸ªç‰©ç†ç½‘ç»œï¼Œå…¶ä¸Šé…ç½®äº†ä¸¤ä¸ªVLANâ€”â€”VLAN 100ï¼š10.0.0.0/24å’ŒVLAN 200ï¼š192.168.3.0/24ï¼Œå¦‚å›¾\næ·»åŠ ä¸€ä¸ªDockerä¸»æœºå¹¶è¿æ¥åˆ°è¯¥ç½‘ç»œ\næœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯å°†å®¹å™¨æ¥å…¥VLAN 100ã€‚ä¸ºäº†å®ç°è¯¥éœ€æ±‚ï¼Œé¦–å…ˆä½¿ç”¨Macvlan é©±åŠ¨åˆ›å»ºæ–°çš„Dockerç½‘ç»œã€‚Macvlan é©±åŠ¨åœ¨è¿æ¥åˆ°ç›®æ ‡ç½‘ç»œå‰ï¼Œéœ€è¦è®¾ç½®å‡ ä¸ªå‚æ•°ã€‚æ¯”å¦‚ä»¥ä¸‹å‡ ç‚¹:å­ç½‘ä¿¡æ¯ã€ç½‘å…³ã€å¯åˆ†é…ç»™å®¹å™¨çš„IPã€ä¸»æœºä½¿ç”¨çš„æ¥å£æˆ–è€…å­æ¥å£\nä¸‹é¢çš„å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªåä¸ºmacvlan100 çš„Macvlanç½‘ç»œï¼Œè¯¥ç½‘ç»œä¼šè¿æ¥åˆ°VLAN 100\n$ docker network create -d macvlan \\ --subnet=10.0.0.0/24 \\ --ip-range=10.0.00/25 \\ --gateway=10.0.0.1 \\ -o parent=eth0.100 \\ macvlan100 --ip-range=10.0.0.0/25: è¿™ä¸ªå‚æ•°ç”¨äºé™åˆ¶å®¹å™¨å¯ä»¥è·å¾—çš„ IP åœ°å€èŒƒå›´ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒIP åœ°å€èŒƒå›´æ˜¯ 10.0.0.0 åˆ° 10.0.0.127ï¼Œæä¾› 128 ä¸ªåœ°å€ä¾›å®¹å™¨ä½¿ç”¨ã€‚è¿™æ ·å¯ä»¥æ§åˆ¶å®¹å™¨çš„ IP åœ°å€åˆ†é…ã€‚ -o parent=eth0.100: -o æ˜¯æŒ‡å®šç½‘ç»œé€‰é¡¹çš„å‚æ•°ã€‚parent=eth0.100 æŒ‡å®šäº†å®¿ä¸»æœºä¸Šä½¿ç”¨çš„ç½‘ç»œæ¥å£ã€‚è¿™é‡Œ eth0.100 æ˜¯ä¸€ä¸ªå­æ¥å£ï¼ˆé€šå¸¸åœ¨ VLAN é…ç½®ä¸­ä½¿ç”¨ï¼‰ï¼Œè¡¨ç¤ºè¯¥ Macvlan ç½‘ç»œå°†åŸºäºè¿™ä¸ªæ¥å£è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚ è¯¥å‘½ä»¤ä¼šåˆ›å»ºmacvlan100 ç½‘ç»œä»¥åŠeth0.100 å­æ¥å£ã€‚å½“å‰é…ç½®å¦‚å›¾\nMacvlané‡‡ç”¨æ ‡å‡†Linuxå­æ¥å£ï¼Œè¯»è€…éœ€è¦ä¸ºå…¶æ‰“ä¸Šç›®æ ‡VLANç½‘ç»œå¯¹åº”çš„IDã€‚åœ¨æœ¬ä¾‹ä¸­ç›®æ ‡ç½‘ç»œæ˜¯VLAN 100ï¼Œæ‰€ä»¥å°†å­æ¥å£æ ‡è®°ä¸º .100 ï¼ˆetho.100 ï¼‰\nmacvlan100 ç½‘ç»œå·²ä¸ºå®¹å™¨å‡†å¤‡å°±ç»ªï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å°†å®¹å™¨éƒ¨ç½²åˆ°è¯¥ç½‘ç»œä¸­\n$ docker container run -d --name mactainer1 \\ --network macvlan100 \\ alpine sleep 1d å½“å‰é…ç½®å¦‚å›¾11.17æ‰€ç¤ºã€‚ä½†æ˜¯åˆ‡è®°ï¼Œä¸‹å±‚ç½‘ç»œï¼ˆVLAN 100 ï¼‰å¯¹Macvlançš„é­”æ³•æ¯«ä¸çŸ¥æƒ…ï¼Œåªèƒ½çœ‹åˆ°å®¹å™¨çš„MACå’ŒIPåœ°å€ã€‚åœ¨è¯¥åŸºç¡€ä¹‹ä¸Šï¼Œmactainer1 å®¹å™¨å¯ä»¥pingé€šä»»ä½•åŠ å…¥VLAN 100çš„ç³»ç»Ÿï¼Œå¹¶è¿›è¡Œé€šä¿¡\nå¦‚æœä¸Šè¿°å‘½ä»¤ä¸èƒ½æ‰§è¡Œï¼Œå¯èƒ½æ˜¯å› ä¸ºä¸»æœºNICä¸æ”¯æŒæ··æ‚æ¨¡å¼ã€‚åˆ‡è®°å…¬æœ‰äº‘å¹³å°ä¸å…è®¸æ··æ‚æ¨¡å¼ã€‚\nç›®å‰å·²ç»æ‹¥æœ‰äº†Macvlanç½‘ç»œï¼Œå¹¶æœ‰ä¸€å°å®¹å™¨é€šè¿‡Macvlanæ¥å…¥äº†ç°æœ‰çš„VLANå½“ä¸­ã€‚ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ˜¯ç»“æŸã€‚Docker Macvlané©±åŠ¨åŸºäºç¨³å®šå¯é çš„åŒåLinuxå†…æ ¸é©±åŠ¨æ„å»ºè€Œæˆã€‚å› æ­¤ï¼ŒMacvlanä¹Ÿæ”¯æŒVLANçš„TrunkåŠŸèƒ½ã€‚è¿™æ„å‘³ç€å¯ä»¥åœ¨ç›¸åŒçš„Dockerä¸»æœºä¸Šåˆ›å»ºå¤šä¸ªMacvlanç½‘ç»œï¼Œå¹¶ä¸”å°†å®¹å™¨æŒ‰ç…§å›¾çš„æ–¹å¼è¿æ¥èµ·æ¥\n","date":"2025-12-03 22:26","externalUrl":null,"permalink":"/docs/docker/docker%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/","section":"Docs","summary":"æœ¬æ–‡æ¶µç›–æ—¥å¸¸æœ€å¸¸ç”¨çš„Dockerå‘½ä»¤ã€‚ä»æ‹‰å–é•œåƒã€å¯åŠ¨å®¹å™¨ï¼Œåˆ°æŸ¥çœ‹æ—¥å¿—ã€è¿›å…¥å®¹å™¨å†…éƒ¨è°ƒè¯•ï¼Œä½ å°†æŒæ¡å®¹å™¨ç”Ÿå‘½å‘¨æœŸçš„åŸºæœ¬ç®¡ç†æ“ä½œ","title":"DockeråŸºæœ¬ä½¿ç”¨","type":"docs"},{"content":" ä¸€ã€Dockerç®€ä»‹ # 1. ä»‹ç» # Dockeræ˜¯ä¸€ç§è¿è¡ŒäºLinuxå’ŒWindowsä¸Šçš„è½¯ä»¶ï¼Œç”¨äºåˆ›å»ºã€ç®¡ç†å’Œç¼–æ’å®¹å™¨ã€‚\nLinuxå®¹å™¨ï¼ˆLinux Containers)å±äºä¸€ä¸ªè½»é‡çº§çš„åº”ç”¨ç¨‹åºéš”ç¦»æœºåˆ¶ã€‚å…è®¸å°†å•ä¸ªæ“ä½œç³»ç»Ÿç®¡ç†çš„èµ„æºåˆ’åˆ†åˆ°å­¤ç«‹çš„ç»„ä¸­ï¼Œä»¥æ›´å¥½çš„åœ¨å­¤ç«‹ç»„ä¹‹é—´å¹³è¡¡æœ‰å†²çªçš„èµ„æºä½¿ç”¨éœ€æ±‚ã€‚\nå®ƒä¸è™šæ‹ŸåŒ–ç›¸æ¯”ï¼Œä¸éœ€è¦æŒ‡ä»¤çº§æ¨¡æ‹Ÿï¼Œä¹Ÿä¸éœ€è¦å³ä½¿ç¼–è¯‘ã€‚æ‰€å ç”¨ç©ºé—´åˆæ¯”è™šæ‹Ÿæœºç­‰ç¨‹åºå ç”¨èµ„æºå°‘çš„å¤šã€‚\n2. ä¼˜ç‚¹ # æ•æ·åº¦é«˜,è½»é‡çº§ï¼Œå¯åŠ¨å¿«ï¼Œéƒ¨ç½²å¿«ã€‚ å¯ç§»æ¤ã€é€‚åº”æ€§å¼ºï¼šåº”ç”¨ç¨‹åºå’Œåº•å±‚ç¯å¢ƒè§£è€¦ docker images çš„ç‰ˆæœ¬æ§åˆ¶ 3. åŸç† # Linux å®¹å™¨æ˜¯é€šè¿‡ kernel ä¸­ä¸‰ä¸ªä¸»è¦éƒ¨ä»¶å¾—ä»¥å®ç°çš„ :\nåç§°ç©ºé—´\nèµ„æºæ§åˆ¶\nSELinux å®‰å…¨æ§åˆ¶\nï¼ˆ1ï¼‰å‘½åç©ºé—´ï¼ˆnamespaceï¼‰ # å‘½åç©ºé—´æ˜¯ Linux å†…æ ¸æä¾›çš„ä¸€ç§éš”ç¦»æœºåˆ¶ï¼Œå®ƒå¯ä»¥æŠŠä¸åŒè¿›ç¨‹çš„èµ„æºéš”ç¦»å¼€ã€‚Docker ä½¿ç”¨å‘½åç©ºé—´æ¥å®ç°å®¹å™¨çš„èµ„æºéš”ç¦»ã€‚æ¯ä¸ªå®¹å™¨è¿è¡Œæ—¶éƒ½åœ¨ä¸€ä¸ªç‹¬ç«‹çš„å‘½åç©ºé—´ä¸­\nå‘½åç©ºé—´ ä½œç”¨ ä»‹ç» PID éš”ç¦»è¿›ç¨‹ ID æ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„è¿›ç¨‹ ID ç©ºé—´ï¼Œå®¹å™¨å†…çš„è¿›ç¨‹æ— æ³•çœ‹åˆ°å…¶ä»–å®¹å™¨çš„è¿›ç¨‹ã€‚ NET éš”ç¦»ç½‘ç»œæ ˆ æ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„ç½‘ç»œæ¥å£ã€IP åœ°å€å’Œè·¯ç”±è¡¨ï¼Œç½‘ç»œæµé‡ç›¸äº’éš”ç¦»ã€‚ IPC éš”ç¦»è¿›ç¨‹é—´é€šä¿¡ æ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„æ¶ˆæ¯é˜Ÿåˆ—ã€ä¿¡å·é‡å’Œå…±äº«å†…å­˜ï¼Œç¡®ä¿æ•°æ®ç‹¬ç«‹æ€§ã€‚ UTS éš”ç¦»ä¸»æœºåå’ŒåŸŸå æ¯ä¸ªå®¹å™¨å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ä¸»æœºåå’ŒåŸŸåï¼Œä¸å½±å“å®¿ä¸»æœºæˆ–å…¶ä»–å®¹å™¨ã€‚ MNT éš”ç¦»æ–‡ä»¶ç³»ç»ŸæŒ‚è½½ç‚¹ æ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿè§†å›¾ï¼Œå…è®¸æŒ‚è½½ä¸åŒçš„å­˜å‚¨ä»‹è´¨å’Œç›®å½•ã€‚ USER éš”ç¦»ç”¨æˆ·å’Œç”¨æˆ·ç»„ æ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„æ˜ å°„ï¼Œæé«˜å®‰å…¨æ€§ã€‚ ï¼ˆ2ï¼‰èµ„æºé™åˆ¶ï¼ˆCgroupsï¼‰ # æ§åˆ¶ç»„ï¼ˆCgroupsï¼‰æ˜¯ Linux å†…æ ¸æä¾›çš„å¦ä¸€ç§æŠ€æœ¯ï¼Œç”¨äºé™åˆ¶å’Œç®¡ç†è¿›ç¨‹çš„èµ„æºä½¿ç”¨ã€‚Docker ä½¿ç”¨æ§åˆ¶ç»„æ¥å¯¹å®¹å™¨çš„ CPUã€å†…å­˜ã€ç£ç›˜å’Œç½‘ç»œå¸¦å®½ç­‰èµ„æºè¿›è¡Œé™åˆ¶ï¼Œç¡®ä¿å®¹å™¨ä¸ä¼šè¶…è¿‡åˆ†é…çš„èµ„æºï¼Œä»è€Œé¿å…èµ„æºäº‰ç”¨ã€‚\nCPU é™åˆ¶ï¼šé™åˆ¶å®¹å™¨ä½¿ç”¨çš„ CPU æ—¶é—´ã€‚ å†…å­˜é™åˆ¶ï¼šé™åˆ¶å®¹å™¨ä½¿ç”¨çš„å†…å­˜ã€‚ ç£ç›˜ I/O é™åˆ¶ï¼šé™åˆ¶å®¹å™¨çš„ç£ç›˜è¯»å†™é€Ÿåº¦ã€‚ ç½‘ç»œå¸¦å®½é™åˆ¶ï¼šé™åˆ¶å®¹å™¨çš„ç½‘ç»œä¼ è¾“é€Ÿåº¦ 4. ç›¸å…³åè¯ # ï¼ˆ1ï¼‰Docker # Dockerçš„å®¹å™¨è¿è¡Œæ—¶å’Œç¼–æ’å¼•æ“:Dockerå¼•æ“æ˜¯ç”¨äºè¿è¡Œå’Œç¼–æ’å®¹å™¨çš„åŸºç¡€è®¾æ–½å·¥å…·,å…¶ä»–Dockerå…¬å¸æˆ–ç¬¬ä¸‰æ–¹çš„äº§å“éƒ½æ˜¯å›´ç»•Dockerå¼•æ“è¿›è¡Œå¼€å‘å’Œé›†æˆçš„.\nDocker æä¾›äº†ç”¨æˆ·æ¥å£ã€ API ã€é•œåƒæ ¼å¼å’Œå¯¹Linux å®¹å™¨ç®¡ç†çš„å·¥å…·åŠå‘½ä»¤\nDocker é•œåƒæ˜¯ä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ï¼ŒåŒ…å«äº†ï¼šè¿è¡Œå®¹å™¨æ‰€éœ€çš„æ–‡ä»¶ç³»ç»Ÿå†…å®¹ã€ç¯å¢ƒå˜é‡ã€ç¨‹åºé…ç½®ç­‰ã€‚\né•œåƒå¯ä»¥åŸºäºå…¶ä»–é•œåƒæ„å»ºï¼Œå¹¶ä¸”æ˜¯å±‚å çš„ï¼Œæ¯ä¸€å±‚éƒ½ä»£è¡¨äº†å¯¹åŸå§‹é•œåƒçš„ä¿®æ”¹ï¼Œé•œåƒå¯ä»¥ä» Docker Hub ã€æˆ–è€…ç§æœ‰ä»“åº“ä¸­è·å–ã€‚\nDocker å±äºä¸€ä¸ªæ ‡å‡†çš„ systemd çš„æœåŠ¡å•å…ƒ :docker.serviceæ­¤æœåŠ¡å¯ä»¥é€šè¿‡ systemctl ç­‰å‘½ä»¤æ¥è¿›è¡Œç®¡ç†ã€‚åŒæ—¶ç”¨æˆ·å¯ä»¥ä½¿ç”¨ docker å‘½ä»¤ï¼Œæ¥å¯¹å®¹å™¨è¿›è¡Œ\nç®¡ç†ã€é…ç½®ã€‚é•œåƒä¸€èˆ¬å­˜å‚¨åœ¨æœ¬åœ°ç³»ç»Ÿçš„ /var/lib/docker ç›®å½•ä¸Šã€‚ä½†åŠ è½½æˆ–å¸è½½é•œåƒä»ç„¶éœ€è¦ä½¿ç”¨ docker å‘½ä»¤æ¥å®Œæˆ\nï¼ˆ2ï¼‰Docker images # Docker é•œåƒï¼ˆDocker Imageï¼‰æ˜¯ Docker å®¹å™¨çš„åŸºç¡€ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å«äº†åº”ç”¨ç¨‹åºåŠå…¶è¿è¡Œæ‰€éœ€ä¾èµ–ç¯å¢ƒçš„åªè¯»æ–‡ä»¶ç³»ç»Ÿã€‚é•œåƒå¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä¸€è‡´åœ°è¿è¡Œï¼Œä¸ºå®¹å™¨æä¾›ä¸€ä¸ªå¯é çš„ã€å¯é‡å¤çš„è¿è¡Œæ—¶ç¯å¢ƒã€‚\né•œåƒæœ¬èº«æ˜¯åªè¯»çš„ã€‚è¿™æ„å‘³ç€é•œåƒä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œè€Œæ˜¯é€šè¿‡å¯åŠ¨å®¹å™¨å¹¶åœ¨å®¹å™¨ä¸­è¿›è¡Œä¿®æ”¹ï¼ˆä¾‹å¦‚å†™å…¥æ•°æ®ã€ä¿®æ”¹æ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰ã€‚è¿™äº›ä¿®æ”¹æ˜¯å®¹å™¨çš„éƒ¨åˆ†ï¼Œå¹¶ä¸ä¼šå½±å“é•œåƒçš„å†…å®¹ã€‚å®¹å™¨è¿è¡Œæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯å†™å±‚ï¼Œè¿™ä¸ªå¯å†™å±‚ä½äºé•œåƒçš„é¡¶å±‚ã€‚\nï¼ˆ3ï¼‰Docker container # å®¹å™¨æ˜¯é•œåƒçš„è¿è¡Œæ—¶å®ä¾‹ã€‚æ­£å¦‚ä»è™šæ‹Ÿæœºæ¨¡æ¿ä¸Šå¯åŠ¨VMä¸€æ ·ï¼Œç”¨æˆ·ä¹ŸåŒæ ·å¯ä»¥ä»å•ä¸ªé•œåƒä¸Šå¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ã€‚è™šæ‹Ÿæœºå’Œå®¹å™¨æœ€å¤§çš„åŒºåˆ«æ˜¯å®¹å™¨æ›´å¿«å¹¶ä¸”æ›´è½»é‡çº§â€”â€”ä¸è™šæ‹Ÿæœºè¿è¡Œåœ¨å®Œæ•´çš„æ“ä½œç³»ç»Ÿä¹‹ä¸Šç›¸æ¯”ï¼Œå®¹å™¨ä¼šå…±äº«å…¶æ‰€åœ¨ä¸»æœºçš„æ“ä½œç³»ç»Ÿ/å†…æ ¸\né•œåƒä¸å®¹å™¨çš„å…³ç³»\né•œåƒï¼ˆImageï¼‰ æ˜¯å®¹å™¨çš„æ¨¡æ¿ï¼ŒåŒ…å«äº†åº”ç”¨ç¨‹åºå’Œæ‰€æœ‰å¿…è¦çš„ä¾èµ–ç¯å¢ƒã€‚é•œåƒæœ¬èº«æ˜¯é™æ€çš„ï¼Œå­˜å‚¨åœ¨ Docker Registry æˆ–æœ¬åœ°ã€‚ å®¹å™¨ï¼ˆContainerï¼‰ æ˜¯é•œåƒçš„è¿è¡Œæ—¶å®ä¾‹ã€‚å®¹å™¨æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ã€å¯æ‰§è¡Œçš„ç¯å¢ƒï¼Œå®ƒåŸºäºé•œåƒåˆ›å»ºï¼Œå¹¶å¯ä»¥å¯¹é•œåƒå†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œä½†è¿™äº›ä¿®æ”¹ä»…åœ¨å®¹å™¨å†…æœ‰æ•ˆï¼Œä¸ä¼šå½±å“é•œåƒæœ¬èº« å®¹å™¨å’Œè™šæ‹Ÿæœºçš„åŒºåˆ«\nå®¹å™¨å’Œè™šæ‹Ÿæœºéƒ½ä¾èµ–äºå®¿ä¸»æœºæ‰èƒ½è¿è¡Œ\nè™šæ‹Ÿæœºï¼šå…ˆè¦å¼€å¯ç‰©ç†æœºå¹¶å¯åŠ¨Hypervisorå¼•å¯¼ç¨‹åºå æœ‰æœºå™¨ä¸Šçš„å…¨éƒ¨ç‰©ç†èµ„æºï¼ˆCPUã€RAMã€å­˜å‚¨å’ŒNICï¼‰ï¼ŒHypervisorå°†è¿™äº›ç‰©ç†èµ„æºåˆ’åˆ†ä¸ºè™šæ‹Ÿèµ„æºï¼Œå¹¶ä¸”çœ‹èµ·æ¥ä¸çœŸå®ç‰©ç†èµ„æºå®Œå…¨ä¸€è‡´ã€‚ç„¶åHypervisorä¼šå°†è¿™äº›èµ„æºæ‰“åŒ…è¿›ä¸€ä¸ªå«ä½œè™šæ‹Ÿæœºï¼ˆVMï¼‰çš„è½¯ä»¶ç»“æ„å½“ä¸­ã€‚è¿™æ ·ç”¨æˆ·å°±å¯ä»¥ä½¿ç”¨è¿™äº›è™šæ‹Ÿæœºï¼Œå¹¶åœ¨å…¶ä¸­å®‰è£…æ“ä½œç³»ç»Ÿå’Œåº”ç”¨ã€‚å‰é¢æåˆ°éœ€è¦åœ¨ç‰©ç†æœºä¸Šè¿è¡Œ4ä¸ªåº”ç”¨ï¼Œæ‰€ä»¥åœ¨Hypervisorä¹‹ä¸Šéœ€è¦åˆ›å»º4ä¸ªè™šæ‹Ÿæœºå¹¶å®‰è£…4ä¸ªæ“ä½œç³»ç»Ÿï¼Œç„¶åå®‰è£…4ä¸ªåº”ç”¨ å®¹å™¨ï¼šDockerä¸­å¯ä»¥é€‰æ‹©Linuxï¼Œæˆ–è€…å†…æ ¸æ”¯æŒå†…æ ¸ä¸­çš„å®¹å™¨åŸè¯­çš„æ–°ç‰ˆæœ¬Windowsã€‚ä¸è™šæ‹Ÿæœºæ¨¡å‹ç›¸åŒï¼ŒOSä¹Ÿå ç”¨äº†å…¨éƒ¨ç¡¬ä»¶èµ„æºã€‚åœ¨OSå±‚ä¹‹ä¸Šï¼Œéœ€è¦å®‰è£…å®¹å™¨å¼•æ“ï¼ˆå¦‚Dockerï¼‰ã€‚å®¹å™¨å¼•æ“å¯ä»¥è·å–ç³»ç»Ÿèµ„æº ï¼Œæ¯”å¦‚è¿›ç¨‹æ ‘ã€æ–‡ä»¶ç³»ç»Ÿä»¥åŠç½‘ç»œæ ˆï¼Œæ¥ç€å°†èµ„æºåˆ†å‰²ä¸ºå®‰å…¨çš„äº’ç›¸éš”ç¦»çš„èµ„æºç»“æ„ï¼Œç§°ä¹‹ä¸ºå®¹å™¨ã€‚æ¯ä¸ªå®¹å™¨çœ‹èµ·æ¥å°±åƒä¸€ä¸ªçœŸå®çš„æ“ä½œç³»ç»Ÿï¼Œåœ¨å…¶å†…éƒ¨å¯ä»¥è¿è¡Œåº”ç”¨ã€‚æŒ‰ç…§å‰é¢çš„å‡è®¾ï¼Œéœ€è¦åœ¨ç‰©ç†æœºä¸Šè¿è¡Œ4ä¸ªåº”ç”¨ã€‚å› æ­¤ï¼Œéœ€è¦åˆ’åˆ†å‡º4ä¸ªå®¹å™¨å¹¶åœ¨æ¯ä¸ªå®¹å™¨ä¸­è¿è¡Œä¸€ä¸ªåº”ç”¨ ï¼ˆ4ï¼‰ Docker registry # åŸºæœ¬é•œåƒæ˜¯ä¸€ä¸ª tar çš„å½’æ¡£æ–‡ä»¶ã€‚åœ¨ä½¿ç”¨docker æ—¶å¯ä»¥æ‰‹å·¥åŠ è½½æˆ–è€…é€šè¿‡å…¶ä»–çš„è½¯ä»¶ä»“åº“è¿›è¡Œä¸‹è½½ã€‚\n5. Dockerçš„å®‰è£… # ä¸‰ç§å®‰è£…æ–¹å¼ # 1. yumç®€å•å®‰è£… # å¸è½½docker sudo yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-selinux \\ docker-engine-selinux \\ docker-engine #å®‰è£…dockerä¾èµ– yum install -y yum-utils device-mapper-persistent-data lvm2 #å®‰è£…é•œåƒä»“åº“ yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo #åˆ·æ–°ç¼“å­˜ yum makecache fast #å®‰è£…docker-ce yum -y install docker-ce #æœåŠ¡å¯åŠ¨ systemctlÂ startÂ docker systemctlÂ enable --now docker 2. ä½¿ç”¨æœ¬åœ°rpmåŒ…å®‰è£… # #ä¸‹è½½rpmåŒ…åŠä¾èµ– yumdownloader --resolve yum-utils device-mapper-persistent-data lvm2 yumdownloader --resolve yum -y install docker-ce #æœ¬åœ°å®‰è£… yum localinstall /path/to/package.rpm -y #éªŒè¯ rpm -qa | grep package_name docker info docker -v 3. ä¸‹è½½äºŒè¿›åˆ¶åŒ…å®‰è£… # Docker[ä¸‹è½½åœ°å€](Index of linux/static/stable/x86_64/)\nDocker-compose[ä¸‹è½½åœ°å€](Releases Â· docker/compose)\nä¸‹è½½æ–‡ä»¶å¹¶ä¸Šä¼ è‡³éœ€è¦å®‰è£…çš„æœåŠ¡å™¨\n#è§£å‹å¹¶å¤åˆ¶ tar -zxvf docker-23.0.1.tgz -C /opt/ #æ³¨æ„ç‰ˆæœ¬å· cp -p /opt/docker/* /usr/bin æœåŠ¡æ³¨å†Œ\nvim /usr/lib/systemd/system/docker.service\n$ `vim /usr/lib/systemd/system/docker.service` [Unit] Description=Docker Application Container Engine Documentation=http://docs.docker.com After=network.target docker.socket [Service] Type=notify EnvironmentFile=-/run/flannel/docker WorkingDirectory=/usr/local/bin ExecStart=/usr/bin/dockerd \\ -H tcp://0.0.0.0:4243 \\ -H unix:///var/run/docker.sock \\ --selinux-enabled=false \\ --log-opt max-size=1g ExecReload=/bin/kill -s HUP $MAINPID # Having non-zero Limit*s causes performance problems due to accounting overhead # in the kernel. We recommend using cgroups to do container-local accounting. LimitNOFILE=infinity LimitNPROC=infinity LimitCORE=infinity # Uncomment TasksMax if your systemd version supports it. # Only systemd 226 and above support this version. #TasksMax=infinity TimeoutStartSec=0 # set delegate yes so that systemd does not reset the cgroups of docker containers Delegate=yes # kill only the docker process, not all processes in the cgroup KillMode=process Restart=on-failure [Install] WantedBy=multi-user.target $ systemctl daemon-reload\u0026amp;\u0026amp;systemctl start docker $ systemctl enable --now docker $ docker version ","date":"2025-12-03 22:26","externalUrl":null,"permalink":"/docs/docker/docker%E7%AE%80%E4%BB%8B/","section":"Docs","summary":"Dockeræ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨åŒ–å¹³å°ã€‚å®ƒå½»åº•æ”¹å˜äº†è½¯ä»¶çš„æ‰“åŒ…ã€åˆ†å‘å’Œè¿è¡Œæ–¹å¼ï¼Œä½¿åº”ç”¨åŠå…¶è¿è¡Œç¯å¢ƒæˆä¸ºä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„â€œå®¹å™¨â€ï¼Œä»è€Œè§£å†³äº†â€œåœ¨æœ¬åœ°ç¯å¢ƒèƒ½è¿è¡Œï¼Œåœ¨å…¶ä»–ç¯å¢ƒå´å¤±è´¥â€çš„ç»å…¸éš¾é¢˜","title":"Dockerç®€ä»‹","type":"docs"},{"content":"","date":"2025-12-01 00:00","externalUrl":null,"permalink":"/resources/","section":"Resources","summary":"","title":"Resources","type":"resources"},{"content":"æ•°å­—ä¹¦æ¶\nè¿™é‡Œæ˜¯æˆ‘æ—¥å¸¸ä½¿ç”¨çš„ç½‘ç«™æ”¶è—ï¼ŒæŒ‰ç…§ç±»åˆ«è¿›è¡Œæ•´ç†ã€‚è¿™äº›ç½‘ç«™æ¶µç›–å¼€å‘ã€è®¾è®¡ã€å­¦ä¹ å’Œå¨±ä¹ç­‰å¤šä¸ªé¢†åŸŸï¼Œæ˜¯æˆ‘å·¥ä½œå’Œå­¦ä¹ çš„é‡è¦èµ„æºã€‚\nä½¿ç”¨è¯´æ˜\nåˆ†ç±»æµè§ˆï¼šç½‘ç«™æŒ‰ç…§åŠŸèƒ½åˆ†ä¸ºä¸åŒçš„ç±»åˆ«\næ ‡ç­¾ç­›é€‰ï¼šæ¯ä¸ªç½‘ç«™éƒ½æœ‰å¤šä¸ªæ ‡ç­¾ï¼Œæ–¹ä¾¿å¿«é€ŸæŸ¥æ‰¾\nç›´æ¥è®¿é—®ï¼šç‚¹å‡»ç½‘ç«™åç§°å³å¯åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€\næœ€åæ›´æ–°æ—¶é—´ï¼š2025å¹´12æœˆ\n","date":"2025-12-01 00:00","externalUrl":null,"permalink":"/resources/website/","section":"Resources","summary":"","title":"ç½‘ç«™æ”¶è—","type":"resources"},{"content":"","externalUrl":null,"permalink":"/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/series/","section":"Series","summary":"","title":"Series","type":"series"},{"content":"","externalUrl":null,"permalink":"/books/","section":"Startlight","summary":"","title":"æˆ‘çš„æ•°å­—ä¹¦æ¶","type":"page"},{"content":"æ‚¨çš„æ¯ä¸€åˆ†æ”¯æŒï¼Œéƒ½æ˜¯æˆ‘ä»¬æŒç»­ä¼˜åŒ–çš„åŠ¨åŠ›ï¼\nï¼ˆå¾®ä¿¡/æ”¯ä»˜å®æ‰«ç èµåŠ©ï¼Œ1å…ƒèµ·ï¼Œæ„Ÿè°¢æ‚¨çš„ä¿¡ä»»ï¼ï¼‰","externalUrl":null,"permalink":"/sponsor-diy/","section":"Startlight","summary":"","title":"æ”¯æŒæˆ‘ä»¬","type":"page"}]